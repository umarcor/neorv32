<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="A size-optimized, customizable and highly extensible MCU-class 32-bit RISC-V soft-core CPU and microcontroller-like SoC written in platform-independent VHDL.">
<meta name="keywords" content="neorv32, risc-v, riscv, rv32, fpga, soft-core, vhdl, microcontroller, cpu, soc, processor, gcc, openocd, gdb">
<link rel="icon" type="image/png" href="img/icon.png">
<title>[Datasheet] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor - Datasheet</h1>
<div class="details">
<span id="revnumber">version v1.5.5.0-r4510-gec620049</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_rationale">1.1. Rationale</a></li>
<li><a href="#_project_key_features">1.2. Project Key Features</a></li>
<li><a href="#_project_folder_structure">1.3. Project Folder Structure</a></li>
<li><a href="#_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</a></li>
<li><a href="#_fpga_implementation_results">1.5. FPGA Implementation Results</a></li>
<li><a href="#_cpu_performance">1.6. CPU Performance</a></li>
</ul>
</li>
<li><a href="#_neorv32_processor_soc">2. NEORV32 Processor (SoC)</a>
<ul class="sectlevel2">
<li><a href="#_processor_top_entity_signals">2.1. Processor Top Entity - Signals</a></li>
<li><a href="#_processor_top_entity_generics">2.2. Processor Top Entity - Generics</a></li>
<li><a href="#_processor_clocking">2.3. Processor Clocking</a>
<ul class="sectlevel3">
<li><a href="#_clock_gating">2.3.1. Clock Gating</a></li>
<li><a href="#_peripheral_clocks">2.3.2. Peripheral Clocks</a></li>
</ul>
</li>
<li><a href="#_processor_reset">2.4. Processor Reset</a></li>
<li><a href="#_processor_interrupts">2.5. Processor Interrupts</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</a></li>
<li><a href="#_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</a></li>
</ul>
</li>
<li><a href="#_address_space">2.6. Address Space</a>
<ul class="sectlevel3">
<li><a href="#_bus_gateway">2.6.1. Bus Gateway</a></li>
<li><a href="#_reservation_set_controller">2.6.2. Reservation Set Controller</a></li>
<li><a href="#_io_switch">2.6.3. IO Switch</a></li>
<li><a href="#_boot_configuration">2.6.4. Boot Configuration</a></li>
</ul>
</li>
<li><a href="#_processor_internal_modules">2.7. Processor-Internal Modules</a>
<ul class="sectlevel3">
<li><a href="#_instruction_memory_imem">2.7.1. Instruction Memory (IMEM)</a></li>
<li><a href="#_data_memory_dmem">2.7.2. Data Memory (DMEM)</a></li>
<li><a href="#_bootloader_rom_bootrom">2.7.3. Bootloader ROM (BOOTROM)</a></li>
<li><a href="#_processor_internal_instruction_cache_icache">2.7.4. Processor-Internal Instruction Cache (iCACHE)</a></li>
<li><a href="#_processor_internal_data_cache_dcache">2.7.5. Processor-Internal Data Cache (dCACHE)</a></li>
<li><a href="#_direct_memory_access_controller_dma">2.7.6. Direct Memory Access Controller (DMA)</a></li>
<li><a href="#_processor_external_memory_interface_wishbone">2.7.7. Processor-External Memory Interface (WISHBONE)</a></li>
<li><a href="#_stream_link_interface_slink">2.7.8. Stream Link Interface (SLINK)</a></li>
<li><a href="#_general_purpose_input_and_output_port_gpio">2.7.9. General Purpose Input and Output Port (GPIO)</a></li>
<li><a href="#_cyclic_redundancy_check_crc">2.7.10. Cyclic Redundancy Check (CRC)</a></li>
<li><a href="#_watchdog_timer_wdt">2.7.11. Watchdog Timer (WDT)</a></li>
<li><a href="#_machine_system_timer_mtime">2.7.12. Machine System Timer (MTIME)</a></li>
<li><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.7.13. Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></li>
<li><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.7.14. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></li>
<li><a href="#_serial_peripheral_interface_controller_spi">2.7.15. Serial Peripheral Interface Controller (SPI)</a></li>
<li><a href="#_serial_data_interface_controller_sdi">2.7.16. Serial Data Interface Controller (SDI)</a></li>
<li><a href="#_two_wire_serial_interface_controller_twi">2.7.17. Two-Wire Serial Interface Controller (TWI)</a></li>
<li><a href="#_one_wire_serial_interface_controller_onewire">2.7.18. One-Wire Serial Interface Controller (ONEWIRE)</a></li>
<li><a href="#_pulse_width_modulation_controller_pwm">2.7.19. Pulse-Width Modulation Controller (PWM)</a></li>
<li><a href="#_true_random_number_generator_trng">2.7.20. True Random-Number Generator (TRNG)</a></li>
<li><a href="#_custom_functions_subsystem_cfs">2.7.21. Custom Functions Subsystem (CFS)</a></li>
<li><a href="#_smart_led_interface_neoled">2.7.22. Smart LED Interface (NEOLED)</a></li>
<li><a href="#_external_interrupt_controller_xirq">2.7.23. External Interrupt Controller (XIRQ)</a></li>
<li><a href="#_general_purpose_timer_gptmr">2.7.24. General Purpose Timer (GPTMR)</a></li>
<li><a href="#_execute_in_place_module_xip">2.7.25. Execute In Place Module (XIP)</a></li>
<li><a href="#_system_configuration_information_memory_sysinfo">2.7.26. System Configuration Information Memory (SYSINFO)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</a>
<ul class="sectlevel2">
<li><a href="#_risc_v_compatibility">3.1. RISC-V Compatibility</a></li>
<li><a href="#_cpu_top_entity_signals">3.2. CPU Top Entity - Signals</a></li>
<li><a href="#_cpu_top_entity_generics">3.3. CPU Top Entity - Generics</a></li>
<li><a href="#_architecture">3.4. Architecture</a>
<ul class="sectlevel3">
<li><a href="#_cpu_register_file">3.4.1. CPU Register File</a></li>
<li><a href="#_cpu_arithmetic_logic_unit">3.4.2. CPU Arithmetic Logic Unit</a></li>
<li><a href="#_cpu_bus_unit">3.4.3. CPU Bus Unit</a></li>
<li><a href="#_cpu_control_unit">3.4.4. CPU Control Unit</a></li>
<li><a href="#_sleep_mode">3.4.5. Sleep Mode</a></li>
<li><a href="#_full_virtualization">3.4.6. Full Virtualization</a></li>
</ul>
</li>
<li><a href="#_bus_interface">3.5. Bus Interface</a>
<ul class="sectlevel3">
<li><a href="#_bus_interface_protocol">3.5.1. Bus Interface Protocol</a></li>
<li><a href="#_atomic_accesses">3.5.2. Atomic Accesses</a></li>
</ul>
</li>
<li><a href="#_instruction_sets_and_extensions">3.6. Instruction Sets and Extensions</a>
<ul class="sectlevel3">
<li><a href="#_a_isa_extension">3.6.1. <code>A</code> ISA Extension</a></li>
<li><a href="#_b_isa_extension">3.6.2. <code>B</code> ISA Extension</a></li>
<li><a href="#_c_isa_extension">3.6.3. <code>C</code> ISA Extension</a></li>
<li><a href="#_e_isa_extension">3.6.4. <code>E</code> ISA Extension</a></li>
<li><a href="#_i_isa_extension">3.6.5. <code>I</code> ISA Extension</a></li>
<li><a href="#_m_isa_extension">3.6.6. <code>M</code> ISA Extension</a></li>
<li><a href="#_u_isa_extension">3.6.7. <code>U</code> ISA Extension</a></li>
<li><a href="#_x_isa_extension">3.6.8. <code>X</code> ISA Extension</a></li>
<li><a href="#_zifencei_isa_extension">3.6.9. <code>Zifencei</code> ISA Extension</a></li>
<li><a href="#_zfinx_isa_extension">3.6.10. <code>Zfinx</code> ISA Extension</a></li>
<li><a href="#_zicntr_isa_extension">3.6.11. <code>Zicntr</code> ISA Extension</a></li>
<li><a href="#_zicond_isa_extension">3.6.12. <code>Zicond</code> ISA Extension</a></li>
<li><a href="#_zicsr_isa_extension">3.6.13. <code>Zicsr</code> ISA Extension</a></li>
<li><a href="#_zihpm_isa_extension">3.6.14. <code>Zihpm</code> ISA Extension</a></li>
<li><a href="#_zmmul_isa_extension">3.6.15. <code>Zmmul</code> - ISA Extension</a></li>
<li><a href="#_zxcfu_isa_extension">3.6.16. <code>Zxcfu</code> ISA Extension</a></li>
<li><a href="#_pmp_isa_extension">3.6.17. <code>PMP</code> ISA Extension</a></li>
<li><a href="#_sdext_isa_extension">3.6.18. <code>Sdext</code> ISA Extension</a></li>
<li><a href="#_sdtrig_isa_extension">3.6.19. <code>Sdtrig</code> ISA Extension</a></li>
</ul>
</li>
<li><a href="#_custom_functions_unit_cfu">3.7. Custom Functions Unit (CFU)</a>
<ul class="sectlevel3">
<li><a href="#_cfu_instruction_formats">3.7.1. CFU Instruction Formats</a></li>
<li><a href="#_using_custom_instructions_in_software">3.7.2. Using Custom Instructions in Software</a></li>
<li><a href="#_cfu_control_and_status_registers_cfu_csrs">3.7.3. CFU Control and Status Registers (CFU-CSRs)</a></li>
<li><a href="#_custom_instructions_hardware">3.7.4. Custom Instructions Hardware</a></li>
</ul>
</li>
<li><a href="#_control_and_status_registers_csrs">3.8. Control and Status Registers (CSRs)</a>
<ul class="sectlevel3">
<li><a href="#_floating_point_csrs">3.8.1. Floating-Point CSRs</a></li>
<li><a href="#_machine_trap_setup_csrs">3.8.2. Machine Trap Setup CSRs</a></li>
<li><a href="#_machine_trap_handling_csrs">3.8.3. Machine Trap Handling CSRs</a></li>
<li><a href="#_machine_configuration_csrs">3.8.4. Machine Configuration CSRs</a></li>
<li><a href="#_machine_physical_memory_protection_csrs">3.8.5. Machine Physical Memory Protection CSRs</a></li>
<li><a href="#_custom_functions_unit_cfu_csrs">3.8.6. Custom Functions Unit (CFU) CSRs</a></li>
<li><a href="#_machine_counter_and_timer_csrs">3.8.7. (Machine) Counter and Timer CSRs</a></li>
<li><a href="#_hardware_performance_monitors_hpm_csrs">3.8.8. Hardware Performance Monitors (HPM) CSRs</a></li>
<li><a href="#_machine_counter_setup_csrs">3.8.9. Machine Counter Setup CSRs</a></li>
<li><a href="#_machine_information_csrs">3.8.10. Machine Information CSRs</a></li>
<li><a href="#_neorv32_specific_csrs">3.8.11. NEORV32-Specific CSRs</a></li>
<li><a href="#_traps_exceptions_and_interrupts">3.8.12. Traps, Exceptions and Interrupts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_framework">4. Software Framework</a>
<ul class="sectlevel2">
<li><a href="#_compiler_toolchain">4.1. Compiler Toolchain</a></li>
<li><a href="#_core_libraries">4.2. Core Libraries</a></li>
<li><a href="#_application_makefile">4.3. Application Makefile</a>
<ul class="sectlevel3">
<li><a href="#_makefile_targets">4.3.1. Makefile Targets</a></li>
<li><a href="#_makefile_configuration">4.3.2. Makefile Configuration</a></li>
<li><a href="#_default_compiler_flags">4.3.3. Default Compiler Flags</a></li>
<li><a href="#_custom_compiler_flags">4.3.4. Custom (Compiler) Flags</a></li>
</ul>
</li>
<li><a href="#_executable_image_format">4.4. Executable Image Format</a>
<ul class="sectlevel3">
<li><a href="#_linker_script">4.4.1. Linker Script</a></li>
<li><a href="#_ram_layout">4.4.2. RAM Layout</a></li>
<li><a href="#_c_standard_library">4.4.3. C Standard Library</a></li>
<li><a href="#_executable_image_generator">4.4.4. Executable Image Generator</a></li>
<li><a href="#_start_up_code_crt0">4.4.5. Start-Up Code (crt0)</a></li>
</ul>
</li>
<li><a href="#_bootloader">4.5. Bootloader</a>
<ul class="sectlevel3">
<li><a href="#_bootloader_soccpu_requirements">4.5.1. Bootloader SoC/CPU Requirements</a></li>
<li><a href="#_bootloader_flash_requirements">4.5.2. Bootloader Flash Requirements</a></li>
<li><a href="#_bootloader_console">4.5.3. Bootloader Console</a></li>
<li><a href="#_auto_boot_sequence">4.5.4. Auto Boot Sequence</a></li>
<li><a href="#_bootloader_error_codes">4.5.5. Bootloader Error Codes</a></li>
</ul>
</li>
<li><a href="#_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</a>
<ul class="sectlevel3">
<li><a href="#_rte_operation">4.6.1. RTE Operation</a></li>
<li><a href="#_using_the_rte">4.6.2. Using the RTE</a></li>
<li><a href="#_default_rte_trap_handlers">4.6.3. Default RTE Trap Handlers</a></li>
<li><a href="#_application_context_handling">4.6.4. Application Context Handling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</a>
<ul class="sectlevel2">
<li><a href="#_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</a></li>
<li><a href="#_debug_module_dm">5.2. Debug Module (DM)</a>
<ul class="sectlevel3">
<li><a href="#_dm_registers">5.2.1. DM Registers</a></li>
<li><a href="#_dm_cpu_access">5.2.2. DM CPU Access</a></li>
</ul>
</li>
<li><a href="#_cpu_debug_mode">5.3. CPU Debug Mode</a>
<ul class="sectlevel3">
<li><a href="#_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</a></li>
</ul>
</li>
<li><a href="#_trigger_module">5.4. Trigger Module</a>
<ul class="sectlevel3">
<li><a href="#_trigger_module_csrs">5.4.1. Trigger Module CSRs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">6. Legal</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_citing">Citing</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://github.com/stnolting/neorv32"><img src="img/neorv32_logo.png" alt="neorv32 logo"></a>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://riscv.org/"><img src="img/riscv_logo.png" alt="riscv logo" width="350"></a>
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat-square&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat square&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/blob/main/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat-square" alt="neorv32?longCache=true&amp;style=flat square" title="license"></span></a>
<a href="https://gitter.im/neorv32/community"><span class="image"><img src="https://img.shields.io/badge/Chat-on%20gitter-4db797.svg?longCache=true&amp;style=flat-square&amp;logo=gitter&amp;logoColor=e8ecef" alt="Chat on%20gitter 4db797" title="chat on gitter"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/data%20sheet-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="data%20sheet PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="datasheet (pdf)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/user%20guide-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="user%20guide PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="userguide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/ug"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat-square" alt=" HTML ffbd00?longCache=true&amp;style=flat square" title="userguide (html)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/doxygen-HTML-ffbd00?longCache=true&amp;style=flat-square&amp;logo=Doxygen" alt="doxygen HTML ffbd00?longCache=true&amp;style=flat square&amp;logo=Doxygen" title="doxygen"></span></a><br>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/v/release/stnolting/neorv32?longCache=true&amp;style=flat-square&amp;logo=GitHub" alt="neorv32?longCache=true&amp;style=flat square&amp;logo=GitHub" title="release"></span></a>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/commits-since/stnolting/neorv32/latest?longCache=true&amp;style=flat-square&amp;logo=GitHub" alt="latest?longCache=true&amp;style=flat square&amp;logo=GitHub" title="release-commits"></span></a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 RISC-V Processor is an open-source RISC-V compatible processor system that is intended as
<strong>ready-to-go</strong> auxiliary processor within a larger SoC designs or as stand-alone custom / customizable
microcontroller.</p>
</div>
<div class="paragraph">
<p>The system is highly configurable and provides optional common peripherals like embedded memories,
timers, serial interfaces, general purpose IO ports and an external bus interface to connect custom IP like
memories, NoCs and other peripherals. On-line and in-system debugging is supported by an OpenOCD/gdb
compatible on-chip debugger accessible via JTAG.</p>
</div>
<div class="paragraph">
<p>Special focus is paid on <strong>execution safety</strong> to provide defined and predictable behavior at any time.
Therefore, the CPU ensures that all memory access are acknowledged and no invalid/malformed instructions
are executed. Whenever an unexpected situation occurs, the application code is informed via hardware exceptions.</p>
</div>
<div class="paragraph">
<p>The software framework of the processor comes with application makefiles, software libraries for all CPU
and processor features, a bootloader, a runtime environment and several example programs - including a port
of the CoreMark MCU benchmark and the official RISC-V architecture test suite. RISC-V GCC is used as
default toolchain (<a href="https://github.com/stnolting/riscv-gcc-prebuilt">prebuilt toolchains are also provided</a>).</p>
</div>
<div class="paragraph">
<p>Check out the processor&#8217;s <strong><a href="https://stnolting.github.io/neorv32/ug">online User Guide</a></strong>
that provides hands-on tutorials to get you started.</p>
</div>
<div class="paragraph">
<p><strong>Structure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a></p>
</li>
<li>
<p><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a></p>
</li>
<li>
<p><a href="#_software_framework">Software Framework</a></p>
</li>
<li>
<p><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
<li>
<p><a href="#_legal">Legal</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Annotations</strong></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Warning
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Important
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Tip
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_rationale">1.1. Rationale</h3>
<h4 id="_why_did_you_make_this" class="discrete">Why did you make this?</h4>
<div class="paragraph">
<p>Processor and CPU architecture designs are fascinating things: they are the magic frontier where software meets hardware.
This project started as something like a <em>journey</em> into this magic realm to understand how things actually work
down on this very low level and evolved over time to a capable system on chip.</p>
</div>
<div class="paragraph">
<p>But there is more: when I started to dive into the emerging RISC-V ecosystem I felt overwhelmed by the complexity.
As a beginner it is hard to get an overview - especially when you want to setup a minimal platform to tinker with&#8230;&#8203;
Which core to use? How to get the right toolchain? What features do I need? How does booting work? How do I
create an actual executable? How to get that into the hardware? How to customize things? <strong><em>Where to start???</em></strong></p>
</div>
<div class="paragraph">
<p>This project aims to provide a <em>simple to understand</em> and <em>easy to use</em> yet <em>powerful</em> and <em>flexible</em> platform
that targets FPGA and RISC-V beginners as well as advanced users.</p>
</div>
<h4 id="_why_a_soft_core_processor" class="discrete">Why a <em>soft-core</em> processor?</h4>
<div class="paragraph">
<p>As a matter of fact soft-core processors <em>cannot</em> compete with discrete (like FPGA hard-macro) processors in terms
of performance, energy efficiency and size. But they do fill a niche in FPGA design space: for example, soft-core
processors allow to implement the <em>control flow part</em> of certain applications (e.g. communication protocol handling)
using software like plain C. This provides high flexibility as software can be easily changed, re-compiled and
re-uploaded again.</p>
</div>
<div class="paragraph">
<p>Furthermore, the concept of flexibility applies to all aspects of a soft-core processor. The user can add
<em>exactly</em> the features that are required by the application: additional memories, custom interfaces, specialized
co-processors and even user-defined instructions.</p>
</div>
<h4 id="_why_risc_v" class="discrete">Why RISC-V?</h4>
<div class="imageblock text-left">
<div class="content">
<img src="img/riscv_logo.png" alt="riscv logo" width="250">
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RISC-V is a free and open ISA enabling a new era of processor innovation through open standard collaboration.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; RISC-V International<br>
<cite>https://riscv.org/about/</cite>
</div>
</div>
<div class="paragraph">
<p>Open-source is a great thing!
While open-source has already become quite popular in <em>software</em>, hardware-focused projects still need to catch up.
Admittedly, there has been quite a development, but mainly in terms of <em>platforms</em> and <em>applications</em> (so
schematics, PCBs, etc.). Although processors and CPUs are the heart of almost every digital system, having a true
open-source silicon is still a rarity. RISC-V aims to change that - and even it is <em>just one approach</em>, it helps paving
the road for future development.</p>
</div>
<div class="paragraph">
<p>Furthermore, I highly appreciate the community aspect of RISC-V. The ISA and everything beyond is developed in direct
contact with the community: this includes businesses and professionals but also hobbyist, amateurs and people
that are just curious. Everyone can join discussions and contribute to RISC-V in their very own way.</p>
</div>
<div class="paragraph">
<p>Finally, I really like the RISC-V ISA itself. It aims to be a clean, orthogonal and "intuitive" ISA that
resembles with the basic concepts of <em>RISC</em>: simple yet effective.</p>
</div>
<h4 id="_yet_another_risc_v_core_what_makes_it_special" class="discrete">Yet another RISC-V core? What makes it special?</h4>
<div class="paragraph">
<p>The NEORV32 is not based on another RISC-V core. It was build entirely from ground up (just following the official
ISA specs). The project does not intend to replace certain RISC-V cores or
just beat existing ones like <a href="https://github.com/SpinalHDL/VexRiscv">VexRISC</a> in terms of performance or
<a href="https://github.com/olofk/serv">SERV</a> in terms of size. It was build having a different design goal in mind.</p>
</div>
<div class="paragraph">
<p>The project aims to provide <em>another option</em> in the RISC-V / soft-core design space with a different performance
vs. size trade-off and a different focus: <em>embrace</em> concepts like documentation, platform-independence / portability,
RISC-V compatibility, <em>extensibility &amp; customization</em> and <em>ease of use</em> (see the <a href="#_project_key_features">Project Key Features</a> below).</p>
</div>
<div class="paragraph">
<p>Furthermore, the NEORV32 pays special focus on <em>execution safety</em> using <a href="#_full_virtualization">Full Virtualization</a>. The CPU aims to
provide fall-backs for <em>everything that could go wrong</em>. This includes malformed instruction words, privilege escalations
and even memory accesses that are checked for address space holes and deterministic response times of memory-mapped
devices. Precise exceptions allow a defined and fully-synchronized state of the CPU at every time an in every situation.</p>
</div>
<h4 id="_a_multi_cycle_architecture" class="discrete">A multi-cycle architecture?!?!</h4>
<div class="paragraph">
<p>Most mainstream CPUs out there are pipelined architectures to increase throughput. In contrast, most CPUs used for
teaching are single-cycle designs since they are probably the most easiest to understand. But what about the
multi-cycle architectures?</p>
</div>
<div class="paragraph">
<p>In terms of energy, throughput, area and maximal clock frequency multi-cycle architectures are somewhere in between
single-cycle and fully-pipelined designs: they provide higher throughput and clock speed when compared to their
single-cycle counterparts while having less hardware complexity (= area) then a fully-pipelined designs. I decided to
use the multi-cycle approach because of the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multi-cycle architecture are quite small! There is no need for pipeline hazard detection and resolution logic
(e.g. forwarding). Furthermore, you can "re-use" parts of the core to do several tasks (e.g. the ALU is used for the
actual data processing, but also for address generation, branch condition check and branch target computation).</p>
</li>
<li>
<p>Single-cycle architectures require memories that can be read asynchronously - a thing that is not feasible to implement
in real world applications (i.e. FPGA block RAM is entirely synchronous). Furthermore, such design usually have a very
long critical path tremendously reducing maximal operating frequency.</p>
</li>
<li>
<p>Pipelined designs increase performance by having several instruction "in fly" at the same time. But this also means
there is some kind of "out-of-order" behavior: if an instruction at the end of the pipeline causes an exception
all the instructions in earlier stages have to be invalidated. Potential architecture state changes have to be made <em>undone</em>
requiring additional (exception-handling) logic. In a multi-cycle architecture this situation cannot occur because only a
single instruction is "in fly" at a time.</p>
</li>
<li>
<p>Having only a single instruction in fly does not only reduce hardware costs, it also simplifies
simulation/verification/debugging, state preservation/restoring during exceptions and extensibility (no need to care
about pipeline hazards) - but of course at the cost of reduced throughput.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To counteract the loss of performance implied by a <em>pure</em> multi-cycle architecture, the NEORV32 CPU uses a <em>mixed</em>
approach: instruction fetch (front-end) and instruction execution (back-end) are de-coupled to operate independently
of each other. Data is interchanged via a queue building a simple 2-stage pipeline. Each "pipeline" stage in terms is
implemented as multi-cycle architecture to simplify the hardware and to provide <em>precise</em> state control (e.g. during
exceptions).</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_key_features">1.2. Project Key Features</h3>
<div class="paragraph">
<p><strong>Project</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>all-in-one package: <strong>CPU</strong> + <strong>SoC</strong> + <strong>Software Framework &amp; Tooling</strong></p>
</li>
<li>
<p>completely described in behavioral, platform-independent VHDL - no vendor- or technology-specific primitives, attributes, macros, libraries, etc. are used at all</p>
</li>
<li>
<p>all-Verilog "version" available (auto-generated netlist)</p>
</li>
<li>
<p>extensive configuration options for adapting the processor to the requirements of the application</p>
</li>
<li>
<p>highly extensible hardware - on CPU, SoC and system level</p>
</li>
<li>
<p>aims to be as small as possible while being as RISC-V-compliant as possible - with a reasonable area-vs-performance trade-off</p>
</li>
<li>
<p>FPGA friendly (e.g. all internal memories can be mapped to block RAM - including the register file)</p>
</li>
<li>
<p>optimized for high clock frequencies to ease timing closure and integration</p>
</li>
<li>
<p>from zero to <em>"hello world!"</em> - completely open source and documented</p>
</li>
<li>
<p>easy to use even for FPGA/RISC-V starters – intended to <em>work out of the box</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 CPU (the core)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit RISC-V CPU</p>
</li>
<li>
<p>fully compatible to the RISC-V ISA specs. - checked by the <a href="https://github.com/stnolting/neorv32-riscof">official RISCOF architecture tests</a></p>
</li>
<li>
<p>base ISA + privileged ISA + several optional standard and custom ISA extensions</p>
</li>
<li>
<p>option to add user-defined RISC-V instructions as custom ISA extension</p>
</li>
<li>
<p>rich set of customization options (ISA extensions, design goal: performance / area / energy, tuning options, &#8230;&#8203;)</p>
</li>
<li>
<p><a href="#_full_virtualization">Full Virtualization</a> capabilities to increase execution safety</p>
</li>
<li>
<p>official RISC-V open source architecture ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 Processor (the SoC)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>highly-configurable full-scale microcontroller-like processor system</p>
</li>
<li>
<p>based on the NEORV32 CPU</p>
</li>
<li>
<p>optional standard serial interfaces (UART, TWI, SPI (host and device), 1-Wire)</p>
</li>
<li>
<p>optional timers and counters (watchdog, system timer)</p>
</li>
<li>
<p>optional general purpose IO and PWM; a native NeoPixel(c)-compatible smart LED interface</p>
</li>
<li>
<p>optional embedded memories and caches for data, instructions and bootloader</p>
</li>
<li>
<p>optional external memory interface for custom connectivity</p>
</li>
<li>
<p>optional execute in-place (XIP) module to execute code directly form an external SPI flash</p>
</li>
<li>
<p>optional DMA controller for CPU-independent data transfers</p>
</li>
<li>
<p>optional CRC module to check data integrity</p>
</li>
<li>
<p>on-chip debugger compatible with OpenOCD and gdb including hardware trigger module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Software framework</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>GCC-based toolchain - <a href="https://github.com/stnolting/riscv-gcc-prebuilt">prebuilt toolchains available</a>; application compilation based on GNU makefiles</p>
</li>
<li>
<p>internal bootloader with serial user interface (via UART)</p>
</li>
<li>
<p>core libraries and HAL for high-level usage of the provided functions and peripherals</p>
</li>
<li>
<p>processor-specific runtime environment and several example programs</p>
</li>
<li>
<p>doxygen-based documentation of the software framework; a deployed version is available at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a></p>
</li>
<li>
<p>FreeRTOS port + demos available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Extensibility and Customization</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 processor is designed to ease customization and extensibility and provides several options for adding
application-specific custom hardware modules and accelerators. The three most common options for adding custom
on-chip modules are listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_external_memory_interface_wishbone">Processor-External Memory Interface (WISHBONE)</a> to attach processor-external IP modules</p>
</li>
<li>
<p><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for tightly-coupled processor-internal co-processors</p>
</li>
<li>
<p><a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> for custom RISC-V instructions</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more detailed comparison of the extension/customization options can be found in section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>
of the user guide.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_project_folder_structure">1.3. Project Folder Structure</h3>
<div class="literalblock">
<div class="content">
<pre>neorv32               - Project home folder
│
├docs                 - Project documentation
│├datasheet           - AsciiDoc sources for the NEORV32 data sheet
│├figures             - Figures and logos
│├references          - Data sheets and RISC-V specs
│├sources             - Sources for the images in 'figures/'
│└userguide           - AsciiDoc sources for the NEORV32 user guide
│
├rtl                  - VHDL sources
│├core                - Core sources of the CPU &amp; SoC
││└mem                - SoC-internal memories (default architectures)
│├legacy              - Deprecated/legacy HDL modules
│├processor_templates - Pre-configured SoC wrappers
│├system_integration  - System wrappers for advanced connectivity
│└test_setups         - Minimal test setup "SoCs" used in the User Guide
│
├sim                  - Simulation files (see User Guide)
│
└-sw                  - Software framework
  ├bootloader         - Sources of the processor-internal bootloader
  ├common             - Linker script, crt0.S start-up code and central makefile
  ├example            - Example programs for the core and the SoC modules
  ├lib                - Processor core library
  │├include           - Header files (*.h)
  │└source            - Source files (*.c)
  ├image_gen          - Helper program to generate NEORV32 executables
  ├ocd_firmware       - Firmware for the on-chip debugger's "park loop"
  ├openocd            - OpenOCD configuration files
  └svd                - Processor system view description file (CMSIS-SVD)</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</h3>
<div class="paragraph">
<p>All necessary VHDL hardware description files are located in the project&#8217;s <code>rtl/core</code> folder. The top entity
of the entire processor including all the required configuration generics is <code>neorv32_top.vhd</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Compile Order</div>
Most of the RTL sources use <strong>entity instantiation</strong>. Hence, the RTL compile order might be relevant.
The list below shows the hierarchical compile order srarting at the top.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">VHDL Library</div>
All core VHDL files from the list below have to be assigned to a <strong>new library</strong> named <code>neorv32</code>.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>┌neorv32_package.vhd             - Processor/CPU main VHDL package file
├neorv32_clockgate.vhd           - Generic clock gating switch
├neorv32_fifo.vhd                - Generic FIFO component
│
│ ┌neorv32_cpu_cp_bitmanip.vhd   - Bit-manipulation co-processor (B ext.)
│ ├neorv32_cpu_cp_cfu.vhd        - Custom instructions co-processor (Zxcfu ext.)
│ ├neorv32_cpu_cp_cond.vhd       - Integer conditional operations (Zicond ext.)
│ ├neorv32_cpu_cp_fpu.vhd        - Floating-point co-processor (Zfinx ext.)
│ ├neorv32_cpu_cp_shifter.vhd    - Bit-shift co-processor (base ISA)
│ ├neorv32_cpu_cp_muldiv.vhd     - Mul/Div co-processor (M ext.)
│ │
│┌neorv32_cpu_alu.vhd            - Arithmetic/logic unit
│├neorv32_cpu_pmp.vhd            - Physical memory protection unit (Smpmp ext.)
│├neorv32_cpu_lsu.vhd            - Load/store unit
││ ┌neorv32_cpu_decompressor.vhd - Compressed instructions decoder (C ext.)
│├neorv32_cpu_control.vhd        - CPU control, exception system and CSRs
│├neorv32_cpu_regfile.vhd        - Data register file
││
├neorv32_cpu.vhd                 - NEORV32 CPU TOP ENTITY
│
├mem/neorv32_dmem.default.vhd    - *Default* data memory (architecture-only)
├mem/neorv32_imem.default.vhd    - *Default* instruction memory (architecture-only)
│
│┌neorv32_bootloader_image.vhd   - Bootloader ROM memory image
├neorv32_boot_rom.vhd            - Bootloader ROM
│
│┌neor32_application_image.vhd   - IMEM application initialization image
├neorv32_imem.entity.vhd         - Processor-internal instruction memory (entity-only!)
│
├neorv32_cfs.vhd                 - Custom functions subsystem
├neorv32_crc.vhd                 - Cyclic redundancy check unit
├neorv32_dcache.vhd              - Processor-internal data cache
├neorv32_debug_dm.vhd            - on-chip debugger: debug module
├neorv32_debug_dtm.vhd           - on-chip debugger: debug transfer module
├neorv32_dma.vhd                 - Direct memory access controller
├neorv32_dmem.entity.vhd         - Processor-internal data memory (entity-only!)
├neorv32_gpio.vhd                - General purpose input/output port unit
├neorv32_gptmr.vhd               - General purpose 32-bit timer
├neorv32_icache.vhd              - Processor-internal instruction cache
├neorv32_intercon.vhd            - SoC bus infrastructure
├neorv32_mtime.vhd               - Machine system timer
├neorv32_neoled.vhd              - NeoPixel (TM) compatible smart LED interface
├neorv32_onewire.vhd             - One-Wire serial interface controller
├neorv32_pwm.vhd                 - Pulse-width modulation controller
├neorv32_sdi.vhd                 - Serial data interface controller (SPI device)
├neorv32_slink.vhd               - Stream link interface
├neorv32_spi.vhd                 - Serial peripheral interface controller (SPI host)
├neorv32_sysinfo.vhd             - System configuration information memory
├neorv32_trng.vhd                - True random number generator
├neorv32_twi.vhd                 - Two wire serial interface controller
├neorv32_uart.vhd                - Universal async. receiver/transmitter
├neorv32_wdt.vhd                 - Watchdog timer
├neorv32_wishbone.vhd            - External (Wishbone) bus interface
├neorv32_xip.vhd                 - Execute in place module
├neorv32_xirq.vhd                - External interrupt controller
│
neorv32_top.vhd                  - NEORV32 PROCESSOR TOP ENTITY</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The processor-internal instruction and data memories (IMEM and DMEM) are split into two design files each:
a plain entity definition (<code>neorv32_*mem.entity.vhd</code>) and the actual architecture definition
(<code>mem/neorv32_*mem.default.vhd</code>). The <code>*.default.vhd</code> architecture definitions from <code>rtl/core/mem</code> provide a <em>generic</em> and
<em>platform independent</em> memory design (inferring embedded memory blocks). You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_fpga_implementation_results">1.5. FPGA Implementation Results</h3>
<div class="paragraph">
<p>This section shows <strong>exemplary</strong> FPGA implementation results for the NEORV32 CPU and NEORV32 Processor modules.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The results are generated by manual synthesis runs. Hence, they might not represent the latest version of the processor.
</td>
</tr>
</table>
</div>
<h4 id="_cpu" class="discrete">CPU</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.7.8.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_cpu.vhd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPGA:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Cyclone IV E <code>EP4CE22F17C6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quartus Prime Lite 21.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>no timing constraints</strong>, "balanced optimization", f<sub>max</sub> from "<em>Slow 1200mV 0C Model</em>"</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU ISA Configuration</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
<th class="tableblock halign-right valign-top"><em>f<sub>max</sub></em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i_Zicsr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1223</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">607</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1578</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">773</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32im_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2087</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">983</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imc_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2338</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">992</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcb_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3175</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1247</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3186</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1254</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3187</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1254</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei_Zfinx</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4450</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1906</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei_Zfinx_DebugMode</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4825</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2018</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123 MHz</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Goal-Driven Optimization</div>
The CPU provides further options to reduce the area footprint or to increase performance.
See section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> for more information. Also, take a look at the User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_application_specific_processor_configuration">Application-Specific Processor Configuration</a>.
</td>
</tr>
</table>
</div>
<h4 id="_processor_modules" class="discrete">Processor - Modules</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.8.6.7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_top.vhd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPGA:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Cyclone IV E <code>EP4CE22F17C6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quartus Prime Lite 21.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>no timing constraints</strong>, "balanced optimization"</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Hardware utilization by processor module</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 53.3333%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BOOT ROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader ROM (4kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">32768</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus switch (core)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SoC bus infrastructure</em></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus switch (DMA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SoC bus infrastructure</em></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">159</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom functions subsystem <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cyclic redundancy check unit</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">117</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data cache (4 blocks, 64 bytes per block)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">167</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2112</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug module</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">377</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">241</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DTM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug transfer module (JTAG)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">262</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">220</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct memory access controller</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">365</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">291</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal data memory (8kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">65536</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SoC bus infrastructure</em></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">215</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">91</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPIO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose input/output ports</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">98</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPTMR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General Purpose Timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">105</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IO Switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SoC bus infrastructure</em></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">217</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction cache (2x4 blocks, 64 bytes per block)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">458</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">296</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4096</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal instruction memory (16kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">131072</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine system timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">307</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">166</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart LED Interface (NeoPixel/WS28128) (FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">171</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">129</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONEWIRE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">105</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulse_width modulation controller (4 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">91</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">81</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reservation Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reservation set controller for LR/SC instructions</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">52</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">33</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial data interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">512</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream link interface (RX/TX FIFO depth=32)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">73</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial peripheral interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">137</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">97</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSINFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System configuration information memory</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True random number generator</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">140</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">108</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">512</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-wire interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">93</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0, UART1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Universal asynchronous receiver/transmitter 0/1 (FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">222</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">142</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watchdog timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">107</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WISHBONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External memory interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">122</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">112</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute in place module</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">369</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">276</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller (4 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_performance">1.6. CPU Performance</h3>
<div class="paragraph">
<p>The performance of the NEORV32 was tested and evaluated using the <a href="https://www.eembc.org/coremark/">Core Mark CPU benchmark</a>.
The according sources can be found in the <code>sw/example/coremark</code> folder.
The resulting CoreMark score is defined as CoreMark iterations per second per MHz.</p>
</div>
<table class="tableblock frame-all grid-topbot stretch">
<caption class="title">Table 2. Configuration</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5.7.10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32kB int. IMEM, 16kB int. DMEM, no caches, 100MHz clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CoreMark:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000 iterations, MEM_METHOD is MEM_STACK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISCV32-GCC 10.2.0 (compiled with <code>march=rv32i mabi=ilp32</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler flags:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default but with <code>-O3</code>, see makefile</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. CoreMark results</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-center valign-top">CoreMark Score</th>
<th class="tableblock halign-center valign-top">CoreMarks/MHz</th>
<th class="tableblock halign-center valign-top">Average CPI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>small</em> (<code>rv32i_Zicsr_Zifencei</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">33.89</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.3389</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>4.04</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>medium</em> (<code>rv32imc_Zicsr_Zifencei</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">62.50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.6250</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>5.34</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>performance</em> (<code>rv32imc_Zicsr_Zifencei</code> + perf. options)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95.23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.9523</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>3.54</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The NEORV32 CPU is based on a multi-cycle architecture. Each instruction is executed in a sequence of
several consecutive micro operations. The average CPI (cycles per instruction) depends on the instruction
mix of a specific applications and also on the available CPU extensions. More information regarding the execution
time of each implemented instruction can be found in section <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_processor_soc">2. NEORV32 Processor (SoC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor is based on the NEORV32 CPU. Together with common peripheral
interfaces and embedded memories it provides a RISC-V-based full-scale microcontroller-like SoC platform.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_processor.png" alt="neorv32 processor">
</div>
<div class="title">Figure 1. The NEORV32 Processor (Block Diagram)</div>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a> and <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a></p>
</li>
<li>
<p><a href="#_processor_interrupts">Processor Interrupts</a></p>
</li>
<li>
<p><a href="#_address_space">Address Space</a> and <a href="#_boot_configuration">Boot Configuration</a></p>
</li>
<li>
<p><a href="#_processor_internal_modules">Processor-Internal Modules</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>optional</em> processor-internal data and instruction memories (<a href="#_data_memory_dmem"><strong>DMEM</strong></a>/<a href="#_instruction_memory_imem"><strong>IMEM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> caches (<a href="#_processor_internal_instruction_cache_icache"><strong>iCACHE</strong></a>/<a href="#_processor_internal_data_cache_dcache"><strong>dCACHE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> internal bootloader (<a href="#_bootloader_rom_bootrom"><strong>BOOTROM</strong></a>) with UART console &amp; SPI flash boot option</p>
</li>
<li>
<p><em>optional</em> machine system timer (<a href="#_machine_system_timer_mtime"><strong>MTIME</strong></a>), RISC-V-compatible</p>
</li>
<li>
<p><em>optional</em> two independent universal asynchronous receivers and transmitters (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0"><strong>UART0</strong></a>,
<a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1"><strong>UART1</strong></a>) with optional hardware flow control (RTS/CTS)</p>
</li>
<li>
<p><em>optional</em> serial peripheral interface host controller (<a href="#_serial_peripheral_interface_controller_spi"><strong>SPI</strong></a>) with 8 dedicated CS lines</p>
</li>
<li>
<p><em>optional</em> 8-bit serial data device interface (<a href="#_serial_data_interface_controller_spi"><strong>SDI</strong></a>)</p>
</li>
<li>
<p><em>optional</em> two wire serial interface controller (<a href="#_two_wire_serial_interface_controller_twi"><strong>TWI</strong></a>), compatible to the I²C standard</p>
</li>
<li>
<p><em>optional</em> general purpose parallel IO port (<a href="#_general_purpose_input_and_output_port_gpio"><strong>GPIO</strong></a>), 64xOut, 64xIn</p>
</li>
<li>
<p><em>optional</em> 32-bit external bus interface, Wishbone b4 / AXI4-Lite compatible (<a href="#_processor_external_memory_interface_wishbone"><strong>WISHBONE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> watchdog timer (<a href="#_watchdog_timer_wdt"><strong>WDT</strong></a>)</p>
</li>
<li>
<p><em>optional</em> PWM controller with up to 12 channels &amp; 8-bit duty cycle resolution (<a href="#_pulse_width_modulation_controller_pwm"><strong>PWM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> ring-oscillator-based true random number generator (<a href="#_true_random_number_generator_trng"><strong>TRNG</strong></a>)</p>
</li>
<li>
<p><em>optional</em> custom functions subsystem for custom co-processor extensions (<a href="#_custom_functions_subsystem_cfs"><strong>CFS</strong></a>)</p>
</li>
<li>
<p><em>optional</em> NeoPixel&#8482;/WS2812-compatible smart LED interface (<a href="#_smart_led_interface_neoled"><strong>NEOLED</strong></a>)</p>
</li>
<li>
<p><em>optional</em> external interrupt controller with up to 32 channels (<a href="#_external_interrupt_controller_xirq"><strong>XIRQ</strong></a>)</p>
</li>
<li>
<p><em>optional</em> general purpose 32-bit timer (<a href="#_general_purpose_timer_gptmr"><strong>GPTMR</strong></a>) with capture input</p>
</li>
<li>
<p><em>optional</em> execute in-place module (<a href="#_execute_in_place_module_xip"><strong>XIP</strong></a>)</p>
</li>
<li>
<p><em>optional</em> 1-wire serial interface controller (<a href="#_one_wire_serial_interface_controller_onewire"><strong>ONEWIRE</strong></a>), compatible to the 1-wire standard</p>
</li>
<li>
<p><em>optional</em> autonomous direct memory access controller (<a href="#_direct_memory_access_controller_dma"><strong>DMA</strong></a>)</p>
</li>
<li>
<p><em>optional</em> stream link interface (<a href="#_stream_link_interface_slink"><strong>SLINK</strong></a>), AXI4-Stream compatible</p>
</li>
<li>
<p><em>optional</em> cyclic redundancy check unit (<a href="#_cyclic_redundancy_check_crc"><strong>CRC</strong></a>)</p>
</li>
<li>
<p><em>optional</em> on-chip debugger with JTAG TAP (<a href="#_on_chip_debugger_ocd"><strong>OCD</strong></a>)</p>
</li>
<li>
<p>system configuration information memory to check HW configuration via software (<a href="#_system_configuration_information_memory_sysinfo"><strong>SYSINFO</strong></a>)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_processor_top_entity_signals">2.1. Processor Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the processor top entity (<code>rtl/core/neorv32_top.vhd</code>).
All signals are of type <code>std_ulogic</code> or <code>std_ulogic_vector</code>, respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Values of Inputs</div>
All <em>optional</em> input signals provide default values in case they are not explicitly assigned during instantiation.
The weak driver strengths of VHDL (<code>'L'</code> and <code>'H'</code>) are used to model a pull-down or pull-up resistor.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Configurable Amount of Channels</div>
Some peripherals allow to configure the number of channels to-be-implemented by a generic (for example the number
of PWM channels). The according input/output signals have a fixed sized regardless of the actually configured
amount of channels. If less than the maximum number of channels is configured, only the LSB-aligned channels are used:
in case of an <em>input port</em> the remaining bits/channels are left unconnected; in case of an <em>output port</em> the remaining
bits/channels are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Tri-State Interfaces</div>
Some interfaces (like the TWI and the 1-Wire bus) require tri-state drivers in the designs top module.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 4. NEORV32 Processor Signal List</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 57.1431%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>Global Control (<a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, asynchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>JTAG Access Port for <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset, low-active (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_processor_external_memory_interface_wishbone">Processor-External Memory Interface (WISHBONE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag (access type identifier)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable ('0' = read transfer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer acknowledge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer error</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX last element of stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX last element of stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chip select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_clk_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_clk_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_csn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chip select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'H'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire bus sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire bus output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulse-width modulated channels</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS input signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS output signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asynchronous serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_time_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTIME system time output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gptmr_trig_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timer capture input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupt requests</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>RISC-V Machine-Mode <a href="#_processor_interrupts">Processor Interrupts</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (RISC-V), high-level-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (RISC-V), high-level-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>'L'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (RISC-V), high-level-active</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_top_entity_generics">2.2. Processor Top Entity - Generics</h3>
<div class="paragraph">
<p>This section lists all configuration generics of the NEORV32 processor top entity (<code>rtl/neorv32_top.vhd</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Customization</div>
The NEORV32 generics allow to configure the system according to your needs. The generics are
used to control implementation of certain CPU extensions and peripheral modules and even allow to
optimize the system for certain design goals like minimal area or maximum performance.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Values</div>
All <em>optional</em> configuration generics provide default values in case they are not explicitly assigned during instantiation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Discovery of Configuration</div>
Software can determine the actual CPU configuration via the <a href="#_misa"><strong><code>misa</code></strong></a> and <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs. The Soc/Processor
and can be determined via the <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> memory-mapped registers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Excluded Modules and Extensions</div>
If optional modules (like CPU extensions or peripheral devices) are not enabled the according hardware
will not be synthesized at all. Hence, the disabled modules do not increase area and power requirements
and do not impact timing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Table Abbreviations</div>
The generic type &#8220;suv(x:y)&#8221; is an abbreviation for &#8220;std_ulogic_vector(x downto y)&#8221;.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 5. NEORV32 Processor Generic List</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 53.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>General</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOCK_FREQUENCY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The clock frequency of the processor&#8217;s <code>clk_i</code> input port in Hertz (Hz).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOCK_GATING_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable clock gating when CPU is in sleep mode (see sections <a href="#_sleep_mode">Sleep Mode</a> and <a href="#_processor_clocking">Processor Clocking</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT_BOOTLOADER_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a>, pre-initialized with the default <a href="#_bootloader">Bootloader</a> image.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HART_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hart thread ID of the CPU (passed to <a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VENDOR_ID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEDEC ID (passed to <a href="#_mvendorid"><strong><code>mvendorid</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ON_CHIP_DEBUGGER_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the on-chip debugger and the CPU debug mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DM_LEGACY_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module spec. version: <code>false</code> = v1.0, <code>true</code> = v0.13 (legacy mode).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>CPU <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_A</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> (atomic memory accesses).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_B</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_b_isa_extension"><code>B</code> ISA Extension</a> (bit-manipulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> (compressed instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> (reduced register file size).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> (hardware-based integer multiplication and division).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_U</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_u_isa_extension"><code>U</code> ISA Extension</a> (less-privileged user mode).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zfinx_isa_extension"><code>Zfinx</code> ISA Extension</a> (single-precision floating-point unit).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zicntr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zicntr_isa_extension"><code>Zicntr</code> ISA Extension</a> (CPU base counters).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zicond</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zicond_isa_extension"><code>Zicond</code> ISA Extension</a> (integer conditional operations).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zihpm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a> (hardware performance monitors).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zmmul</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#_zmmul_isa_extension"><code>Zmmul</code> - ISA Extension</a> (hardware-based integer multiplication).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zxcfu</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable NEORV32-specific <a href="#_zxcfu_isa_extension"><code>Zxcfu</code> ISA Extension</a> (custom RISC-V instructions).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>CPU <a href="#_architecture">Architecture</a> Tuning Options</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAST_MUL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement fast but large full-parallel multipliers (trying to infer DSP blocks); see section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAST_SHIFT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement fast but large full-parallel barrel shifters; see section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGFILE_HW_RST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement full hardware reset for register file (prevent inferring of BRAM); see section <a href="#_cpu_register_file">CPU Register File</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Physical Memory Protection (<a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_NUM_REGIONS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented PMP regions (0..16).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_MIN_GRANULARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimal region granularity in bytes. Has to be a power of two, min 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_TOR_MODE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement support for top-of-region (TOR) mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_NAP_MODE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement support for naturally-aligned power-of-two (NAPOT &amp; NA4) modes.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Hardware Performance Monitors (<a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM_NUM_CNTS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented hardware performance monitor counters (0..13).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM_CNT_WIDTH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total LSB-aligned size of each HPM counter. Min 0, max 64.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Atomic Memory Access Reservation Set Granularity (<a href="#_a_isa_extension"><code>A</code> ISA Extension</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AMO_RVS_GRANULARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes, has to be a power of 2, min 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_IMEM_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the processor-internal instruction memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_IMEM_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16*1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of the processor internal instruction memory (use a power of 2).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_DMEM_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the processor-internal data memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_DMEM_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8*1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of the processor-internal data memory (use a power of 2).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the instruction cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of blocks ("pages" or "lines") Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of each block. Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_ASSOCIATIVITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associativity (number of sets). Allowed configurations: <code>1</code> = 1 set, direct mapped; <code>2</code> = 2-way set-associative.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_processor_internal_data_cache_dcache">Processor-Internal Data Cache (dCACHE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the data cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of blocks ("pages" or "lines"). Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size in bytes of each block. Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_processor_external_memory_interface_wishbone">Processor-External Memory Interface (WISHBONE)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the external bus interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_TIMEOUT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clock cycles after which a pending external bus access will auto-terminate and raise a bus fault exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_PIPE_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <em>standard</em> ("classic") Wishbone protocol when false. Use <em>pipelined</em> Wishbone protocol when true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_BIG_ENDIAN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use BIG endian data order interface for external bus.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_ASYNC_RX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable input registers when true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_ASYNC_TX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable output registers when true.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the execute in-place module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement XIP cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of blocks in XIP cache. Has to be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes per XIP cache block. Has to be a power of two, min 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong><a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_NUM_CH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of channels of the external interrupt controller. Valid values are 0..32.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_TRIGGER_TYPE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger type (one bit per channel): <code>0</code> = level-triggered, '1' = edge triggered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_TRIGGER_POLARITY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger polarity (one bit per channel): <code>0</code> = low-level/falling-edge, '1' = high-level/rising-edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Peripheral/IO Modules</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPIO_NUM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of general purpose input/output pairs of the <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_MTIME_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a> FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_PWM_NUM_CH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of channels of the <a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> to implement (0..12).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_WDT_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depth of the TRNG data FIFO. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_CONFIG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x00000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Conduit" generic to pass user-defined flags to the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_IN_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> input signal conduit (<code>cfs_in_i</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_OUT_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> output signal conduit (<code>cfs_out_o</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth of the the <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a>. Has to be a power of two, min 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPTMR_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_RX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK RX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_TX_FIFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">natural</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK TX FIFO depth, has to be a power of two, minimum value is 1, max 32768.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CRC_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement the <a href="#_cyclic_redundancy_check_crc">Cyclic Redundancy Check (CRC)</a> unit.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_clocking">2.3. Processor Clocking</h3>
<div class="paragraph">
<p>The processor is implemented as fully-synchronous logic design using a single clock domain that is driven entirely by the
top&#8217;s <code>clk_i</code> signal. This clock signal is used by all internal registers and memories, which trigger on the rising edge of
this clock signal - except for the <a href="#_processor_reset">Processor Reset</a> and the clock switching gate that trigger on a falling edge.
External "clocks" like the OCD&#8217;s JTAG clock or the SDI&#8217;s serial clock are synchronized into the processor&#8217;s clock domain
before being further processed.</p>
</div>
<div class="sect3">
<h4 id="_clock_gating">2.3.1. Clock Gating</h4>
<div class="paragraph">
<p>The single clock domain of the processor can be split into an always-on clock domain and a switchable clock domain.
The switchable clock domain is used to clock the CPU core, the CPU&#8217;s bus switch and - if implemented - the caches.
This domain can be deactivated to reduce power consumption. The always-on clock domain is used to clock all other
processor modules like peripherals, memories and IO devices. Hence, these modules can continue operation (e.g. a
timer keeps running) even if the CPU is shut down.</p>
</div>
<div class="paragraph">
<p>The splitting into two clock domain is enabled by the <code>CLOCK_GATING_EN</code> generic (<a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
When enabled, a generic clock switching gate is added to decouple the switchable clock from the always-on clock domain
(VHDL file <code>neorv32_clockgate.vhd</code>). Whenever the CPU enters <a href="#_sleep_mode">Sleep Mode</a> the CPU clock domain ist shut down.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Clock Switch Hardware</div>
By default, a generic clock gate is used (<code>rtl/core/neorv32_clockgate.vhd</code>) to shut down the CPU clock.
Especially for FPGA setups it is highly recommended to replace this default version by a technology-specific primitive
or macro wrapper to improve efficiency (clock skew, global clock tree usage, etc.).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_peripheral_clocks">2.3.2. Peripheral Clocks</h4>
<div class="paragraph">
<p>Many processor modules like the UARTs or the timers provide a programmable time base for operations. In order to simplify
the hardware, the processor implements a global "clock generator" that provides <em>clock enables</em> for certain frequencies that
are derived from the man clock. Hence, these clock enable signals are synchronous to the system&#8217;s main clock and will be high
for only a single cycle. The processor modules can use these enables for sub-main-clock operations while still providing a single
clock domain only.</p>
</div>
<div class="paragraph">
<p>In total, 8 sub-main-clock signals are available. All processor modules, which feature a time-based configuration, provide a
programmable three-bit prescaler select in their control register to select one of the 8 available clocks. The
mapping of the prescaler select bits to the according clock source is shown in the table below. Here, <em>f</em> represents the
processor main clock from the top entity&#8217;s <code>clk_i</code> signal.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prescaler bits:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b010</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b011</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b101</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b110</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting clock:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/8</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/64</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/128</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/1024</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2048</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4096</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Power Saving</div>
If no peripheral modules requires a clock signal from the internal clock generator (all according modules are disabled by
clearing the enable bit in the according module&#8217;s control register) the generator is automatically deactivated to reduce
dynamic power consumption.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_reset">2.4. Processor Reset</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Processor Reset Signal</div>
Always make sure to connect the processor&#8217;s reset signal <code>rstn_i</code> to a valid reset source (a button, the "locked"
signal of a PLL, a dedicated reset controller, etc.).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The processor-wide reset can be triggered by any of the following sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the asynchronous low-active <code>rstn_i</code> top entity input signal</p>
</li>
<li>
<p>the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
<li>
<p>the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Reset Cause</div>
The actual reset cause can be determined via the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If any of these sources trigger a reset, the internal reset will be triggered for at least 4 clock cycles ensuring
a valid reset of the entire processor. The internal global reset is asserted <em>aysynchronoulsy</em> if triggered by the external
<code>rstn_i</code> signal. For internal reset sources, the global reset is asserted <em>synchronously</em>. If the reset cause gets inactive
the internal reset is de-asserted <em>synchronously</em> at a falling clock edge.</p>
</div>
<div class="paragraph">
<p>Internally, <strong>all registers</strong> that are not meant for mapping to blockRAM (like the register file) do provide a dedicated and
low-active <strong>asynchronous hardware reset</strong>. This asynchronous reset ensures that the entire processor logic is reset to a
defined state even if the main clock is not operational yet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The system reset will only reset the control registers of each implemented IO/peripheral module. This control register
reset will also reset the according "module enable flag" to zero, which - in turn - will cause a <em>synchronous</em>
module-internal reset of the remaining logic.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_interrupts">2.5. Processor Interrupts</h3>
<div class="paragraph">
<p>The NEORV32 Processor provides several interrupt request signals (IRQs) for custom platform use.</p>
</div>
<div class="sect3">
<h4 id="_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</h4>
<div class="paragraph">
<p>The processor setup features the standard machine-level RISC-V interrupt lines for "machine timer interrupt", "machine
software interrupt" and "machine external interrupt". Their usage is defined by the RISC-V privileged architecture
specifications. However, bare-metal system can also repurpose these interrupts. See CPU section
<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine timer interrupt from <em>processor-external</em> MTIME unit (<code>MTI</code>). This IRQ is only available if the processor-internal <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> unit is not implemented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine software interrupt (<code>MSI</code>). This interrupt is used for inter-processor interrupts in multi-core systems. However, it can also be used for any custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine external interrupt (<code>MEI</code>). This interrupt is used for any processor-external interrupt source (like a platform interrupt controller).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
The RISC-V standard interrupts are <strong>level-triggered and high-active</strong>. Once set, the signal has to remain high until
the interrupt request is explicitly acknowledged (e.g. writing to a memory-mapped register). The RISC-V standard interrupts
<strong>CANNOT</strong> be acknowledged/cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</h4>
<div class="paragraph">
<p>As part of the NEORV32-specific CPU extensions, the processor core features 16 fast interrupt request signals
(<code>FIRQ0</code> - <code>FIRQ15</code>) providing dedicated bits in the <a href="#_mip"><strong><code>mip</code></strong></a> and <a href="#_mie"><strong><code>mie</code></strong></a> CSRs and custom <a href="#_mcause"><strong><code>mcause</code></strong></a> trap codes.
The FIRQ signals are reserved for <em>processor-internal</em> modules only (for example for the communication
interfaces to signal "available incoming data" or "ready to send new data").</p>
</div>
<div class="paragraph">
<p>The mapping of the 16 FIRQ channels to the according processor-internal modules is shown in the following
table (the channel number also corresponds to the according FIRQ priority: 0 = highest, 15 = lowest):</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 6. NEORV32 Fast Interrupt Request (FIRQ) Mapping</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Channel</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">WDT</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timeout interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">CFS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom functions subsystem (CFS) interrupt (user-defined)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 TX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 TX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">SPI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">TWI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI transmission done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_external_interrupt_controller_xirq">XIRQ</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">NEOLED</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED TX buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_direct_memory_access_controller_dma">DMA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA transfer done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_data_interface_controller_sdi">SDI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDI interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">GPTMR</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_one_wire_serial_interface_controller_onewire">ONEWIRE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire operation done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">SLINK</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK FIFO level interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_true_random_number_generator_trng">TRNG</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG FIFO level interrupt</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
The fast interrupt request channels become pending after being triggering by one-cycle-high signal.
A pending FIRQ has to be explicitly cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_address_space">2.6. Address Space</h3>
<div class="paragraph">
<p>As a 32-bit architecture the NEORV32 can access a 4GB physical address space. By default, this address space is
split into six main regions. Each region provides specific <em>physical memory attributes</em> ("PMAs") that define
the access capabilities (<code>rwxac</code>; <code>r</code> = read permission, <code>w</code> = write permission, <code>x</code> - execute permission,
<code>a</code> = atomic access support, <code>c</code> = cached CPU access).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/address_space.png" alt="900">
</div>
<div class="title">Figure 2. NEORV32 Processor Address Space (Default Configuration)</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 7. Main Address Regions</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#</th>
<th class="tableblock halign-center valign-top">Region</th>
<th class="tableblock halign-center valign-top">PMAs</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Internal IMEM address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwxac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For instructions (=code) and constants; mapped to the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Internal DMEM address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwxac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For application runtime data (heap, stack, etc.); mapped to the internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Memory-mapped XIP flash</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r-xac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory-mapped access to the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> SPI flash.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bootloader address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r-xa-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read-only memory for the internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> containing the default <a href="#_bootloader">Bootloader</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IO/peripheral address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwxa-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal peripherals / IO devices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">The "<strong>void</strong>"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwxac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unmapped address space. All accesses to this region(s) are redirected to the <a href="#_processor_external_memory_interface_wishbone">Processor-External Memory Interface (WISHBONE)</a> (if implemented).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Custom PMAs</div>
Physical memory attributes can be customized (constrained) using the CPU&#8217;s <a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU can access all of the 32-bit address space from the instruction fetch interface and also from the data access
interface. Both interfaces can be equipped with optional caches (<a href="#_processor_internal_data_cache_dcache">Processor-Internal Data Cache (dCACHE)</a> and
<a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a>). The two CPU interfaces are multiplexed by a simple bus switch into
a single processor-internal bus. Optionally, this bus is further switched by another instance of the bus switch so the
<a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a> controller can also access the entire address space. Accesses via the
resulting SoC bus are split by the <a href="#_bus_gateway">Bus Gateway</a> that redirects accesses to the according main address regions.
Accesses to the processor-internal IO/peripheral devices are further redirected via a dedicated <a href="#_io_switch">IO Switch</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_bus.png" alt="1300">
</div>
<div class="title">Figure 3. Processor-Internal Bus Architecture</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bus Interface</div>
See sections CPU <a href="#_architecture">Architecture</a> and <a href="#_bus_interface">Bus Interface</a> for more information regarding the CPU bus accesses.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_bus_gateway">2.6.1. Bus Gateway</h4>
<div class="paragraph">
<p>The central bus gateway serves two purposes: <strong>redirect</strong> core accesses to the according modules (e.g. memory accesses
vs. memory-mapped IO accesses) and <strong>monitor</strong> all bus transactions. The redirection of access request is based on a
customizable memory map implemented via VHDL constants in the main package file (<code>rtl/core/neorv323_package.vhd</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Main Address Regions Configuration in the VHDL Package File</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  -- Main Address Regions ---
  constant mem_imem_base_c : std_ulogic_vector(31 downto 0) := x"00000000"; -- IMEM size via generic
  constant mem_dmem_base_c : std_ulogic_vector(31 downto 0) := x"80000000"; -- DMEM size via generic
  constant mem_xip_base_c  : std_ulogic_vector(31 downto 0) := x"e0000000";
  constant mem_xip_size_c  : natural := 256*1024*1024;
  constant mem_boot_base_c : std_ulogic_vector(31 downto 0) := x"ffffc000";
  constant mem_boot_size_c : natural := 8*1024;
  constant mem_io_base_c   : std_ulogic_vector(31 downto 0) := x"ffffe000";
  constant mem_io_size_c   : natural := 8*1024;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the delegation of bus requests the gateway also implements a bus monitor (aka "the bus keeper") that tracks all
active bus transactions to ensure <em>safe</em> and <em>deterministic</em> operations.</p>
</div>
<div class="paragraph">
<p>Whenever a memory-mapped device is accessed (a real memory, a memory-mapped IO or some processor-external module) the bus
monitor starts an internal timer. The accessed module has to respond ("ACK") to the bus request within a specific
<strong>time window</strong>. This time window is defined by a global constant in the processor&#8217;s VHDL package file
(<code>rtl/core/neorv323_package.vhd</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Internal Bus Timeout Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  constant bus_timeout_c : natural := 15;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This constant defines the <em>maximum</em> number of cycles after which a non-responding bus request (i.e. no <code>ack</code>
and no <code>err</code> signal) will time out raising a bus access fault exception. For example this can happen when accessing
"address space holes" - addresses that are not mapped to any physical module. The resulting exception type corresponds
to the according access type, i.e. instruction fetch access exception, load access exception or store access exception.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">XIP Timeout</div>
Accesses to the memory-mapped XIP flash (via the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a>) will <em>never</em> time out.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">External Bus Interface Timeout</div>
Accesses that are delegated to the external bus interface have a different maximum timeout value that is defined by an
explicit specific processor generic. See section <a href="#_processor_external_memory_interface_wishbone">Processor-External Memory Interface (WISHBONE)</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reservation_set_controller">2.6.2. Reservation Set Controller</h4>
<div class="paragraph">
<p>The reservation set controller is responsible for handling the load-reservate and store-conditional bus transaction that
are triggered by the <code>lr.w</code> (LR) and <code>sc.w</code> (SC) instructions from the CPU&#8217;s <a href="#_a_isa_extension"><code>A</code> ISA Extension</a>.</p>
</div>
<div class="paragraph">
<p>A "reservation" defines an address or address range that provides a guarding mechanism to support atomic accesses. A new
reservation is registered by the LR instruction. The address provided by this instruction defines the memory location
that is now monitored for atomic accesses. The according SC instruction evaluates the state of this reservation. If
the reservation is still valid the write access triggered by the SC instruction is finally executed and the instruction
return a "success" state (<code>rd</code> = 0). If the reservation has been invalidated the SC instruction will not write to memory
and will return a "failed" state (<code>rd</code> = 1).</p>
</div>
<div class="paragraph">
<p>The reservation is invalidated if&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an SC instruction is executed that accesses an address <strong>outside</strong> of the reservation set of the previous LR instruction.
This SC instruction will <strong>fail</strong> (not writing to memory).</p>
</li>
<li>
<p>an SC instruction is executed that accesses an address <strong>inside</strong> of the reservation set of the previous LR instruction.
This SC instruction will <strong>succeed</strong> (finally writing to memory).</p>
</li>
<li>
<p>a normal store operation accesses an address <strong>inside</strong> of the current reservation set (by the CPU or by the DMA).</p>
</li>
<li>
<p>a hardware reset is triggered.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Consecutive LR Instructions</div>
If an LR instruction is followed by another LR instruction the reservation set of the former one is overridden
by the reservation set of the latter one.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bus Access Errors</div>
If the LR operation causes a bus access error (raising a load access exception) the reservation <strong>is registered anyway</strong>.
If the SC operation causes a bus access error (raising a store access exception) an already registered reservation set
<strong>is invalidated anyway</strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Strong Semantic</div>
The LR/SC mechanism follows the <em>strong semantic</em> approach: the LR/SC instruction pair fails only if there is a write
access to the referenced memory location between the LR and SC instructions (by the CPU itself or by the DMA).
Context changes, interrupts, traps, etc. do not effect nor invalidate the reservation state at all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The controller supports only a single global reservation set. By default this reservation set "monitors" a word-aligned
4-byte granule. However, the granularity can be customized via the <code>AMO_RVS_GRANULARITY</code> top entity generic (see
<a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>) to cover an arbitrarily large naturally aligned address region. The only constraint is
that the size of the address region has to be a power of two. The configured granularity can be determined by software via
the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Physical Memory Attributes</div>
The reservation set can be set for <em>any</em> address (only constrained by the configured granularity). This also
includes cached memory, memory-mapped IO devices and processor-external address spaces.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bus transactions triggered by the LR instruction register a new reservation set and are delegated to the adressed
memory/device. Bus transactions triggered by the SC remove a reservation set and are forwarded to the adressed
memory/device only if the SC operations succeeds. Otherwise, the access request is not forwarded and a local ACK is
generated to terminate the bus transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">LR/SC Bus Protocol</div>
More information regarding the LR/SC bus transactions and the the according protocol can be found in section
<a href="#_bus_interface">Bus Interface</a> / <a href="#_atomic_accesses">Atomic Accesses</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Cache Coherency</div>
Atomic operations <strong>always bypass</strong> the cache using direct/uncached accesses. Care must be taken
to maintain data cache coherency (e.g. by using the <code>fence</code> instruction).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_io_switch">2.6.3. IO Switch</h4>
<div class="paragraph">
<p>The IO switch further decodes the address when accessing the processor-internal IO/peripheral devices and forwards
the access request to the according module. Note that a total address space size of 256 bytes is assigned to each
IO module in order to simplify address decoding. The IO-specific address map is also defined in the main VHDL
package file (<code>rtl/core/neorv323_package.vhd</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Exemplary Cut-Out from the IO Address Map</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  -- IO Address Map --
  constant iodev_size_c    : natural := 256; -- size of a single IO device (bytes)
  constant base_io_cfs_c   : std_ulogic_vector(31 downto 0) := x"ffffeb00";
  constant base_io_slink_c : std_ulogic_vector(31 downto 0) := x"ffffec00";
  constant base_io_dma_c   : std_ulogic_vector(31 downto 0) := x"ffffed00";</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boot_configuration">2.6.4. Boot Configuration</h4>
<div class="paragraph">
<p>Due to the flexible memory configuration, the NEORV32 Processor provides several different boot scenarios.
The following section illustrates the two most common boot scenarios.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_boot_configurations.png" alt="800">
</div>
<div class="title">Figure 4. NEORV32 Boot Configurations</div>
</div>
<div class="paragraph">
<p>There are two general boot scenarios: <em>Indirect Boot</em> (1a and 1b) and <em>Direct Boot</em> (2a and 2b) configured via the
<code>INT_BOOTLOADER_EN</code> generic. If this generic is <code>true</code> the <em>indirect boot scenario</em> is used. This is also the
default boot configuration of the processor. If <code>INT_BOOTLOADER_EN</code> is <code>*false</code> the <em>direct boot scenario</em> is used.</p>
</div>
<div class="sect4">
<h5 id="_indirect_boot">Indirect Boot</h5>
<div class="paragraph">
<p>The indirect_boot scenarios <strong>1a</strong> and <strong>1b</strong> are based on the processor-internal <a href="#_bootloader">Bootloader</a>. This boot setup is enabled
by setting the <code>INT_BOOTLOADER_EN</code> generic to <code>true</code>, which will implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a>.
This read-only memory is pre-initialized during synthesis with the default bootloader firmware. The bootloader provides several
options to upload an executable copying it to the beginning of the <em>instruction address space</em> so the CPU can execute it.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>1a</strong> uses the processor-internal IMEM. This scenario implements the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a>
as non-initialized RAM so the bootloader can copy the actual executable to it.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>1b</strong> uses a processor-external IMEM that is connected via the processor&#8217;s bus interface. In this scenario
the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is not implemented at all and the bootloader will copy the executable to the
processor-external memory. Hence, the external memory has to be implemented as RAM.</p>
</div>
</div>
<div class="sect4">
<h5 id="_direct_boot">Direct Boot</h5>
<div class="paragraph">
<p>The direct boot scenarios <strong>2a</strong> and <strong>2b</strong> do not use the processor-internal bootloader since the <code>INT_BOOTLOADER_EN</code>
generic is set <code>false</code>. In this configuration the <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is not implemented at all and the CPU will
directly begin executing code from the beginning of the instruction address space after reset. An application-specific
"pre-initialization" mechanism is required in order to provide an executable inside the memory.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>2a</strong> uses the processor-internal IMEM implemented as <em>read-only memory</em> in this scenario.
It is pre-initialized (by the bitstream) with the actual application executable during synthesis.</p>
</div>
<div class="paragraph">
<p>In contrast, boot scenario <strong>2b</strong> uses a processor-external IMEM. In this scenario the system designer is responsible for
providing an initialized external memory that contains the actual application to be executed.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_internal_modules">2.7. Processor-Internal Modules</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Module Address Space Mapping</div>
The base address of each component/module has to be aligned to the total size of the module&#8217;s occupied address space.
The occupied address space has to be a power of two (minimum 4 bytes). Addresses of peripheral modules must not overlap.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Full-Word Write Accesses Only</div>
All peripheral/IO devices should only be written in full-word mode (i.e. 32-bit). Byte or half-word (8/16-bit) write accesses
might cause undefined behavior.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">IO Module&#8217;s Address Space</div>
Each peripheral/IO module occupies an address space of 256 bytes (64 words). Most devices do not fully utilize this address
space and will simply <em>mirror</em> the available interface registers across the entire 256 bytes of address space.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unimplemented Modules / Address Holes</div>
When accessing an IO device that hast not been implemented (disabled via the according generic)
or when accessing an address that is actually unused, a load/store access fault exception is raised.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Module Interrupts</div>
Most peripheral/IO devices provide some kind of interrupt (for example to signal available incoming data). These
interrupts are entirely mapped to the CPU&#8217;s <a href="#_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</a>.
See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CMSIS System Description View (SVD)</div>
A CMSIS-SVD-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_instruction_memory_imem">2.7.1. Instruction Memory (IMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_imem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_imem.legacy.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alternative legacy-style memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_IMEM_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal IMEM when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_IMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM size in bytes (use a power of 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT_BOOTLOADER_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use internal bootloader when <code>true</code> (implements IMEM as <em>uninitialized</em> RAM, otherwise the IMEM is implemented an <em>pre-intialized</em> ROM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Implementation of the processor-internal instruction memory is enabled by the processor&#8217;s
<code>MEM_INT_IMEM_EN</code> generic. The total memory size in bytes is defined via the <code>MEM_INT_IMEM_SIZE</code> generic.
Note that this size should be a power of two to optimize physical implementation. If the IMEM is implemented,
it is mapped to base address <code>0x00000000</code> by default (see section <a href="#_address_space">Address Space</a>).</p>
</div>
<div class="paragraph">
<p>By default the IMEM is implemented as true RAM so the content can be modified during run time. This is
required when using the bootloader (or the on-chip debugger) so it can update the content of the IMEM at
any time. If this feature is not required the IMEM can be implemented as <em>pre-intialized</em> ROM so that the
application code permanently resides in memory. This is automatically implemented when the
processor-internal bootloader is disabled (<code>INT_BOOTLOADER_EN</code> = <code>false</code>).</p>
</div>
<div class="paragraph">
<p>When the IMEM is implemented as ROM, it will be initialized during synthesis with the actual application program
image. The compiler toolchain provides an option to generate and override the default VHDL initialization file
<code>rtl/core/neorv32_application_image.vhd</code>, which is automatically inserted into the IMEM. If the IMEM is implemented
as RAM (default), the memory block will <strong>not be initialized at all</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Memory Size</div>
If the configured memory size (via the <code>MEM_INT_IMEM_SIZE</code> generic) is <strong>not</strong> a power of two the actual memory
size will be auto-adjusted to the next power of two (e.g. configuring a memory size of 60kB will result in a
physical memory size of 64kB).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">VHDL Source File</div>
The actual IMEM is split into two design files: a plain entity definition (<code>neorv32_imem.entity.vhd</code>) and the actual
architecture definition <code>mem/neorv32_imem.default.vhd</code>. This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that infers embedded memory blocks (blockRAM). The default architecture can
be replaced by platform-specific modules in order to use platform-specific features or to improve technology mapping
and/or timing. A "legacy-style" memory architecture is provided in <code>rtl/mem</code> that can be used if the synthesis does
not correctly infer blockRAMs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read-Only Access</div>
If the IMEM is implemented as true ROM any write attempt to it will raise a <em>store access fault</em> exception.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_data_memory_dmem">2.7.2. Data Memory (DMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dmem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_dmem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_dmem.legacy.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alternative legacy-style memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_DMEM_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal DMEM when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_INT_DMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM size in bytes (use a power of 2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Implementation of the processor-internal data memory is enabled by the processor&#8217;s <code>MEM_INT_DMEM_EN</code>
generic. The total memory size in bytes is defined via the <code>MEM_INT_DMEM_SIZE</code> generic. Note that this
size should be a power of two to optimize physical implementation. If the DMEM is implemented,
it is mapped to base address <code>0x80000000</code> by default (see section <a href="#_address_space">Address Space</a>).
The DMEM is always implemented as true RAM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Memory Size</div>
If the configured memory size (via the <code>MEM_INT_IMEM_SIZE</code> generic) is <strong>not</strong> a power of two the actual memory
size will be auto-adjusted to the next power of two (e.g. configuring a memory size of 60kB will result in a
physical memory size of 64kB).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">VHDL Source File</div>
The actual DMEM is split into two design files: a plain entity definition <code>neorv32_dmem.entity.vhd</code> and the actual
architecture definition <code>mem/neorv32_dmem.default.vhd</code>. This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that infers embedded memory blocks (blockRAM). The default architecture can
be replaced by platform-specific modules in order to use platform-specific features or to improve technology mapping
and/or timing. A "legacy-style" memory architecture is provided in <code>rtl/mem</code> that can be used if the synthesis does
not correctly infer blockRAMs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Execute from RAM</div>
The CPU is capable of executing code also from arbitrary data memory.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_bootloader_rom_bootrom">2.7.3. Bootloader ROM (BOOTROM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_boot_rom.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT_BOOTLOADER_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal bootloader when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This boot ROM module provides a read-only memory that contain the executable image of the default NEORV32
<a href="#_bootloader">Bootloader</a>. If the internal bootloader is enabled via the <code>INT_BOOTLOADER_EN</code> generic the CPU&#8217;s boot address
is automatically set to the beginning of the bootloader ROM. See sections <a href="#_address_space">Address Space</a> and
<a href="#_boot_configuration">Boot Configuration</a> for more information regarding the processor&#8217;s different boot scenarios.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Memory Size</div>
If the configured boot ROM size is <strong>not</strong> a power of two the actual memory size will be auto-adjusted to
the next power of two (e.g. configuring a memory size of 6kB will result in a physical memory size of 8kB).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bootloader Image</div>
The boot ROM is initialized during synthesis with the default bootloader image
(<code>rtl/core/neorv32_bootloader_image.vhd</code>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_internal_instruction_cache_icache">2.7.4. Processor-Internal Instruction Cache (iCACHE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_icache.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal instruction cache when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks (pages/lines)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ICACHE_ASSOCIATIVITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">associativity / number of sets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The processor features an optional instruction cache to improve performance when using memories with high
access latencies. The cache is directly connected to the CPU&#8217;s instruction fetch interface and provides
full-transparent buffering of instruction fetch accesses to the <strong>entire address space</strong>.</p>
</div>
<div class="paragraph">
<p>The cache is implemented if the <code>ICACHE_EN</code> generic is <code>true</code>. The size of the cache memory is defined via
<code>ICACHE_BLOCK_SIZE</code> (the size of a single cache block/page/line in bytes; has to be a power of two and greater than or
equal to 4 bytes), <code>ICACHE_NUM_BLOCKS</code> (the total amount of cache blocks; has to be a power of two and greater than or
equal to 1) and the actual cache associativity <code>ICACHE_ASSOCIATIVITY</code> (number of sets; 1 = direct-mapped, 2 = 2-way
set-associative) generics. If the cache associativity is greater than one the LRU replacement policy (least recently
used) is used.</p>
</div>
<div class="paragraph">
<p><strong>Cached/Uncached Accesses</strong></p>
</div>
<div class="paragraph">
<p>The data cache provides direct accesses (= uncached) to memory in order to access memory-mapped IO (like the
processor-internal IO/peripheral modules). All accesses that target the address range from <code>0xF0000000</code> to <code>0xFFFFFFFF</code>
will not be cached at all (see section <a href="#_address_space">Address Space</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Caching Internal Memories</div>
The instruction cache is intended to accelerate instruction fetches from <strong>processor-external</strong> memories
(via the external bus interface or via the XIP module). The cache(s) should not be implemented
when using only processor-internal data and instruction memories.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manual Cache Clear/Reload</div>
By executing the <code>fence(.i)</code> instruction the cache is cleared and a reload from main memory is triggered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Cache Configuration from Software</div>
Software can retrieve the cache configuration/layout from the <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bus Access Fault Handling</div>
The cache always loads a complete cache block (aligned to the block size) every time a
cache miss is detected. Each cached word from this block provides a single status bit that indicates if the
according bus access was successful or caused a bus error. Hence, the whole cache block remains valid even
if certain addresses inside caused a bus error. If the CPU accesses any of the faulty cache words, an
instruction bus error exception is raised.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_internal_data_cache_dcache">2.7.5. Processor-Internal Data Cache (dCACHE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dcache.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal data cache when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks (pages/lines)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DCACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The processor features an optional data cache to improve performance when using memories with high
access latencies. The cache is directly connected to the CPU&#8217;s data access interface and provides
full-transparent buffering.</p>
</div>
<div class="paragraph">
<p>The cache is implemented if the <code>DCACHE_EN</code> generic is <code>true</code>. The size of the cache memory is defined via the
<code>DCACHE_BLOCK_SIZE</code> (the size of a single cache block/page/line in bytes; has to be a power of two and greater than or
equal to 4 bytes) and <code>DCACHE_NUM_BLOCKS</code> (the total amount of cache blocks; has to be a power of two and greater than or
equal to 1) generics. The data cache provides only a single set, hence it is direct-mapped.</p>
</div>
<div class="paragraph">
<p><strong>Cached/Uncached Accesses</strong></p>
</div>
<div class="paragraph">
<p>The data cache provides direct accesses (= uncached) to memory in order to access memory-mapped IO (like the
processor-internal IO/peripheral modules). All accesses that target the address range from <code>0xF0000000</code> to <code>0xFFFFFFFF</code>
will not be cached at all (see section <a href="#_address_space">Address Space</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Caching Internal Memories</div>
The data cache is intended to accelerate data access to <strong>processor-external</strong> memories
(via the external bus interface or via the XIP module). The cache(s) should not be implemented
when using only processor-internal data and instruction memories.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manual Cache Clear/Reload</div>
By executing the <code>fence(.i)</code> instruction the cache is cleared and a reload from main memory is triggered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Cache Configuration from Software</div>
Software can retrieve the cache configuration/layout from the <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bus Access Fault Handling</div>
The cache always loads a complete cache block (aligned to the block size) every time a
cache miss is detected. Each cached word from this block provides a single status bit that indicates if the
according bus access was successful or caused a bus error. Hence, the whole cache block remains valid even
if certain addresses inside caused a bus error. If the CPU accesses any of the faulty cache words, a
data bus error exception is raised.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_direct_memory_access_controller_dma">2.7.6. Direct Memory Access Controller (DMA)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dma.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_DMA_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement DMA when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA transfer done (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 DMA provides a small-scale scatter/gather direct memory access controller that allows to transfer and
modify data independently of the CPU. A single read/write transfer channel is implemented that is configured via
memory-mapped registers. a configured transfer can either be triggered manually or by a programmable CPU FIRQ interrupt
(see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a>).</p>
</div>
<div class="paragraph">
<p>The DMA is connected to the central processor-internal bus system (see section <a href="#_address_space">Address Space</a>) and can access the same
address space as the CPU core. It uses <em>interleaving mode</em> accessing the central processor bus only if the CPU does not
currently request and bus access.</p>
</div>
<div class="paragraph">
<p>The controller can handle different data quantities (e.g. read bytes and write them back as sign-extend words) and can
also change the Endianness of data while transferring.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DMA Demo Program</div>
A DMA example program can be found in <code>sw/example/demo_dma</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The DMA provides four memory-mapped interface registers: A status and control register <code>CTRL</code> and three registers for
configuring the actual DMA transfer. The base address of the source data is programmed via the <code>SRC_BASE</code> register.
Vice versa, the base address of the destination data is programmed via the <code>DST_BASE</code>. The third configuration register
<code>TTYPE</code> is use to configure the actual transfer type and the number of elements to transfer.</p>
</div>
<div class="paragraph">
<p>The DMA is enabled by setting the <code>DMA_CTRL_EN</code> bit of the control register. Manual trigger mode (i.e. the DMA transfer is
triggered by writing to the <code>TTYPE</code> register) is selected if <code>DMA_CTRL_AUTO</code> is cleared. Alternatively, the DMA transfer can
be triggered by a processor internal FIRQ signal if <code>DMA_CTRL_AUTO</code> is set (see section below).</p>
</div>
<div class="paragraph">
<p>The DMA uses a load-modify-write data transfer process. Data is read from the bus system, internally modified and then written
back to the bus system. This combination is implemented as an atomic progress, so canceling the current transfer by clearing the
<code>DMA_CTRL_EN</code> bit will stop the DMA right after the current load-modify-write operation.</p>
</div>
<div class="paragraph">
<p>If the DMA controller detects a bus error during operation, it will set either the <code>DMA_CTRL_ERROR_RD</code> (error during
last read access) or <code>DMA_CTRL_ERROR_WR</code> (error during last write access) and will terminate the current transfer.
Software can read the <code>SRC_BASE</code> or <code>DST_BASE</code> register to retrieve the address that caused the according error.
Alternatively, software can read back the <code>NUM</code> bits of the control register to determine the index of the element
that caused the error. The error bits are automatically cleared when starting a new transfer.</p>
</div>
<div class="paragraph">
<p>When the <code>DMA_CTRL_DONE</code> flag is set the DMA has actually executed a transfer. However, the <code>DMA_CTRL_ERROR_*</code> flags
should also be checked to verify that the executed transfer completed without errors. The <code>DMA_CTRL_DONE</code> flag is
automatically cleared when writing the <code>CTRL</code> register.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">DMA Access Privilege Level</div>
Transactions performed by the DMA are executed as bus transactions with elevated <strong>machine-mode</strong> privilege level.
Additionally, all physical memory protection rules (<a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a>) defined by the CPU are <strong>bypassed</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Transfer Configuration</strong></p>
</div>
<div class="paragraph">
<p>If the DMA is set to <strong>manual trigger mode</strong> (<code>DMA_CTRL_AUTO</code> = 0) writing the <code>TTRIG</code> register will start the
programmed DMA transfer. Once started, the DMA will read one data quantity from the source address, processes it internally
and then will write it back to the destination address. The <code>DMA_TTYPE_NUM</code> bits of the <code>TTYPE</code> register define how many
times this process is repeated by specifying the number of elements to transfer.</p>
</div>
<div class="paragraph">
<p>Optionally, the source and/or destination addresses can be increments according to the data quantities
automatically by setting the according <code>DMA_TTYPE_SRC_INC</code> and/or <code>DMA_TTYPE_DST_INC</code> bit.</p>
</div>
<div class="paragraph">
<p>Four different transfer quantities are available, which are configured via the <code>DMA_TTYPE_QSEL</code> bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>00</code>: Read source data as byte, write destination data as byte</p>
</li>
<li>
<p><code>01</code>: Read source data as byte, write destination data as zero-extended word</p>
</li>
<li>
<p><code>10</code>: Read source data as byte, write destination data as sign-extended word</p>
</li>
<li>
<p><code>11</code>: Read source data as word, write destination data as word</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally, the DMA controller can automatically convert Endianness of the transferred data if the <code>DMA_TTYPE_ENDIAN</code>
bit is set.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Address Alignment</div>
Make sure to align the source and destination base addresses to the according transfer data quantities. For instance,
word-to-word transfers require that the two LSB of <code>SRC_BASE</code> and <code>DST_BASE</code> are cleared.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Writing to IO Device</div>
When writing data to IO / peripheral devices (for example to the <a href="#_cyclic_redundancy_check_crc">Cyclic Redundancy Check (CRC)</a>) the destination
data quantity has to be set to <strong>word</strong> (32-bit) since all IO registers can only be written in full 32-bit word mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Automatic Trigger</strong></p>
</div>
<div class="paragraph">
<p>As an alternative to the manual trigger mode, the DMA can be configured to <strong>automatic trigger mode</strong> starting a pre-configured
transfer if a specific processor-internal peripheral issues an interrupt request. The automatic trigger mode is enabled by
setting the <code>CTRL</code> register&#8217;s <code>DMA_CTRL_AUTO</code> bit. In this configuration <em>no</em> transfer is started when writing to the DMA&#8217;s
<code>TTYPE</code> register.</p>
</div>
<div class="paragraph">
<p>The actual trigger is configured via the control register <code>DMA_CTRL_FIRQ_MASK</code>. These bits reflect the state of the CPU&#8217;s
<a href="#_mip"><strong><code>mip</code></strong></a> CSR showing any pending fast interrupt requests (for a full list see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a>).
The same bit definitions/locations as for the <a href="#_mip"><strong><code>mip</code></strong></a> and <a href="#_mie"><strong><code>mie</code></strong></a> CPU CSRs are used.
If any of the enabled sources issues an interrupt the DMA will start the pre-configured transfer (note that all enabled
sources are logically OR-ed).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">FIRQ Trigger</div>
The DMA transfer will start if a <strong>rising edge</strong> is detected on <em>any</em> of the enabled FIRQ source channels.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Memory Barrier / Fence Operation</strong></p>
</div>
<div class="paragraph">
<p>Optionally, the DMA can issue a FENCE request to the downstream memory system when a transfer has been completed
without errors. This can be used to re-sync caches (flush and reload) and buffers to maintain data coherency.
This automatic fencing is enabled by the setting the control register&#8217;s <code>DMA_CTRL_FENCE</code> bit.</p>
</div>
<div class="paragraph">
<p><strong>DMA Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The DMA features a single CPU interrupt that is triggered when the programmed transfer has completed. This
interrupt is also triggered if the DMA encounters a bus error during operation. An active DMA interrupt has to be
explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. DMA Register Map (<code>struct NEORV32_DMA</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xffffed00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>DMA_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>DMA_CTRL_AUTO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable automatic mode (FIRQ-triggered)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>DMA_CTRL_FENCE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issue a downstream FENCE operation when DMA transfer completes (without errors)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:3</code>   <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>     <code>DMA_CTRL_ERROR_RD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error during read access, clears when starting a new transfer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code>     <code>DMA_CTRL_ERROR_WR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error during write access, clears when starting a new transfer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>    <code>DMA_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMA transfer in progress</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>    <code>DMA_CTRL_DONE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if a transfer was executed; auto-clears on write-access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:12</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:16</code> <code>DMA_CTRL_FIRQ_MASK_MSB : DMA_CTRL_FIRQ_MASK_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIRQ trigger mask (same bits as in <a href="#_mip"><strong><code>mip</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffed04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SRC_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source base address (shows the last-accessed source address when read)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffed08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DST_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination base address (shows the last-accessed destination address when read)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffed0c</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>TTYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:0</code>  <code>DMA_TTYPE_NUM_MSB : DMA_TTYPE_NUM_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of elements to transfer (shows the last-transferred element index when read)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:24</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:27</code> <code>DMA_TTYPE_QSEL_MSB : DMA_TTYPE_QSEL_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source data quantity select (<code>00</code> = byte, <code>01</code> = half-word, <code>10</code> = word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>DMA_TTYPE_SRC_INC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant (<code>0</code>) or incrementing (<code>1</code>) source address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>DMA_TTYPE_DST_INC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant (<code>0</code>) or incrementing (<code>1</code>) destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>DMA_TTYPE_ENDIAN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swap Endianness when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_external_memory_interface_wishbone">2.7.7. Processor-External Memory Interface (WISHBONE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wishbone.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request tag output (3-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable (4-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus error (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fencei_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence.i</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable external memory interface when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_TIMEOUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of clock cycles after which an unacknowledged external bus access will auto-terminate (0 = disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_PIPE_MODE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when <code>false</code> (default): classic/standard Wishbone protocol; when <code>true</code>: pipelined Wishbone protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_BIG_ENDIAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte-order (Endianness) of external memory interface; <code>true</code>=BIG, <code>false</code>=little (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_ASYNC_RX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use registered RX path when <code>false</code> (default); use async/direct RX path when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM_EXT_ASYNC_TX_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use registered TX path when <code>false</code> (default); use async/direct TX path when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The external memory interface provides a Wishbone b4-compatible on-chip bus interface. The bus interface is
implemented if the <code>MEM_EXT_EN</code> generic is <code>true</code>. This interface can be used to attach external memories,
custom hardware accelerators, additional IO devices or all other kinds of IP blocks.</p>
</div>
<div class="paragraph">
<p>The external interface is not mapped to a specific address space. Instead, all CPU memory accesses that
do not target a specific processor-internal address region (accessing the "void"; see section <a href="#_address_space">Address Space</a>)
are redirected to the external memory interface.</p>
</div>
<div class="paragraph">
<p><strong>Wishbone Bus Protocol</strong></p>
</div>
<div class="paragraph">
<p>The external memory interface either uses the <strong>standard</strong> (also called "classic") Wishbone protocol (default) or
<strong>pipelined</strong> Wishbone protocol. The protocol to be used is configured via the <code>MEM_EXT_PIPE_MODE</code> generic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>MEM_EXT_PIPE_MODE</code> is <code>false</code>, all bus control signals including <code>wb_stb_o</code> are active and remain stable until the
transfer is acknowledged/terminated.</p>
</li>
<li>
<p>If <code>MEM_EXT_PIPE_MODE</code> is <code>true</code>, all bus control except <code>wb_stb_o</code> are active and remain until the transfer is
acknowledged/terminated. In this case, <code>wb_stb_o</code> is asserted only during the very first bus clock cycle.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 9. Exemplary Wishbone bus accesses using "classic" and "pipelined" protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_classic_read.png" alt="700" width="300">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_pipelined_write.png" alt="700" width="300">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Classic</strong> Wishbone read access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Pipelined</strong> Wishbone write access</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the Wishbone interface is configured to operate in classic/standard mode (<code>MEM_EXT_PIPE_MODE</code> = false) a
<strong>sync</strong> RX path (<code>MEM_EXT_ASYNC_RX</code> = false) is required for the inter-cycle pause. If <code>MEM_EXT_ASYNC_RX</code> is
enabled while <code>MEM_EXT_PIPE_MODE</code> is disabled the module will automatically disable the asynchronous RX option.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Wishbone Specs.</div>
A detailed description of the implemented Wishbone bus protocol and the according interface signals
can be found in the data sheet "Wishbone B4 - WISHBONE System-on-Chip (SoC) Interconnection
Architecture for Portable IP Cores". A copy of this document can be found in the <code>docs</code> folder of this
project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Bus Access</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 Wishbone gateway does not support burst transfers yet, so there is always just a single transfer "in fly".
Hence, the Wishbone <code>STALL</code> signal is not implemented. An accessed Wishbone device does not have to respond immediately to a bus
request by sending an ACK. Instead, there is a <em>time window</em> where the device has to acknowledge the transfer. This time window
s configured by the <code>MEM_EXT_TIMEOUT</code> generic that defines the maximum time (in clock cycles) a bus access can be pending
before it is automatically terminated with an error condition. If <code>MEM_EXT_TIMEOUT</code> is set to zero, the timeout is disabled
and a bus access can take an arbitrary number of cycles to complete (this is not recommended!).</p>
</div>
<div class="paragraph">
<p>When <code>MEM_EXT_TIMEOUT</code> is greater than zero, the Wishbone gateway starts an internal countdown whenever the CPU
accesses an address via the external memory interface. If the accessed device does not acknowledge (via <code>wb_ack_i</code>)
or terminate (via <code>wb_err_i</code>) the transfer within <code>MEM_EXT_TIMEOUT</code> clock cycles, the bus access is automatically canceled
setting <code>wb_cyc_o</code> low again and a CPU load/store/instruction fetch bus access fault exception is raised.</p>
</div>
<div class="paragraph">
<p><strong>Wishbone Tag</strong></p>
</div>
<div class="paragraph">
<p>The 3-bit wishbone <code>wb_tag_o</code> signal provides additional information regarding the access type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wb_tag_o(0)</code>: <code>1</code> = privileged access (CPU is in machine mode); <code>0</code> = unprivileged access (CPU is not in machine mode)</p>
</li>
<li>
<p><code>wb_tag_o(1)</code>: always zero</p>
</li>
<li>
<p><code>wb_tag_o(2)</code>: <code>1</code> = instruction fetch access, <code>0</code> = data access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Endianness</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 CPU and the Processor setup are <strong>little-endian</strong> architectures. To allow direct connection
to a big-endian memory system the external bus interface provides an Endianness configuration. The
Endianness of the external memory interface can be configured via the <code>MEM_EXT_BIG_ENDIAN</code> generic.
By default, the external memory interface uses little-endian byte-order.</p>
</div>
<div class="paragraph">
<p>Application software can check the Endianness configuration of the external bus interface via the
SYSINFO module (see section <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> for more information).</p>
</div>
<div class="paragraph">
<p><strong>Access Latency</strong></p>
</div>
<div class="paragraph">
<p>By default, the Wishbone gateway introduces two additional latency cycles: processor-outgoing (<code>*_o</code>) and
processor-incoming (<code>*_i</code>) signals are fully registered. Thus, any access from the CPU to a processor-external devices
via Wishbone requires 2 additional clock cycles. This can ease timing closure when using large (combinatorial) Wishbone
interconnection networks.</p>
</div>
<div class="paragraph">
<p>Optionally, the latency of the Wishbone gateway can be reduced by removing the input and output register stages.
Enabling the <code>MEM_EXT_ASYNC_RX</code> option will remove the input register stage; enabling <code>MEM_EXT_ASYNC_TX</code> option will
remove the output register stages. Each enabled option reduces access latency by 1 cycle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Output Gating</div>
All outgoing Wishbone signals use a "gating mechanism" so they only change if there is a actual Wishbone transaction being in
progress. This can reduce dynamic switching activity in the external bus system and also simplifies simulation-based
inspection of the Wishbone transactions. Note that this output gating is only available if the output register buffer is not
disabled (<code>MEM_EXT_ASYNC_TX</code> = <code>false</code>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface_slink">2.7.8. Stream Link Interface (SLINK)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data valid (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link last element of stream (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link ready to receive (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data valid (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link last element of stream (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link allowed to send (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SLINK when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (1..32k), has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SLINK_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (1..32k), has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupt:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The stream link interface provides independent RX and TX channels for sending for sending and receiving
stream data. Each channel features an internal FIFO with configurable depth to buffer stream data
(<code>IO_SLINK_RX_FIFO</code> for the RX FIFO, <code>IO_SLINK_TX_FIFO</code> for the TX FIFO). The SLINK interface provides higher
bandwidth and less latency than the external bus interface making it ideally suited for coupling custom
stream processing units or streaming peripherals.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Program</div>
An example program for the SLINK module is available in <code>sw/example/demo_slink</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interface &amp; Protocol</strong></p>
</div>
<div class="paragraph">
<p>The SLINK interface consists of four signals per channel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dat</code> contains the actual data word</p>
</li>
<li>
<p><code>val</code> marks the current transmission cycle as valid</p>
</li>
<li>
<p><code>lst</code> makes the current transmission cycle as the last element of a stream</p>
</li>
<li>
<p><code>rdy</code> indicates that the receiving part is ready to receive</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">AXI4-Stream Compatibility</div>
The interface names and the underlying protocol is compatible to the AXI4-Stream standard.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SLINK provides four interface registers. The control register (<code>CTRL</code>) is used to configure
the module and to check its status. Three individual data registers (<code>RX_DATA</code>, <code>TX_DATA</code>, <code>TX_DATA_LAST</code>)
are used to send and received the link&#8217;s actual data stream.</p>
</div>
<div class="paragraph">
<p>The <code>RX_DATA</code> register provides direct access to the RX link FIFO buffer. After reading data from this the register
the control register&#8217;s <code>SLINK_CTRL_RX_LAST</code> can be checked to determine if the according data word has been marked
as "end of stream" via the <code>slink_rx_lst_i</code> signal (this signal is also buffered by the link&#8217;s FIFO).</p>
</div>
<div class="paragraph">
<p>Writing to the <code>TX_DATA</code> or <code>TX_DATA_LAST</code> register will immediately write to the TX link FIFO buffer.
When writing to the <code>TX_DATA_LAST</code> the according data word will be marked as "end of stream" via the
<code>slink_tx_lst_o</code> signal (this signal is also buffered by the link&#8217;s FIFO).</p>
</div>
<div class="paragraph">
<p>The configured FIFO sizes can be retrieved by software via the control register&#8217;s <code>SLINK_CTRL_RX_FIFO_*</code> and
<code>SLINK_CTRL_TX_FIFO_*</code> bits.</p>
</div>
<div class="paragraph">
<p>The SLINK is globally activated by setting the control register&#8217;s enable bit <code>SLINK_CTRL_EN</code>. Clearing this bit will
reset all internal logic and will also clear both FIFOs. The FIFOs can also be cleared manually at all time by
setting the <code>SLINK_CTRL_RX_CLR</code> and <code>SLINK_CTRL_TX_CLR</code> bits (these bits will auto-clear).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Writing to the TX channel&#8217;s FIFO while it is <em>full</em> will have no effect. Reading from the RX channel&#8217;s FIFO while it
is <em>empty</em> will also have no effect and will return the last received data word.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The current status of the RX and TX FIFOs can be determined via the <code>SLINK_CTRL_RX_*</code> and <code>SLINK_CTRL_TX_*</code> flags.
A global interrupt can be programmed based on these FIFO status flags via the control register&#8217;s <code>SLINK_CTRL_IRQ_*</code>
bits. Note that all enabled interrupt conditions are logically OR-ed. Once the SLINK&#8217;s interrupt has become pending,
it has to be explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit(s).</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. SLINK register map (<code>struct NEORV32_SLINK</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 7.6923%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="22"><p class="tableblock"><code>0xffffec00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="22"><p class="tableblock"><code>NEORV32_SLINK.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>SLINK_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK global enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>    <code>SLINK_CTRL_RX_CLR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear RX FIFO when set (bit auto-clears)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>    <code>SLINK_CTRL_TX_CLR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear TX FIFO when set (bit auto-clears)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>    <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>    <code>SLINK_CTRL_RX_LAST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last word read from <code>RX_DATA</code> is marked as "end of stream"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:5</code>  <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>    <code>SLINK_CTRL_RX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code>    <code>SLINK_CTRL_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>   <code>SLINK_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>   <code>SLINK_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code>   <code>SLINK_CTRL_TX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code>   <code>SLINK_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:14</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>   <code>SLINK_CTRL_IRQ_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>   <code>SLINK_CTRL_IRQ_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if RX FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>   <code>SLINK_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code>   <code>SLINK_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code>   <code>SLINK_CTRL_IRQ_TX_NHALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if TX FIFO not at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code>   <code>SLINK_CTRL_IRQ_TX_NFULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if TX FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:22</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:24</code> <code>SLINK_CTRL_RX_FIFO_MSB : SLINK_CTRL_RX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(RX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:28</code> <code>SLINK_CTRL_TX_FIFO_MSB : SLINK_CTRL_TX_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(TX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffec04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.RX_DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read word from RX link FIFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffec08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.TX_DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write word to TX link FIFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffec0c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.TX_DATA_LAST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write word to TX link FIFO and also set "end-of-stream" delimiter</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_input_and_output_port_gpio">2.7.9. General Purpose Input and Output Port (GPIO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel output port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel input port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPIO_NUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of input/output pairs to implement (0..64)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The general purpose parallel IO unit provides a simple parallel input and output port. These ports can be used
chip-externally (for example to drive status LEDs, connect buttons, etc.) or chip-internally to provide control
signals for other IP modules.</p>
</div>
<div class="paragraph">
<p>The actual number of input/output pairs is defined by the <code>IO_GPIO_NUM</code> generic. When set to zero, the GPIO module
is excluded from synthesis and the output port <code>gpio_o</code> is tied to all-zero. If <code>IO_GPIO_NUM</code> is less than the
maximum value of 64, only the LSB-aligned bits in <code>gpio_o</code> and <code>gpio_i</code> are actually connected while the remaining
bits are tied to zero or are left unconnected, respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Atomicity</div>
The GPIO modules uses two memory-mapped registers (each 32-bit) each for accessing the input and
output signals. Since the CPU can only process 32-bit "at once" updating the entire output cannot
be performed within a single clock cycle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 11. GPIO unit register map (<code>struct NEORV32_GPIO</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffc00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 31:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffc04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 63:32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffc08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OUTPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 31:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffc0c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OUTPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 63:32</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_cyclic_redundancy_check_crc">2.7.10. Cyclic Redundancy Check (CRC)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_crc.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_crc.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_crc.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CRC_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CRC module when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The cyclic redundancy check unit provides a programmable checksum computation module. The unit operates on
single bytes and can either compute CRC8, CRC16 or CRC32 checksums based on an arbitrary polynomial and
start value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DMA Demo Program</div>
A CRC example program (also using CPU-independent DMA transfers) can be found in <code>sw/example/crc_dma</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CPU-Independent Operation</div>
The CRC unit can compute a checksum for an arbitrary memory array without any CPU overhead
by using the processor&#8217;s <a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The module provides four interface registers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MODE</code>: selects either CRC8-, CRC16- or CRC32-mode</p>
</li>
<li>
<p><code>POLY</code>: programmable polynomial</p>
</li>
<li>
<p><code>DATA</code>: data input register (single bytes only)</p>
</li>
<li>
<p><code>SREG</code>: the CRC shift register; this register is used to define the start value and to obtain
the final processing result</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>MODE</code>, <code>POLY</code> and <code>SREG</code> registers need to be programmed before the actual processing can be started.
Writing a byte to <code>DATA</code> will update the current checksum in <code>SREG</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Latency</div>
Write access to the CRC module have an increased latency of 8 clock cycles. This additional latency
ensures that the internal bit-serial processing of the current data byte has also been completed when the
transfer is completed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Data Size</div>
For CRC8-mode only bits <code>7:0</code> of <code>POLY</code> and <code>SREG</code> are relevant; for CRC16-mode only bits <code>15:0</code> are used
and for CRC32-mode the entire 32-bit of <code>POLY</code> and <code>SREG</code> are used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. CRC Register Map (<code>struct NEORV32_CRC</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xffffee00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRC mode select (<code>00</code> CRC8, <code>01</code>: CRC16, <code>10</code>: CRC32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffee04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POLY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRC polynomial</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xffffee08</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input (single byte)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero, writes are ignored</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffee0c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SREG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>32:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current CRC shift register value (set start value on write)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_watchdog_timer_wdt">2.7.11. Watchdog Timer (WDT)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_WDT_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement watchdog when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timeout (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The watchdog (WDT) provides a last resort for safety-critical applications. The WDT provides a "bark and bite"
concept. The timeout counter first triggers an optional CPU interrupt ("bark") when reaching half of the programmed
interval to inform the application of the imminent timeout. When the full timeout value is reached
a system-wide hardware reset is generated ("bite"). The internal counter has to be reset explicitly by the application
program every now and then to prevent a timeout.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="paragraph">
<p>The watchdog is enabled by setting the control register&#8217;s <code>WDT_CTRL_EN</code> bit. When this bit is cleared, the internal
timeout counter is reset to zero and no interrupt and no system reset can be triggered.</p>
</div>
<div class="paragraph">
<p>The internal 32-bit timeout counter is clocked at 1/4096th of the processor&#8217;s main clock (f<sub>WDT</sub>[Hz] = f<sub>main</sub>[Hz] / 4096).
Whenever this counter reaches the programmed timeout value (<code>WDT_CTRL_TIMEOUT</code> bits in the control register) a
hardware reset is triggered. In order to inform the application of an imminent timeout, an optional CPU interrupt is
triggered when the timeout counter reaches <em>half</em> of the programmed timeout value.</p>
</div>
<div class="paragraph">
<p>The watchdog&#8217;s timeout counter is reset ("feeding the watchdog") by writing the reset <strong>PASSWORD</strong> to the <code>RESET</code> register.
The password is hardwired to hexadecimal <code>0x709D1AB3</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Watchdog Interrupt</div>
A watchdog interrupt occurs when the watchdog is enabled and the internal counter reaches <em>exactly</em> half of the programmed
timeout value. Hence, the interrupt only fires once. However, a triggered WDT interrupt has to be explicitly cleared by
writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Watchdog Operation during Debugging</div>
By default, the watchdog stops operation when the CPU enters debug mode and will resume normal operation after
the CPU has left debug mode again. This will prevent an unintended watchdog timeout during a debug session. However,
the watchdog can also be configured to keep operating even when the CPU is in debug mode by setting the control
register&#8217;s <code>WDT_CTRL_DBEN</code> bit.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Watchdog Operation during CPU Sleep</div>
By default, the watchdog stops operating when the CPU enters sleep mode. However, the watchdog can also be configured
to keep operating even when the CPU is in sleep mode by setting the control register&#8217;s <code>WDT_CTRL_SEN</code> bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuration Lock</strong></p>
</div>
<div class="paragraph">
<p>The watchdog control register can be <em>locked</em> to protect the current configuration from being modified. The lock is
activated by setting the <code>WDT_CTRL_LOCK</code> bit. In the locked state any write access to the control register is entirely
ignored (see table below, "writable if locked"). However, read accesses to the control register as well as watchdog resets
are further possible.</p>
</div>
<div class="paragraph">
<p>The lock bit can only be set if the WDT is already enabled (<code>WDT_CTRL_EN</code> is set). Furthermore, the lock bit can
only be cleared again by a system-wide hardware reset.</p>
</div>
<div class="paragraph">
<p><strong>Strict Mode</strong></p>
</div>
<div class="paragraph">
<p>The <em>strict operation mode</em> provides additional safety functions. If the strict mode is enabled by the <code>WDT_CTRL_STRICT</code>
control register bit an <strong>immediate hardware</strong> reset if enforced if</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>RESET</code> register is written with an incorrect password or</p>
</li>
<li>
<p>the <code>CTRL</code> register is written and the <code>WDT_CTRL_LOCK</code> bit is set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Cause of last Hardware Reset</strong></p>
</div>
<div class="paragraph">
<p>The cause of the last system hardware reset can be determined via the <code>WDT_CTRL_RCAUSE_*</code> bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0b00</code>: Reset caused by external reset signal/pin</p>
</li>
<li>
<p><code>0b01</code>: Reset caused by on-chip debugger</p>
</li>
<li>
<p><code>0b10</code>: Reset caused by watchdog</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. WDT register map (<code>struct NEORV32_WDT</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 26.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-center valign-top">Reset value</th>
<th class="tableblock halign-center valign-top">Writable if locked</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock"><code>0xfffffb00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <code>WDT_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <code>WDT_CTRL_LOCK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock configuration when set, clears only on system reset, can only be set if enable bit is set already</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <code>WDT_CTRL_DBEN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to allow WDT to continue operation even when CPU is in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <code>WDT_CTRL_SEN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to allow WDT to continue operation even when CPU is in sleep mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <code>WDT_CTRL_STRICT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable strict mode (force hardware reset if reset password is incorrect or if write access to locked CTRL register)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6:5</code> <code>WDT_CTRL_RCAUSE_HI : WDT_CTRL_RCAUSE_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause of last system reset; 0=external reset, 1=ocd-reset, 2=watchdog reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code> <code>WDT_CTRL_TIMEOUT_MSB : WDT_CTRL_TIMEOUT_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24-bit watchdog timeout value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffb04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESET</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write PASSWORD to reset WDT timeout counter ("feed the watchdog")</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_system_timer_mtime">2.7.12. Machine System Timer (MTIME)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer IRQ if internal one is <strong>not</strong> implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_time_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current system time (<code>TIME</code> register)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_MTIME_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement machine timer when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The MTIME module implements a memory-mapped machine system timer that is compatible to the RISC-V
privileged specifications. The 64-bit system time is accessed via individual <code>TIME_LO</code> and
<code>TIME_HI</code> registers. A 64-bit time compare register, which is accessible via individual <code>TIMECMP_LO</code>
and <code>TIMECMP_HI</code> registers, can be used to configure the CPU&#8217;s machine timer interrupt (<code>MTI</code>)). The interrupt
is triggered whenever <code>TIME</code> (high &amp; low part) is greater than or equal to <code>TIMECMP</code> (high &amp; low part).
The interrupt remains active (=pending) until <code>TIME</code> becomes less than <code>TIMECMP</code> again (either by modifying
<code>TIME</code> or <code>TIMECMP</code>). The current system time is available for other SoC modules via the top&#8217;s <code>mtime_time_o</code> signal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Hardware Reset</div>
After a hardware reset the <code>TIME</code> and <code>TIMECMP</code> register are reset to all-zero.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">External MTIME Interrupt</div>
If the internal MTIME module is disabled (<code>IO_MTIME_EN</code> = <code>false</code>) the machine timer interrupt becomes available
as external signal. The <code>mtime_irq_i</code> signal is level-triggered and high-active. Once set the signal has to stay
high until the interrupt request is explicitly acknowledged (e.g. writing to a user-defined memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. MTIME register map (<code>struct NEORV32_MTIME</code>)</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 42.8574%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff400</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system time, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff404</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system time, high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff408</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMECMP_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff40c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMECMP_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, high word</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.7.13. Primary Universal Asynchronous Receiver and Transmitter (UART0)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART0_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART0 when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART0_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART0_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 UART provides a standard serial interface with independent transmitter and receiver channels, each
equipped with a configurable FIFO. The transmission frame is fixed to <strong>8N1</strong>: 8 data bits, no parity bit, 1 stop
bit. The actual transmission rate (Baud rate) is programmable via software. The module features two memory-mapped
registers: <code>CTRL</code> and <code>DATA</code>. These are used for configuration, status check and data transfer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Console</div>
All default example programs and software libraries of the NEORV32 software framework (including the bootloader
and the runtime environment) use the primary UART (<em>UART0</em>) as default user console interface. Furthermore, UART0
is used to implement the "standard consoles" (<code>STDIN</code>, <code>STDOUT</code> and <code>STDERR</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The module is enabled by setting the <code>UART_CTRL_EN</code> bit in the UART0 control register <code>CTRL</code>. The Baud rate
is configured via a 10-bit <code>UART_CTRL_BAUDx</code> baud divisor (<code>baud_div</code>) and a 3-bit <code>UART_CTRL_PRSCx</code>
clock prescaler (<code>clock_prescaler</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 15. UART0 Clock Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>UART_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><strong>Baud rate</strong></em> = (<em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code>) / (<code>baud_div</code> + 1)</p>
</div>
<div class="paragraph">
<p>The control register&#8217;s <code>UART_CTRL_RX_*</code> and <code>UART_CTRL_TX_*</code> flags provide information about the RX and TX FIFO fill level.
Disabling the module via the <code>UART_CTRL_EN</code> bit will also clear these FIFOs.</p>
</div>
<div class="paragraph">
<p>A new TX transmission is started by writing to the <code>DATA</code> register. The
transfer is completed when the <code>UART_CTRL_TX_BUSY</code> control register flag returns to zero. RX data is available when
the <code>UART_CTRL_RX_NEMPTY</code> flag becomes set. The <code>UART_CTRL_RX_OVER</code> will be set if the RX FIFO overflows. This flag
is cleared only by disabling the module via <code>UART_CTRL_EN</code>.</p>
</div>
<div class="paragraph">
<p><strong>UART Interrupts</strong></p>
</div>
<div class="paragraph">
<p>The UART module provides independent interrupt channels for RX and TX. These interrupts are triggered by certain RX and TX
FIFO levels. The actual configuration is programmed independently for the RX and TX interrupt channel via the control register&#8217;s
<code>UART_CTRL_IRQ_RX_*</code> and <code>UART_CTRL_IRQ_TX_*</code> bits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>RX IRQ</strong> The RX interrupt can be triggered by three different RX FIFO level states: If <code>UART_CTRL_IRQ_RX_NEMPTY</code> is set the
interrupt fires if the RX FIFO is <em>not</em> empty (e.g. when incoming data is available). If <code>UART_CTRL_IRQ_RX_HALF</code> is set the RX IRQ
fires if the RX FIFO is at least half-full. If <code>UART_CTRL_IRQ_RX_FULL</code> the interrupt fires if the RX FIFO is full. Note that all
these programmable conditions are logically OR-ed (interrupt fires if any enabled conditions is true).</p>
</li>
<li>
<p><strong>TX IRQ</strong> The TX interrupt can be triggered by two different TX FIFO level states: If <code>UART_CTRL_IRQ_TX_EMPTY</code> is set the
interrupt fires if the TX FIFO is empty. If <code>UART_CTRL_IRQ_TX_NHALF</code> is set the interrupt fires if the TX FIFO is <em>not</em> at least
half full. Note that all these programmable conditions are logically OR-ed (interrupt fires if any enabled conditions is true).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once an UART interrupt has fired it remains pending until the actual cause of the interrupt is resolved; for
example if just the <code>UART_CTRL_IRQ_RX_NEMPTY</code> bit is set, the RX interrupt will keep firing until the RX FIFO is empty again.
Furthermore, a pending UART interrupt has to be explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">RX/TX FIFO Size</div>
Software can retrieve the configured sizes of the RX and TX FIFO via the according <code>UART_DATA_RX_FIFO_SIZE</code> and
<code>UART_DATA_TX_FIFO_SIZE</code> bits from the <code>DATA</code> register.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>RTS/CTS Hardware Flow Control</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 UART supports optional hardware flow control using the standard CTS <code>uart0_cts_i</code> ("clear to send") and RTS
<code>uart0_rts_o</code> ("ready to send" / "ready to receive (RTR)") signals. Both signals are low-active.
Hardware flow control is enabled by setting the <code>UART_CTRL_HWFC_EN</code> bit in the modules control register <code>CTRL</code>.</p>
</div>
<div class="paragraph">
<p>When hardware flow control is enabled:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The UART&#8217;s transmitter will not start a new transmission until the <code>uart0_cts_i</code> signal goes low.
During this time, the UART busy flag <code>UART_CTRL_TX_BUSY</code> remains set.</p>
</li>
<li>
<p>The UART will set <code>uart0_rts_o</code> signal low if the RX FIFO is <strong>less than half full</strong> (to have a wide safety margin).
As long as this signal is low, the connected device can send new data. <code>uart0_rts_o</code> is always low if the hardware flow-control
is disabled. Disabling the UART (setting <code>UART_CTRL_EN</code> low) while having hardware flow-control enabled, will set <code>uart0_rts_o</code>
high to signal that the UARt is not capable of receiving new data.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that RTS and CTS signaling can only be activated together. If the RTS handshake is not required the signal can be left
unconnected. If the CTS handshake is not required it has to be tied to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The UART provides a <em>simulation-only</em> mode to dump console data as well as raw data directly to a file. When the simulation
mode is enabled (by setting the <code>UART_CTRL_SIM_MODE</code> bit) there will be <strong>no</strong> physical transaction on the <code>uart0_txd_o</code> signal.
Instead, all data written to the <code>DATA</code> register is immediately dumped to a file. Data written to <code>DATA[7:0]</code> will be dumped as
ASCII chars to a file named <code>neorv32.uart0.sim_mode.text.out</code>. Additionally, the ASCII data is printed to the simulator console.</p>
</div>
<div class="paragraph">
<p>Both file are created in the simulation&#8217;s home folder.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. UART0 register map (<code>struct NEORV32_UART0</code>)</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 27.7777%;">
<col style="width: 11.1111%;">
<col style="width: 27.7779%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="19"><p class="tableblock"><code>0xfffff500</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="19"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>UART_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>UART_CTRL_SIM_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>UART_CTRL_HWFC_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS/CTS hardware flow-control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:3</code>   <code>UART_CTRL_PRSC2 : UART_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:6</code>  <code>UART_CTRL_BAUD9 : UART_CTRL_BAUD0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit Baud value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>UART_CTRL_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>UART_CTRL_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>UART_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code>    <code>UART_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code>    <code>UART_CTRL_TX_NHALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO not at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code>    <code>UART_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code>    <code>UART_CTRL_IRQ_RX_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire IRQ if RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code>    <code>UART_CTRL_IRQ_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire IRQ if RX FIFO at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code>    <code>UART_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire IRQ if RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code>    <code>UART_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire IRQ if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>UART_CTRL_IRQ_TX_NHALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire IRQ if TX not at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:27</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em> read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>UART_CTRL_RX_OVER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO overflow; cleared by disabling the module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>UART_CTRL_TX_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX busy or TX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffff504</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <code>UART_DATA_RTX_MSB : UART_DATA_RTX_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:8</code>  <code>UART_DATA_RX_FIFO_SIZE_MSB : UART_DATA_RX_FIFO_SIZE_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(RX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:12</code> <code>UART_DATA_TX_FIFO_SIZE_MSB : UART_DATA_TX_FIFO_SIZE_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log2(RX FIFO size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.7.14. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_UART1_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART1 when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART1_RX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART1_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) is functionally identical to the primary UART
(<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>). Obviously, UART1 uses different addresses for the
control register (<code>CTRL</code>) and the data register (<code>DATA</code>). The register&#8217;s bits/flags use the same bit positions and naming
as for the primary UART. The RX and TX interrupts of UART1 are mapped to different CPU fast interrupt (FIRQ) channels.</p>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) provides the same simulation options as the primary UART (UART0). However, output data is
written to UART1-specific file <code>neorv32.uart1.sim_mode.text.out</code>. This data is also printed to the simulator console.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. UART1 register map (<code>struct NEORV32_UART1</code>)</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff604</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as UART0</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_peripheral_interface_controller_spi">2.7.15. Serial Peripheral Interface Controller (SPI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_clk_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit dedicated chip select output (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SPI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SPI_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth, has to be a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable SPI interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 SPI transceiver module operates on 8-bit base, supports all 4 standard clock modes
and provides up to 8 dedicated chip select signals via the top entity&#8217;s <code>spi_csn_o</code> signal.
An receive/transmit FIFO can be configured via the <code>IO_SPI_FIFO</code> generic to support block-based
transmissions without CPU interaction.</p>
</div>
<div class="paragraph">
<p>The SPI module provides a single control register <code>CTRL</code> to configure the module and to check it&#8217;s status
and a single data register <code>DATA</code> for receiving/transmitting data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Host-Mode Only</div>
The NEORV32 SPI module only supports <em>host mode</em>. Transmission are initiated only by the processor&#8217;s SPI module
and not by an external SPI module. If you are looking for a <em>device-mode</em> serial peripheral interface (transactions
initiated by an external host) check out the <a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SPI module is enabled by setting the <code>SPI_CTRL_EN</code> bit in the <code>CTRL</code> control register. No transfer can be initiated
and no interrupt request will be triggered if this bit is cleared. Clearing this bit will reset the module, clear
the FIFO and terminate any transfer being in process.</p>
</div>
<div class="paragraph">
<p>The data quantity to be transferred within a single data transmission is fixed to 8 bits. However, the
total transmission length is left to the user: after asserting chip-select an arbitrary amount of 8-bit transmission
can be made before de-asserting chip-select again.</p>
</div>
<div class="paragraph">
<p>A transmission is started when writing data to the transmitter FIFO via the <code>DATA</code> register. Note that data always
transferred MSB-first. The SPI operation is completed as soon as the <code>SPI_CTRL_BUSY</code> flag clears. Received data can
be retrieved by reading the RX FIFO also via the <code>DATA</code> register. The control register&#8217;s <code>SPI_CTRL_RX_AVAIL</code>,
<code>SPI_CTRL_TX_EMPTY</code>, <code>SPI_CTRL_TX_NHALF</code> and <code>SPI_CTRL_TX_FULL</code> flags provide information regarding the RX/TX FIFO levels.</p>
</div>
<div class="paragraph">
<p>The SPI controller features 8 dedicated chip-select lines. These lines are controlled via the control register&#8217;s
<code>SPI_CTRL_CS_SELx</code> and <code>SPI_CTRL_CS_EN</code> bits. The 3-bit <code>SPI_CTRL_CS_SELx</code> bits are used to select one out of the eight
dedicated chip select lines. As soon as <code>SPI_CTRL_CS_EN</code> is <em>set</em> the selected chip select line is activated (driven <em>low</em>).
Note that disabling the SPI module via the <em>SPI_CTRL_EN</em> bit will also deactivate any currently activated chip select line.</p>
</div>
<div class="paragraph">
<p><strong>SPI Clock Configuration</strong></p>
</div>
<div class="paragraph">
<p>The SPI module supports all standard SPI clock modes (0, 1, 2, 3), which are configured via the two control register bits
<code>SPI_CTRL_CPHA</code> and <code>SPI_CTRL_CPOL</code>. The <code>SPI_CTRL_CPHA</code> bit defines the <em>clock phase</em> and the <code>SPI_CTRL_CPOL</code>
bit defines the <em>clock polarity</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/SPI_timing_diagram2.wikimedia.png" alt="SPI timing diagram2.wikimedia">
</div>
<div class="title">Figure 5. SPI clock modes; image from <a href="https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg" class="bare">https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg</a> (license: (Wikimedia) <a href="https://en.wikipedia.org/wiki/Creative_Commons">Creative Commons</a> <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">Attribution-Share Alike 3.0 Unported</a>)</div>
</div>
<div class="paragraph">
<p>The SPI clock frequency (<code>spi_clk_o</code>) is programmed by the 3-bit <code>SPI_CTRL_PRSCx</code> clock prescaler for a coarse clock selection
and a 4-bit clock divider <code>SPI_CTRL_CDIVx</code> for a fine clock configuration.
The following clock prescalers (<code>SPI_CTRL_PRSCx</code>) are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 18. SPI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>SPI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the programmed clock configuration, the actual SPI clock frequency f<sub>SPI</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code> * (1 + <code>SPI_CTRL_CDIVx</code>))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock is f<sub>main</sub> / 4 and the lowest SPI clock is f<sub>main</sub> / 131072. The SPI clock is always
symmetric having a duty cycle of 50%.</p>
</div>
<div class="paragraph">
<p><strong>High-Speed Mode</strong></p>
</div>
<div class="paragraph">
<p>The SPI provides a high-speed mode to further boost the maximum SPI clock frequency. When enabled via the control
register&#8217;s <code>SPI_CTRL_HIGHSPEED</code> bit the clock prescaler configuration (<code>SPI_CTRL_PRSCx</code> bits) is overridden setting it
to a minimal factor of 1. However, the clock speed can still be fine-tuned using the <code>SPI_CTRL_CDIVx</code> bits.</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * 1 * (1 + <code>SPI_CTRL_CDIVx</code>))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock when in high-speed mode is f<sub>main</sub> / 2.</p>
</div>
<div class="paragraph">
<p><strong>SPI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a set of programmable interrupt conditions based on the level of the RX/TX FIFO. The different
interrupt sources are enabled by setting the according control register&#8217;s <code>SPI_CTRL_IRQ_*</code> bits. All enabled interrupt
conditions are logically OR-ed so any enabled interrupt source will trigger the module&#8217;s interrupt signal.</p>
</div>
<div class="paragraph">
<p>Once the SPI interrupt has fired it remains pending until the actual cause of the interrupt is resolved; for
example if just the <code>SPI_CTRL_IRQ_RX_AVAIL</code> bit is set, the interrupt will keep firing until the RX FIFO is empty again.
Furthermore, an active SPI interrupt has to be explicitly cleared again by writing zero to the according
<a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. SPI register map (<code>struct NEORV32_SPI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="19"><p class="tableblock"><code>0xfffff800</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="19"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>SPI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>SPI_CTRL_CPHA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock phase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>SPI_CTRL_CPOL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:3</code>   <code>SPI_CTRL_CS_SEL2 : SPI_CTRL_CS_SEL0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct chip-select 0..7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code>     <code>SPI_CTRL_CS_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct chip-select enable: setting <code>spi_csn_o(SPI_CTRL_CS_SEL)</code> low when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:7</code>   <code>SPI_CTRL_PRSC2 : SPI_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13:10</code> <code>SPI_CTRL_CDIV2 : SPI_CTRL_CDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider for fine-tuning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code>    <code>SPI_CTRL_HIGHSPEED</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-speed mode enable (overriding <code>SPI_CTRL_PRSC</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code>     <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>SPI_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available (RX FIFO not empty)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>SPI_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>SPI_CTRL_TX_NHALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO <em>not</em> at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code>    <code>SPI_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code>    <code>SPI_CTRL_IRQ_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger IRQ if RX FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code>    <code>SPI_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger IRQ if TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code>    <code>SPI_CTRL_IRQ_TX_NHALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger IRQ if TX FIFO <em>not</em> at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:23</code> <code>SPI_CTRL_FIFO_MSB : SPI_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<em>IO_SPI_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30:27</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>SPI_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module busy when set (serial engine operation in progress and TX FIFO not empty yet)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff804</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (FIFO)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_data_interface_controller_sdi">2.7.16. Serial Data Interface Controller (SDI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sdi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_clk_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdi_csn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit chip-select input (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SDI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_SDI_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO size, has to a power of two, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable SDI interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The serial data interface module provides a <strong>device-class</strong> SPI interface and allows to connect the processor
to an external SPI <em>host</em>, which is responsible for triggering (clocking) the actual transmission - the SDI is entirely
passive. An optional receive/transmit FIFO can be configured via the <em>IO_SDI_FIFO</em> generic to support block-based
transmissions without CPU interaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Device-Mode Only</div>
The NEORV32 SDI module only supports <em>device mode</em>. Transmission are initiated by an external host and not by the
the processor itself. If you are looking for a <em>host-mode</em> serial peripheral interface (transactions
initiated by the NEORV32) check out the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SDI module provides a single control register <code>CTRL</code> to configure the module and to check it&#8217;s status
and a single data register <code>DATA</code> for receiving/transmitting data.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SDI module is enabled by setting the <code>SDI_CTRL_EN</code> bit in the <code>CTRL</code> control register. Clearing this bit
resets the entire module including the RX and TX FIFOs.</p>
</div>
<div class="paragraph">
<p>The SDI operates on byte-level only. Data written to the <code>DATA</code> register will be pushed to the TX FIFO. Received
data can be retrieved by reading the RX FIFO via the <code>DATA</code> register. The current state of these FIFOs is available
via the control register&#8217;s <code>SDI_CTRL_RX_*</code> and <code>SDI_CTRL_TX_*</code> flags. The RX FIFO can be manually cleared at any time
by setting the <code>SDI_CTRL_CLR_RX</code> bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">MSB-first Only</div>
The NEORV32 SDI module only supports MSB-first mode.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Transmission Abort</div>
If the external SPI controller aborts an transmission (by setting the chip-select signal high again) <em>before</em>
8 data bits have been transferred, no data is written to the RX FIFO.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SDI Clocking</strong></p>
</div>
<div class="paragraph">
<p>The SDI module supports both SPI clock polarity modes ("CPOL") but regarding the clock phase only "CPHA=0" is supported
yet. All SDI operations are clocked by the external <code>sdi_clk_i</code> signal. This signal is synchronized to the processor&#8217;s
clock domain to simplify timing behavior. However, the clock synchronization requires that the external SDI clock
(<code>sdi_clk_i</code>) does <strong>not exceed 1/4 of the processor&#8217;s main clock</strong>.</p>
</div>
<div class="paragraph">
<p><strong>SDI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SDI module provides a set of programmable interrupt conditions based on the level of the RX &amp; TX FIFOs. The different
interrupt sources are enabled by setting the according control register&#8217;s <code>SDI_CTRL_IRQ</code> bits. All enabled interrupt
conditions are logically OR-ed so any enabled interrupt source will trigger the module&#8217;s interrupt signal.</p>
</div>
<div class="paragraph">
<p>Once the SDI interrupt has fired it will remain active until the actual cause of the interrupt is resolved; for
example if just the <code>SDI_CTRL_IRQ_RX_AVAIL</code> bit is set, the interrupt will keep firing until the RX FIFO is empty again.
Furthermore, an active SDI interrupt has to be explicitly cleared again by writing zero to the according
<a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. SDI register map (<code>struct NEORV32_SDI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>0xfffff700</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>SDI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SDI module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>SDI_CTRL_CLR_RX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clear RX FIFO when set, bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:2</code>   <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:4</code>   <code>SDI_CTRL_FIFO_MSB : SDI_CTRL_FIFO_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<em>IO_SDI_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14:8</code>  <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code>    <code>SDI_CTRL_IRQ_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if RX FIFO is not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code>    <code>SDI_CTRL_IRQ_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if RX FIFO is at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code>    <code>SDI_CTRL_IRQ_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if if RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code>    <code>SDI_CTRL_IRQ_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fire interrupt if TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22:19</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code>    <code>SDI_CTRL_RX_AVAIL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available (RX FIFO not empty)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code>    <code>SDI_CTRL_RX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code>    <code>SDI_CTRL_RX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>SDI_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>SDI_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:28</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff704</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (FIFO)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_two_wire_serial_interface_controller_twi">2.7.17. Two-Wire Serial Interface Controller (TWI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock line output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TWI_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TWI controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI implements a <strong>TWI controller</strong>. Currently, <strong>no multi-controller support</strong> is available.
Furthermore, the NEORV32 TWI unit cannot operate in peripheral mode.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The serial clock (SCL) and the serial data (SDA) lines can only be actively driven low by the
controller. Hence, external pull-up resistors are required for these lines.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Tri-State Drivers</strong></p>
</div>
<div class="paragraph">
<p>The TWI module requires two tri-state drivers (actually: open-drain) for the SDA and SCL lines, which have to be
implemented in the top module of the setup. A generic VHDL example is given below (<code>sda</code> and <code>scl</code> are the actual TWI
bus signal, which are of type <code>std_logic</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. TWI VHDL tri-state driver example</div>
<div class="content">
<pre class="highlight"><code class="language-VHDL" data-lang="VHDL">sda       &lt;= '0' when (twi_sda_o = '0') else 'Z'; -- drive
scl       &lt;= '0' when (twi_scl_o = '0') else 'Z'; -- drive
twi_sda_i &lt;= std_ulogic(sda); -- sense
twi_scl_i &lt;= std_ulogic(scl); -- sense</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>TWI Clock Speed</strong></p>
</div>
<div class="paragraph">
<p>The TWI clock frequency is programmed by the 3-bit <code>TWI_CTRL_PRSCx</code> clock prescaler for a coarse selection
and a 4-bit clock divider <code>TWI_CTRL_CDIVx</code> for a fine selection.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 21. TWI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>TWI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the the clock configuration, the actual TWI clock frequency f<sub>SCL</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SCL</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (4 * <code>clock_prescaler</code> * (1 + TWI_CTRL_CDIV))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum TWI clock is f<sub>main</sub> / 8 and the lowest TWI clock is f<sub>main</sub> / 262144. The generated TWI clock is
always symmetric having a duty cycle of exactly 50%. However, an accessed peripheral can "slow down" the bus clock
by using <strong>clock stretching</strong> (= actively driving the SCL line low). The controller will pause operation in this case
if clock stretching is enabled via the <code>TWI_CTRL_CSEN</code> bit of the unit&#8217;s control register <code>CTRL</code></p>
</div>
<div class="paragraph">
<p><strong>TWI Transfers</strong></p>
</div>
<div class="paragraph">
<p>The TWI is enabled via the <code>TWI_CTRL_EN</code> bit in the <code>CTRL</code> control register. The user program can start / stop a
transmission by issuing a START or STOP condition. These conditions are generated by setting the
according bits (<code>TWI_CTRL_START</code> or <code>TWI_CTRL_STOP</code>) in the control register.</p>
</div>
<div class="paragraph">
<p>Data is transferred via the TWI bus by writing a byte to the <code>DATA</code> register. The written byte is send via the TWI bus
and the received byte from the bus is also available in this register after the transmission is completed.</p>
</div>
<div class="paragraph">
<p>The TWI operation (transmitting data or performing a START or STOP condition) is in progress as long as the
control register&#8217;s <code>TWI_CTRL_BUSY</code> bit is set.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission can be terminated at any time by disabling the TWI module
by clearing the <em>TWI_CTRL_EN</em> control register bit. This will also reset the whole module.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When reading data from a device, an all-one byte (<code>0xFF</code>) has to be written to TWI data register <code>NEORV32_TWI.DATA</code>
so the accessed device can actively pull-down SDA when required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TWI ACK/NACK and MACK</strong></p>
</div>
<div class="paragraph">
<p>An accessed TWI peripheral has to acknowledge each transferred byte. When the <code>TWI_CTRL_ACK</code> bit is set after a
completed transmission the accessed peripheral has send an ACKNOWLEDGE (ACK). If this bit is cleared after a completed
transmission, the peripheral has send a_NOT-ACKNOWLEDGE (NACK).</p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI controller can also send an ACK generated by itself ("controller acknowledge / MACK") right after
transmitting a byte by driving SDA low during the ACK time slot. Some TWI modules require this MACK to acknowledge
certain data movement operations.</p>
</div>
<div class="paragraph">
<p>The control register&#8217;s <code>TWI_CTRL_MACK</code> bit has to be set to make the TWI module automatically generate a MACK after
the byte transmission has been completed. If this bit is cleared, the ACK/NACK generated by the peripheral is sampled
in this time slot instead (normal mode).</p>
</div>
<div class="paragraph">
<p><strong>TWI Bus Status</strong></p>
</div>
<div class="paragraph">
<p>The TWI controller can check if the TWI bus is currently claimed (SCL and SDA both low). The bus can be claimed by the
NEORV32 TWI itself or by any other controller. Bit <code>TWI_CTRL_CLAIME</code> of the control register will be set if the bus
is currently claimed.</p>
</div>
<div class="paragraph">
<p><strong>TWI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TWI module provides a single interrupt to signal "transmission done" to the CPU. Whenever the TWI
module completes the current transmission of one byte the interrupt is triggered. Note the the interrupt
is <strong>not</strong> triggered when completing a START or STOP condition. Once triggered, the interrupt has to be
explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. TWI register map (<code>struct NEORV32_TWI</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xfffff900</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>TWI_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>TWI_CTRL_START</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate START condition, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>TWI_CTRL_STOP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate STOP condition, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>     <code>TWI_CTRL_MACK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate controller-ACK for each transmission ("MACK")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>     <code>TWI_CTRL_CSEN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">allow clock stretching when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:5</code>   <code>TWI_CTRL_PRSC2 : TWI_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:8</code>  <code>TWI_CTRL_CDIV3 : TWI_CTRL_CDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:12</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>TWI_CTRL_CLAIMED</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI bus is claimed by any controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>TWI_CTRL_ACK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACK received when set, NACK received when cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>TWI_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer/START/STOP in progress when set</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff904</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_one_wire_serial_interface_controller_onewire">2.7.18. One-Wire Serial Interface Controller (ONEWIRE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit 1-wire bus sense input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit 1-wire bus output (pull low only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_ONEWIRE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement ONEWIRE interface controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 ONEWIRE module implements a single-wire interface controller that is compatible to the
<em>Dallas/Maxim 1-Wire</em> protocol, which is an asynchronous half-duplex bus requiring only a single signal wire
connected to <code>onewire_io</code> (plus ground).</p>
</div>
<div class="paragraph">
<p>The bus is based on a single open-drain signal. The controller and all the devices can only pull-down the bus actively.
Hence, an external pull-up resistor is required. Recommended values are between 1kΩ and 4kΩ depending on the bus
characteristics (wire length, number of devices, etc.). Furthermore, a series resistor (~100Ω) at the controller side
is recommended to control the slew rate and to reduce signal reflections. Also, additional external ESD protection clamp diodes
should be added to the bus line.</p>
</div>
<div class="paragraph">
<p><strong>Tri-State Drivers</strong></p>
</div>
<div class="paragraph">
<p>The ONEWIRE module requires a tri-state driver (actually, open-drain) for the 1-wire bus line, which has to be implemented
in the top module of the setup. A generic VHDL example is given below (<code>onewire</code> is the actual 1-wire
bus signal, which is of type <code>std_logic</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. ONEWIRE VHDL tri-state driver example</div>
<div class="content">
<pre class="highlight"><code class="language-VHDL" data-lang="VHDL">onewire   &lt;= '0' when (onewire_o = '0') else 'Z'; -- drive
onewire_i &lt;= std_ulogic(onewire); -- sense</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The ONEWIRE controller provides two interface registers: <code>CTRL</code> and <code>DATA.</code> The control registers (<code>CTRL</code>)
is used to configure the module, to trigger bus transactions and to monitor the current state of the module.
The <code>DATA</code> register is used to read/write data from/to the bus.</p>
</div>
<div class="paragraph">
<p>The module is enabled by setting the <code>ONEWIRE_CTRL_EN</code> bit in the control register. If this bit is cleared, the
module is automatically reset and the bus is brought to high-level (due to the external pull-up resistor).
The basic timing configuration is programmed via the clock prescaler bits <code>ONEWIRE_CTRL_PRSCx</code> and the
clock divider bits <code>ONEWIRE_CTRL_CLKDIVx</code> (see next section).</p>
</div>
<div class="paragraph">
<p>The controller can execute three basic bus operations, which are triggered by setting one out of three specific
control register bits (the bits auto-clear):</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>generate reset pulse and check for device presence; triggered when setting <code>ONEWIRE_CTRL_TRIG_RST</code></p>
</li>
<li>
<p>transfer a single-bit (read-while-write); triggered when setting <code>ONEWIRE_CTRL_TRIG_BIT</code></p>
</li>
<li>
<p>transfer a full-byte (read-while-write); triggered when setting <code>ONEWIRE_CTRL_TRIG_BYTE</code></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Only one trigger bit may be set at once, otherwise undefined behavior might occur.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a single-bit operation has been triggered, the data previously written to <code>DATA[0]</code> will be send to the bus
and <code>DATA[7]</code> will be sampled from the bus. Accordingly, a full-byte transmission will send the previously
byte written to <code>DATA[7:0]</code> to the bus and will update <code>DATA[7:0]</code> with the data read from the bus (LSB-first).
The triggered operation has completed when the module&#8217;s busy flag <code>ONEWIRE_CTRL_BUSY</code> has cleared again.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read from Bus</div>
In order to read a single bit from the bus <code>DATA[0]</code> has to set to <code>1</code> before triggering the bit transmission
operation to allow the accessed device to pull-down the bus. Accordingly, <code>DATA</code> has to be set to <code>0xFF</code> before
triggering the byte transmission operation when the controller shall read a byte from the bus.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ONEWIRE_CTRL_PRESENCE</code> bit gets set if at least one device has send a "presence" signal right after the
reset pulse.</p>
</div>
<div class="paragraph">
<p><strong>Bus Timing</strong></p>
</div>
<div class="paragraph">
<p>The control register provides a 2-bit clock prescaler select (<code>ONEWIRE_CTRL_PRSCx</code>) and a 8-bit clock divider
(<code>ONEWIRE_CTRL_CLKDIVx</code>) for timing configuration. Both are used to define the elementary <strong>base time T<sub>base</sub></strong>.
All bus operations are timed using <em>multiples</em> of this elementary base time.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 23. ONEWIRE Clock Prescaler Configurations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>ONEWIRE_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b00</code></th>
<th class="tableblock halign-center valign-top"><code>0b01</code></th>
<th class="tableblock halign-center valign-top"><code>0b10</code></th>
<th class="tableblock halign-center valign-top"><code>0b11</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Together with the clock divider value (<code>ONEWIRE_CTRL_PRSCx</code> bits = <code>clock_divider</code>) the base time is defined by the
following formula:</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / <em>f<sub>main</sub>[Hz]</em>) * <code>clock_prescaler</code> * (<code>clock_divider</code> + 1)</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>f<sub>main</sub></em> = 100MHz</p>
</li>
<li>
<p>clock prescaler select = <code>0b01</code> &#8594; <code>clock_prescaler</code> = 4</p>
</li>
<li>
<p>clock divider <code>clock_divider</code> = 249</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / 100000000Hz) * 4 * (249 + 1) = 10000ns = <strong>10µs</strong></p>
</div>
<div class="paragraph">
<p>The base time is used to coordinate all bus interactions. Hence, all delays, time slots and points in time are
quantized as multiples of the base time. The following images show the two basic operations of the ONEWIRE
controller: single-bit (0 or 1) transaction and reset with presence detect. The relevant points in time are
shown as <em>absolute</em> time (in multiples of the time base) with the bus' falling edge as reference point.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="img/onewire_data.png" alt="onewire data">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="img/onewire_reset.png" alt="onewire reset">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Single-bit data transmission (not to scale)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Reset pulse and presence detect (not to scale)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 24. Data Transmission Timing</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 21.4285%;">
<col style="width: 21.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Multiples of T<sub>base</sub></th>
<th class="tableblock halign-center valign-top">Time when T<sub>base</sub> = 10µs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Single-bit data transmission</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t0</code> (a&#8594;b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active low-phase when writing a <code>'1'</code> or when reading</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10µs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t1</code> (a&#8594;c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus state (read operation)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20µs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t2</code> (a&#8594;d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of bit time slot (when writing a <code>'0'</code> or when reading)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">70µs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t3</code> (a&#8594;e)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of inter-slot pause (= total duration of one bit)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">90µs</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Reset pulse and presence detect</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t4</code> (f&#8594;g)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active reset pulse</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">480µs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t5</code> (f&#8594;h)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus presence</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">55</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">550µs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t6</code> (f&#8594;i)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of presence phase</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">960µs</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default values for base time multiples were chosen to for stable and reliable bus
operation (not for maximum throughput).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The absolute points in time are hardwired by the VHDL code and cannot be changed during runtime.
However, the timing parameter can be customized by editing the ONEWIRE&#8217;s VHDL source file:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Hardwired time configuration in <code>neorv32_onewire.vhd</code></div>
<div class="content">
<pre class="highlight"><code class="language-VHDL" data-lang="VHDL">-- timing configuration (absolute time in multiples of the base tick time t_base) --
constant t_write_one_c       : unsigned(6 downto 0) := to_unsigned( 1, 7); -- t0
constant t_read_sample_c     : unsigned(6 downto 0) := to_unsigned( 2, 7); -- t1
constant t_slot_end_c        : unsigned(6 downto 0) := to_unsigned( 7, 7); -- t2
constant t_pause_end_c       : unsigned(6 downto 0) := to_unsigned( 9, 7); -- t3
constant t_reset_end_c       : unsigned(6 downto 0) := to_unsigned(48, 7); -- t4
constant t_presence_sample_c : unsigned(6 downto 0) := to_unsigned(55, 7); -- t5
constant t_presence_end_c    : unsigned(6 downto 0) := to_unsigned(96, 7); -- t6</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Overdrive</div>
The ONEWIRE controller does not support the <em>overdrive</em> mode. However, it can be implemented by reducing the base
time <strong>T<sub>base</sub></strong> (and by eventually changing the hardwired timing configuration in the VHDL source file).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupt</strong></p>
</div>
<div class="paragraph">
<p>A single interrupt is provided by the ONEWIRE module to signal "operation done" condition to the CPU. Whenever the
controller completes a "generate reset pulse", a "transfer single-bit" or a "transfer full-byte" operation the
interrupt is triggered. Once triggered, the interrupt has to be <em>explicitly</em> cleared again by writing zero to the
according <a href="#_mip"><strong><code>mip</code></strong></a> CSR FIRQ bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. ONEWIRE register map (<code>struct NEORV32_ONEWIRE</code>)</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xfffff200</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>ONEWIRE_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONEWIRE enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2:1</code>   <code>ONEWIRE_CTRL_PRSC1 : ONEWIRE_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10:3</code>  <code>ONEWIRE_CTRL_CLKDIV7 : ONEWIRE_CTRL_CLKDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit clock divider value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>    <code>ONEWIRE_CTRL_TRIG_RST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger reset pulse, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code>    <code>ONEWIRE_CTRL_TRIG_BIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger single bit transmission, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code>    <code>ONEWIRE_CTRL_TRIG_BYTE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger full-byte transmission, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:14</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>ONEWIRE_CTRL_SENSE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of the bus line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>ONEWIRE_CTRL_PRESENCE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">device presence detected after reset pulse</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>ONEWIRE_CTRL_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff204</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <code>ONEWIRE_DATA_MSB : ONEWIRE_DATA_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_pulse_width_modulation_controller_pwm">2.7.19. Pulse-Width Modulation Controller (PWM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM output channels (12-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_PWM_NUM_CH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of PWM channels to implement (0..12)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong>
<strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The PWM module implements a pulse-width modulation controller with up to 12 independent channels providing
8-bit resolution per channel. The actual number of implemented channels is defined by the <code>IO_PWM_NUM_CH</code> generic.
Setting this generic to zero will completely remove the PWM controller from the design.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>pwm_o</code> has a static size of 12-bit. If less than 12 PWM channels are configured, only the LSB-aligned channel
bits are used while the remaining bits are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The PWM controller is activated by setting the <code>PWM_CTRL_EN</code> bit in the module&#8217;s control register <code>CTRL</code>. When this
bit is cleared, the unit is reset and all PWM output channels are set to zero. The module
provides three duty cycle registers <code>DC[0]</code> to <code>DC[2]</code>. Each register contains the duty cycle configuration for four
consecutive channels. For example, the duty cycle of channel 0 is defined via bits 7:0 in <code>DC[0]</code>. The duty cycle of
channel 2 is defined via bits 15:0 in <code>DC[0]</code> and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless of the configuration of <code>IO_PWM_NUM_CH</code> all module registers can be accessed without raising an exception.
Software can discover the number of available channels by writing 0xff to all duty cycle configuration bytes and
reading those values back. The duty-cycle of channels that were not implemented always reads as zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on the configured duty cycle the according intensity of the channel can be computed by the following formula:</p>
</div>
<div class="paragraph">
<p><em><strong>Intensity<sub>x</sub></strong></em> = <code>DC[y](i*8+7 downto i*8)</code> / (2<sup>8</sup>)</p>
</div>
<div class="paragraph">
<p>The base frequency of the generated PWM signals is defined by the PWM core clock. This clock is derived
from the main processor clock and divided by a prescaler via the 3-bit <code>PWM_CTRL_PRSCx</code> in the unit&#8217;s control
register.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 26. PWM prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>PWM_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The resulting PWM carrier frequency is defined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>PWM</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2<sup>8</sup> * <code>clock_prescaler</code>)</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. PWM register map (<code>struct neorv32_pwm_t</code>)</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 36.3637%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>0xfffff000</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>    <code>PWM_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:1</code>  <code>PWM_CTRL_PRSC2 : PWM_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:4</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffff004</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DC[0]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffff008</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DC[1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffff00c</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>DC[2]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 11</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_true_random_number_generator_trng">2.7.20. True Random-Number Generator (TRNG)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TRNG when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_TRNG_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO depth, min 1, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG FIFO level interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 true random number generator provides <em>physically</em> true random numbers. It is based on free-running
ring-oscillators that generate <strong>phase noise</strong> when being sampled by a constant clock. This phase noise is
used as physical entropy source. The TRNG features a platform independent architecture without FPGA-specific
primitives, macros or attributes so it can be synthesized for <em>any</em> FPGA.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">In-Depth Documentation</div>
For more information about the neoTRNG architecture and an analysis of its random quality check out the
neoTRNG repository: <a href="https://github.com/stnolting/neoTRNG" class="bare">https://github.com/stnolting/neoTRNG</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Inferring Latches</div>
The synthesis tool might emit warnings regarding <strong>inferred latches</strong> or <strong>combinatorial loops</strong>. However, this
is not design flaw as this is exactly what we want. ;)
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Simulation</div>
When simulating the processor the TRNG is automatically set to "simulation mode". In this mode the physical entropy
sources (the ring oscillators) are replaced by a simple <strong>pseudo RNG</strong> based on a LFSR providing only
<strong>deterministic pseudo-random</strong> data. The <code>TRNG_CTRL_SIM_MODE</code> flag of the control register is set if simulation
mode is active.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The TRNG features a single control register <code>CTRL</code> for control, status check and data access. When the <code>TRNG_CTRL_EN</code>
bit is set, the TRNG is enabled and starts operation. As soon as the <code>TRNG_CTRL_VALID</code> bit is set a new random data byte
is available and can be obtained from the lowest 8 bits of the <code>CTRL</code> register. If this bit is cleared, there is no
valid data available and the lowest 8 bit of the <code>CTRL</code> register are set to all-zero.</p>
</div>
<div class="paragraph">
<p>An internal entropy FIFO can be configured using the <code>IO_TRNG_FIFO</code> generic. This FIFO automatically samples
new random data from the TRNG to provide some kind of <em>random data pool</em> for applications, which require a large number
of random data in a short time. The random data FIFO can be cleared at any time either by disabling the TRNG or by
setting the <code>TRNG_CTRL_FIFO_CLR</code> flag. The FIFO depth can be retrieved by software via the <code>TRNG_CTRL_FIFO_*</code> bits.</p>
</div>
<div class="paragraph">
<p><strong>TRNG Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TRNG provides a single interrupt channel that can be programmed to trigger on certain FIFO fill-level conditions.
This feature can be used to inform the CPU that a certain amount of entropy is available for further processing. Using
the control register&#8217;s <code>TRNG_CTRL_IRQ_*</code> bits the IRQ can be configured to trigger if the data FIFO is empty
(<code>TRNG_CTRL_IRQ_FIFO_NEMPTY</code>), if the data FIFO is at least half full (<code>TRNG_CTRL_IRQ_FIFO_HALF</code>) or if the data FIFO is
entirely full (<code>TRNG_CTRL_IRQ_FIFO_NEMPTY</code>). Note that all enabled interrupt conditions are logically OR-ed.</p>
</div>
<div class="paragraph">
<p>Once the TRNG interrupt has fired it remains pending until the actual cause of the interrupt is resolved. Furthermore,
an active TRNG interrupt has to be explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. TRNG register map (<code>struct NEORV32_TRNG</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>0xfffffa00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <code>TRNG_CTRL_DATA_MSB : TRNG_CTRL_DATA_MSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit random data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>   -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19:16</code> <code>TRNG_CTRL_FIFO_MSB : TRNG_CTRL_FIFO_MSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth, log2(<code>IO_TRNG_FIFO</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25:20</code>  -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>TRNG_CTRL_IRQ_FIFO_NEMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if data FIFO is not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code>    <code>TRNG_CTRL_IRQ_FIFO_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if data FIFO is at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>TRNG_CTRL_IRQ_FIFO_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ if data FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>TRNG_CTRL_FIFO_CLR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush random data FIFO when set; auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>TRNG_CTRL_SIM_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simulation mode (PRNG!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>TRNG_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>TRNG_CTRL_VALID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random data is valid when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_custom_functions_subsystem_cfs">2.7.21. Custom Functions Subsystem (CFS)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom input conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom output conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CFS when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_CONFIG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom generic conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_IN_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_in_i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_CFS_OUT_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_out_o</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The custom functions subsystem is meant for implementing custom tightly-coupled co-processors or interfaces.
IT provides up to 64 32-bit memory-mapped read/write registers (<code>REG</code>, see register map below) that can be
accessed by the CPU via normal load/store operations. The actual functionality of these register has to be
defined by the hardware designer. Furthermore, the CFS provides two IO conduits to implement custom on-chip
or off-chip interfaces.</p>
</div>
<div class="paragraph">
<p>Just like any other externally-connected IP, logic implemented within the custom functions subsystem can operate
<em>independently</em> of the CPU providing true parallel processing capabilities. Potential use cases might include
dedicated hardware accelerators for en-/decryption (AES), signal processing (FFT) or AI applications
(CNNs) as well as custom IO systems like fast memory interfaces (DDR) and mass storage (SDIO), networking (CAN)
or real-time data transport (I2S).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you like to implement <em>custom instructions</em> that are executed right within the CPU&#8217;s ALU
see the <a href="#_zxcfu_isa_extension"><code>Zxcfu</code> ISA Extension</a> and the according <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Take a look at the template CFS VHDL source file (<code>rtl/core/neorv32_cfs.vhd</code>). The file is highly
commented to illustrate all aspects that are relevant for implementing custom CFS-based co-processor designs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CFS can also be used to <em>replicate</em> existing NEORV32 modules - for example to implement several TWI controllers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CFS Software Access</strong></p>
</div>
<div class="paragraph">
<p>The CFS memory-mapped registers can be accessed by software using the provided C-language aliases (see
register map table below). Note that all interface registers are defined as 32-bit words of type <code>uint32_t</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. CFS Software Access Example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// C-code CFS usage example
NEORV32_CFS-&gt;REG[0] = (uint32_t)some_data_array(i); // write to CFS register 0
int temp = (int)NEORV32_CFS-&gt;REG[20]; // read from CFS register 20</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CFS Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The CFS provides a single high-level-triggered interrupt request signal mapped to the CPU&#8217;s fast interrupt channel 1.
Once triggered, the interrupt becomes pending (if enabled in the <a href="#_mie"><strong><code>mie</code></strong></a> CSR) and has to be explicitly cleared again by
writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit. See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.</p>
</div>
<div class="paragraph">
<p><strong>CFS Configuration Generic</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS provides a single 32-bit <code>std_ulogic_vector</code> configuration generic <code>IO_CFS_CONFIG</code>
that is available in the processor&#8217;s top entity. This generic can be used to pass custom configuration options
from the top entity directly down to the CFS. The actual definition of the generic and it&#8217;s usage inside the
CFS is left to the hardware designer.</p>
</div>
<div class="paragraph">
<p><strong>CFS Custom IOs</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS also provides two unidirectional input and output conduits <code>cfs_in_i</code> and <code>cfs_out_o</code>.
These signals are directly propagated to the processor&#8217;s top entity. These conduits can be used to implement
application-specific interfaces like memory or peripheral connections. The actual use case of these signals
has to be defined by the hardware designer.</p>
</div>
<div class="paragraph">
<p>The size of the input signal conduit <code>cfs_in_i</code> is defined via the top&#8217;s <code>IO_CFS_IN_SIZE</code> configuration
generic (default = 32-bit). The size of the output signal conduit <code>cfs_out_o</code> is defined via the top&#8217;s
<code>IO_CFS_OUT_SIZE</code> configuration generic (default = 32-bit). If the custom function subsystem is not implemented
(<code>IO_CFS_EN</code> = false) the <code>cfs_out_o</code> signal is tied to all-zero.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. CFS register map (<code>struct NEORV32_CFS</code>)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffeb00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffeb04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffebf8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[62]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 62</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffebfc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REG[63]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS register 63</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_smart_led_interface_neoled">2.7.22. Smart LED Interface (NEOLED)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement NEOLED controller when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_NEOLED_TX_FIFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth, has to be a power of 2, min 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configurable NEOLED data FIFO interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED module provides a dedicated interface for "smart RGB LEDs" like WS2812, WS2811 or any other compatible
LEDs. These LEDs provide a single-wire interface that uses an asynchronous serial protocol for transmitting color
data.  Using the NEOLED module allows CPU-independent operation of an arbitrary number of smart LEDs. A configurable data
buffer (FIFO) allows to utilize block transfer operation without requiring the CPU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEOLED interface is compatible to the "Adafruit Industries NeoPixel&#8482;" products, which feature
WS2812 (or older WS2811) smart LEDs. Other LEDs might be compatible as well when adjusting the controller&#8217;s programmable
timing configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interface provides a single 1-bit output <code>neoled_o</code> to drive an arbitrary number of cascaded LEDs. Since the
NEOLED module provides 24-bit and 32-bit operating modes, a mixed setup with RGB LEDs (24-bit color)
and RGBW LEDs (32-bit color including a dedicated white LED chip) is possible.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules provides two accessible interface registers: the control register <code>CTRL</code> and the write-only
TX data register <code>DATA</code>. The NEOLED module is globally enabled via the control register&#8217;s
<code>NEOLED_CTRL_EN</code> bit. Clearing this bit will terminate any current operation, clear the TX buffer, reset the module
and set the <code>neoled_o</code> output to zero. The precise timing (e.g. implementing the <strong>WS2812</strong> protocol) and transmission
mode are fully programmable via the <code>CTRL</code> register to provide maximum flexibility.</p>
</div>
<div class="paragraph">
<p><strong>RGB / RGBW Configuration</strong></p>
</div>
<div class="paragraph">
<p>NeoPixel&#8482; LEDs are available in two "color" version: LEDs with three chips providing RGB color and LEDs with
four chips providing RGB color plus a dedicated white LED chip (= RGBW). Since the intensity of every
LED chip is defined via an 8-bit value the RGB LEDs require a frame of 24-bit per module and the RGBW
LEDs require a frame of 32-bit per module.</p>
</div>
<div class="paragraph">
<p>The data transfer quantity of the NEOLED module can be programmed via the <code>NEOLED_MODE_EN</code> control
register bit. If this bit is cleared, the NEOLED interface operates in 24-bit mode and will transmit bits <code>23:0</code> of
the data written to <code>DATA</code> to the LEDs. If <code>NEOLED_MODE_EN</code> is set, the NEOLED interface operates in 32-bit
mode and will transmit bits <code>31:0</code> of the data written to <code>DATA</code> to the LEDs.</p>
</div>
<div class="paragraph">
<p>The mode bit can be reconfigured before writing a new data word to <code>DATA</code> in order to support an arbitrary setup/mixture
of RGB and RGBW LEDs.</p>
</div>
<div class="paragraph">
<p><strong>Protocol</strong></p>
</div>
<div class="paragraph">
<p>The interface of the WS2812 LEDs uses an 800kHz carrier signal. Data is transmitted in a serial manner
starting with LSB-first. The intensity for each R, G &amp; B (&amp; W) LED chip (= color code) is defined via an 8-bit
value. The actual data bits are transferred by modifying the duty cycle of the signal (the timings for the
WS2812 are shown below). A RESET command is "send" by pulling the data line LOW for at least 50μs.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neopixel.png" alt="neopixel">
</div>
<div class="title">Figure 6. WS2812 bit-level protocol - taken from the "Adafruit NeoPixel&#8482; Überguide"</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. WS2812 interface timing</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>total</sub> (T<sub>carrier</sub>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25μs +/- 300ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">period for a single bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.85μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.45μs +/- 150 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Above 50μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a RESET command</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Timing Configuration</strong></p>
</div>
<div class="paragraph">
<p>The basic carrier frequency (800kHz for the WS2812 LEDs) is configured via a 3-bit main clock prescaler
(<code>NEOLED_CTRL_PRSC*</code>, see table below) that scales the main processor clock f<sub>main</sub> and a 5-bit cycle
multiplier <code>NEOLED_CTRL_T_TOT_*</code>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 31. NEOLED Prescaler Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>NEOLED_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The duty-cycles (or more precisely: the high- and low-times for sending either a '1' bit or a '0' bit) are
defined via the 5-bit <code>NEOLED_CTRL_T_ONE_H_*</code> and <code>NEOLED_CTRL_T_ZERO_H_*</code> values, respectively. These programmable
timing constants allow to adapt the interface for a wide variety of smart LED protocol (for example WS2812 vs.
WS2811).</p>
</div>
<div class="paragraph">
<p><strong>Timing Configuration - Example (WS2812)</strong></p>
</div>
<div class="paragraph">
<p>Generate the base clock f<sub>TX</sub> for the NEOLED TX engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processor clock f<sub>main</sub> = 100 MHz</p>
</li>
<li>
<p><code>NEOLED_CTRL_PRSCx</code> = <code>0b001</code> = f<sub>main</sub> / 4</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>f<sub>TX</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code> = 100MHz / 4 = 25MHz</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>TX</sub></strong></em> = 1 / <em><strong>f<sub>TX</sub></strong></em> = 40ns</p>
</div>
<div class="paragraph">
<p>Generate carrier period (T<sub>carrier</sub>) and <strong>high-times</strong> (duty cycle) for sending <code>0</code> (T<sub>0H</sub>) and <code>1</code> (T<sub>1H</sub>) bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NEOLED_CTRL_T_TOT</code> = <code>0b11110</code> (= decimal 30)</p>
</li>
<li>
<p><code>NEOLED_CTRL_T_ZERO_H</code> = <code>0b01010</code> (= decimal 10)</p>
</li>
<li>
<p><code>NEOLED_CTRL_T_ONE_H</code> = <code>0b10100</code> (= decimal 20)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>T<sub>carrier</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_TOT</code> = 40ns * 30 = 1.4µs</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>0H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_ZERO_H</code> = 40ns * 10 = 0.4µs</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>1H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <code>NEOLED_CTRL_T_ONE_H</code> = 40ns * 20 = 0.8µs</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEOLED SW driver library (<code>neorv32_neoled.h</code>) provides a simplified configuration
function that configures all timing parameters for driving WS2812 LEDs based on the processor
clock frequency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TX Data FIFO</strong></p>
</div>
<div class="paragraph">
<p>The interface features a configurable  TX data buffer (a FIFO) to allow more CPU-independent operation. The buffer
depth is configured via the <code>IO_NEOLED_TX_FIFO</code> top generic (default = 1 entry). The FIFO size configuration can be
read via the <code>NEOLED_CTRL_BUFS_x</code> control register bits, which result log2(<em>IO_NEOLED_TX_FIFO</em>).</p>
</div>
<div class="paragraph">
<p>When writing data to the <code>DATA</code> register the data is automatically written to the TX buffer. Whenever
data is available in the buffer the serial transmission engine will take and transmit it to the LEDs.
The data transfer size (<code>NEOLED_MODE_EN</code>) can be modified at any time since this control register bit is also buffered
in the FIFO. This allows an arbitrary mix of RGB and RGBW LEDs in the chain.</p>
</div>
<div class="paragraph">
<p>Software can check the FIFO fill level via the control register&#8217;s <code>NEOLED_CTRL_TX_EMPTY</code>, <code>NEOLED_CTRL_TX_HALF</code>
and <code>NEOLED_CTRL_TX_FULL</code> flags. The <code>NEOLED_CTRL_TX_BUSY</code> flags provides additional information if the the serial
transmit engine is still busy sending data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please note that the timing configurations (<code>NEOLED_CTRL_PRSCx</code>, <code>NEOLED_CTRL_T_TOT_x</code>,
<code>NEOLED_CTRL_T_ONE_H_x</code> and <code>NEOLED_CTRL_T_ZERO_H_x</code>) are <strong>NOT</strong> stored to the buffer. Changing
these value while the buffer is not empty or the TX engine is still busy will cause data corruption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Strobe Command ("RESET")</strong></p>
</div>
<div class="paragraph">
<p>According to the WS2812 specs the data written to the LED&#8217;s shift registers is strobed to the actual PWM driver
registers when the data line is low for 50μs ("RESET" command, see table above). This can be implemented
using busy-wait for at least 50μs. Obviously, this concept wastes a lot of processing power.</p>
</div>
<div class="paragraph">
<p>To circumvent this, the NEOLED module provides an option to automatically issue an idle time for creating the RESET
command. If the <code>NEOLED_CTRL_STROBE</code> control register bit is set, <em>all</em> data written to the data FIFO (via <code>DATA</code>,
the actually written data is irrelevant) will trigger an idle phase (<code>neoled_o</code> = zero) of 127 periods (= <em><strong>T<sub>carrier</sub></strong></em>).
This idle time will cause the LEDs to strobe the color data into the PWM driver registers.</p>
</div>
<div class="paragraph">
<p>Since the <code>NEOLED_CTRL_STROBE</code> flag is also buffered in the TX buffer, the RESET command is treated just as another
data word being written to the TX buffer making busy wait concepts obsolete and allowing maximum refresh rates.</p>
</div>
<div class="paragraph">
<p><strong>NEOLED Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules features a single interrupt that triggers based on the current TX buffer fill level.
The interrupt can only become pending if the NEOLED module is enabled. The specific interrupt condition
is configured via the <code>NEOLED_CTRL_IRQ_CONF</code> bit in the unit&#8217;s control register.</p>
</div>
<div class="paragraph">
<p>If <code>NEOLED_CTRL_IRQ_CONF</code> is set, the module&#8217;s interrupt is generated whenever the TX FIFO is less than half-full.
In this case software can write up to <code>IO_NEOLED_TX_FIFO</code>/2 new data words to <code>DATA</code> without checking the FIFO
status flags. If <code>NEOLED_CTRL_IRQ_CONF</code> is cleared, an interrupt is generated when the TX FIFO is empty.</p>
</div>
<div class="paragraph">
<p>One the NEOLED interrupt has been triggered and became pending, it has to explicitly cleared again by
writing zero to according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. NEOLED register map (<code>struct NEORV32_NEOLED</code>)</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 7.1428%;">
<col style="width: 35.7142%;">
<col style="width: 7.1428%;">
<col style="width: 35.7145%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="13"><p class="tableblock"><code>0xfffffd00</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="13"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>NEOLED_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <code>NEOLED_CTRL_MODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data transfer size; <code>0</code>=24-bit; <code>1</code>=32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <code>NEOLED_CTRL_STROBE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>=send normal color data; <code>1</code>=send RESET command on data write access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5:3</code>   <code>NEOLED_CTRL_PRSC2 : NEOLED_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:6</code>   <code>NEOLED_CTRL_BUFS3 : NEOLED_CTRL_BUFS0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit log2(<em>IO_NEOLED_TX_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14:10</code> <code>NEOLED_CTRL_T_TOT_4 : NEOLED_CTRL_T_TOT_0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5-bit pulse clock ticks per total single-bit period (T<sub>total</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19:15</code> <code>NEOLED_CTRL_T_ZERO_H_4 : NEOLED_CTRL_T_ZERO_H_0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a zero-bit (T<sub>0H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24:20</code> <code>NEOLED_CTRL_T_ONE_H_4 : NEOLED_CTRL_T_ONE_H_0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a one-bit (T<sub>1H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>    <code>NEOLED_CTRL_IRQ_CONF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO interrupt configuration: <code>0</code>=IRQ if FIFO is empty, <code>1</code>=IRQ if FIFO is less than half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>    <code>NEOLED_CTRL_TX_EMPTY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>NEOLED_CTRL_TX_HALF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is <em>at least</em> half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>NEOLED_CTRL_TX_FULL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>NEOLED_CTRL_TX_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX serial engine is busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffd04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> / <code>23:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data (32- or 24-bit, depending on <em>NEOLED_CTRL_MODE</em> bit)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_external_interrupt_controller_xirq">2.7.23. External Interrupt Controller (XIRQ)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupts input (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_NUM_CH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of external IRQ channels to implement (0..32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_TRIGGER_TYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger type configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIRQ_TRIGGER_POLARITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger polarity configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The external interrupt controller provides a simple mechanism to implement up to 32 processor-external interrupt
request signals. The external IRQ requests are prioritized, queued and signaled to the CPU via a
<em>single</em> CPU fast interrupt request.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The XIRQ provides up to 32 external interrupt channels configured via the <code>XIRQ_NUM_CH</code> generic. Each bit in the <code>xirq_i</code>
input signal vector represents one interrupt channel. If less than 32 channels are configured, only the LSB-aligned channels
are used while the remaining ones are left unconnected internally. The actual interrupt trigger type is configured before
synthesis using the <code>XIRQ_TRIGGER_TYPE</code> and <code>XIRQ_TRIGGER_POLARITY</code> generics (see table below).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. XIRQ Trigger Configuration</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>XIRQ_TRIGGER_TYPE(i)</code></th>
<th class="tableblock halign-center valign-top"><code>XIRQ_TRIGGER_POLARITY(i)</code></th>
<th class="tableblock halign-left valign-top">Resulting Trigger of <code>xirq_i(i)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">falling-edge</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rising-edge</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The interrupt controller features three interface registers: external interrupt channel enable (<code>EIE</code>), external interrupt
channel pending (<code>EIP</code>) and external interrupt source (<code>ESC</code>). From a functional point of view, the functionality of these
registers follow the one of the RISC-V <a href="#_mie"><strong><code>mie</code></strong></a>, <a href="#_mip"><strong><code>mip</code></strong></a> and <a href="#_mcause"><strong><code>mcause</code></strong></a> CSRs.</p>
</div>
<div class="paragraph">
<p>If the configured trigger of an interrupt channel fires (e.g. a rising edge) the according interrupt channel becomes <em>pending</em>,
which is indicated by the according channel bit being set in the <code>EIP</code> register. This pending interrupt can be cleared at any time
by writing zero to the according <code>EIP</code> bit.</p>
</div>
<div class="paragraph">
<p>A pending interrupt can only trigger a CPU interrupt if the according is enabled via the <code>EIE</code> register. Once triggered, disabled
channels that were triggered remain pending until explicitly cleared. The channels are prioritized in a static order, i.e. channel 0
(<code>xirq_i(0)</code>) has the highest priority and channel 31 (<code>xirq_i(31)</code>) has the lowest priority. If any pending interrupt channel is
actually enabled, an interrupt request is sent to the CPU.</p>
</div>
<div class="paragraph">
<p>The CPU can determine the most prioritized external interrupt request either by checking the bits in the <code>IPR</code> register or by reading
the interrupt source register <code>ESC</code>. This register provides a 5-bit wide ID (0..31) identifying the currently firing external interrupt.
Writing <em>any</em> value to this register will acknowledge the <em>current</em> XIRQ interrupt (so the XIRQ controller can issue a new CPU interrupt).</p>
</div>
<div class="paragraph">
<p>In order to acknowledge an XIRQ interrupt, the interrupt handler has to&#8230;&#8203;
* clear the pending CPU FIRQ by clearing the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit
* clear the pending XIRQ channel by clearing the according <code>EIP</code> bit
* writing <em>any</em> value to <code>ESC</code> to acknowledge the XIRQ interrupt</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. XIRQ register map (<code>struct NEORV32_XIRQ</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 58.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff300</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt enable register (one bit per channel, LSB-aligned)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff304</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt pending register (one bit per channel, LSB-aligned); writing 0 to a bit clears the according pending interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff308</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ESC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt source ID (0..31) of firing IRQ (prioritized!); writing <em>any</em> value will acknowledge the current XIRQ interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff30c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_timer_gptmr">2.7.24. General Purpose Timer (GPTMR)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gptmr_trig_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timer capture input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IO_GPTMR_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement general purpose timer when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The general purpose timer module implements a simple yet universal 32-bit timer. It is implemented if the processor&#8217;s
<code>IO_GPTMR_EN</code> top generic is set <code>true</code>. The timer provides a pre-scaled counter register that can trigger an interrupt
when reaching a programmable threshold value. Additionally, a timer-capture feature is implemented that copies the current
counter value to a dedicated register if a programmable edge occurs at the <code>gptmr_trig_i</code> input signal.</p>
</div>
<div class="paragraph">
<p>Four interface registers are available: a control register (<code>CTRL</code>), a 32-bit counter register (<code>COUNT</code>), a 32-bit
threshold register (<code>THRES</code>) and a 32-bit read-only capture register (<code>CAPTURE</code>). The timer is globally enabled by setting the
<code>GPTMR_CTRL_EN</code> bit in the device&#8217;s control register <code>CTRL</code>. When the timer is enable the <code>COUNT</code> register will start
incrementing at a programmable rate, which scales the main processor clock. The pre-scaler value is configured via the
three <code>GPTMR_CTRL_PRSCx</code> control register bits:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 35. GPTMR prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>GPTMR_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the timer will not clear the <code>COUNT</code> register. However, it can be manually reset at any time by
writing zero to it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interval Timer</strong></p>
</div>
<div class="paragraph">
<p>Whenever the counter register <code>COUNT</code> reaches the programmable threshold value <code>THRES</code> the counter register
is reset to zero and the <em>timer-match</em> flag <code>GPTMR_CTRL_TRIGM</code> gets set. This flag has to be cleared manually
by writing zero to it. Optionally, an interrupt can be triggered if the <code>GPTMR_CTRL_IRQM</code> bit is set.</p>
</div>
<div class="paragraph">
<p><strong>Timer Capture</strong></p>
</div>
<div class="paragraph">
<p>In addition to the the internal timer, the GPTMR provides a timer-capture feature. Whenever an edge is detected
at the <code>gptmr_trig_i</code> input signal the current <code>COUNT</code> value is copied to the read-only <code>CAPTURE</code> register and the
<em>capture-trigger</em> flag <code>GPTMR_CTRL_TRIGC</code> gets set. This flag has to be cleared manually by writing zero to it.
Optionally, an interrupt can be triggered if the <code>GPTMR_CTRL_IRQC</code> bit is set.</p>
</div>
<div class="paragraph">
<p>The triggering edge can be a rising-edge (if <code>GPTMR_CTRL_RISE</code> is set), a falling-edge (if <code>GPTMR_CTRL_FALL</code> is
set) or even both. By default, the <code>gptmr_trig_i</code> is sampled two times at the processor clock for checking for
edges. This simple edge detection is sufficient for trigger signals that are generated by (on-chip) digital logic.</p>
</div>
<div class="paragraph">
<p>For sampling chip-external signals an optional filtering mode is available that can be enabled by the
<code>GPTMR_CTRL_FILTER</code> bit. If this bit is set, the <code>gptmr_trig_i</code> is sampled at a reduced clock speed (1/4 of the
processor clock) and the signal has to be stable for at lest 4 sample clock in order to be considered high or low.
This stabilized signal is then fed to the edge detection logic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Timer Interrupt</div>
Once triggered, the timer interrupt remains pending within the CPU until it explicitly cleared by writing zero
to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. GPTMR register map (<code>struct NEORV32_GPTMR</code>)</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 5.5555%;">
<col style="width: 38.889%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xfffff100</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>   <code>GPTMR_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer enable flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:1</code> <code>GPTMR_CTRL_PRSC2 : GPTMR_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>   <code>GPTMR_CTRL_IRQM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable interrupt on timer-match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code>   <code>GPTMR_CTRL_IRQC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable interrupt on capture-trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code>   <code>GPTMR_CTRL_RISE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capture on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code>   <code>GPTMR_CTRL_FALL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capture on falling edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>   <code>GPTMR_CTRL_FILTER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filter capture input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:9</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>  <code>GPTMR_CTRL_TRIGM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer-match has fired, cleared by writing 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>  <code>GPTMR_CTRL_TRIGC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capture-trigger has fired, cleared by writing 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff104</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>THRES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff108</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffff10C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CAPTURE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capture register</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_execute_in_place_module_xip">2.7.25. Execute In Place Module (XIP)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_csn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit chip select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_clk_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement XIP module when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_EN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement XIP cache when <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_NUM_BLOCKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of blocks in XIP cache; has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XIP_CACHE_BLOCK_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of bytes per XIP cache block; has to be a power of two, min 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The execute in-place (XIP) module allows to execute code (and read constant data) directly from an external SPI flash memory.
The standard serial peripheral interface (SPI) is used as transfer protocol. All bus requests issued by the CPU
are converted transparently into SPI flash access commands. Hence, the external XIP flash behaves like a simple on-chip ROM.</p>
</div>
<div class="paragraph">
<p>From the CPU side, the modules provides two independent interfaces: one for transparently accessing the XIP flash and another
one for accessing the module&#8217;s control and status registers. The first interface provides the <em>transparent</em>
gateway to the SPI flash, so the CPU can directly fetch and execute instructions and/or read constant data.
Note that this interface is read-only. Any write access will raise a bus error exception. The second interface is
mapped to the processor&#8217;s IO space and allows accesses to the XIP module&#8217;s configuration registers as well as
conducting individual SPI transfers.</p>
</div>
<div class="paragraph">
<p>The XIP module provides an optional configurable cache to accelerate SPI flash accesses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">XIP Address Mapping</div>
When XIP mode is enabled the flash is mapped to fixed address space region starting at address
<code>0xE0000000</code> (see section <a href="#_address_space">Address Space</a>) supporting a maximum flash size of 256MB.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">XIP Example Program</div>
An example program is provided in <code>sw/example/demo_xip</code> that illustrate how to program and configure
an external SPI flash to run a program from it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SPI Configuration</strong></p>
</div>
<div class="paragraph">
<p>The XIP module accesses external flash using the standard SPI protocol. The module always sends data MSB-first and
provides all of the standard four clock modes (0..3), which are configured via the <code>XIP_CTRL_CPOL</code> (clock polarity)
and <code>XIP_CTRL_CPHA</code> (clock phase) control register bits, respectively. The flash&#8217;s "read command", which initiates
a read access, is defined by the <code>XIP_CTRL_RD_CMD</code> control register bits. For most SPI flash memories this is <code>0x03</code>
for <em>normal</em> SPI mode.</p>
</div>
<div class="paragraph">
<p>The SPI clock (<code>xip_clk_o</code>) frequency is programmed by the 3-bit <code>XIP_CTRL_PRSCx</code> clock prescaler for a coarse clock
selection and a 4-bit clock divider <code>XPI_CTRL_CDIVx</code> for a fine clock selection.
The following clock prescalers (<code>XIP_CTRL_PRSCx</code>) are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 37. XIP clock prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>XIP_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the programmed clock configuration, the actual SPI clock frequency f<sub>SPI</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code> * (1 + <code>XPI_CTRL_CDIVx</code>))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock is f<sub>main</sub> / 4 and the lowest SPI clock is f<sub>main</sub> / 131072. The SPI clock is always
symmetric having a duty cycle of 50%.</p>
</div>
<div class="paragraph">
<p><strong>High-Speed Mode</strong></p>
</div>
<div class="paragraph">
<p>The XIP module provides a high-speed mode to further boost the maximum SPI clock frequency. When enabled via the control
register&#8217;s <code>XIP_CTRL_HIGHSPEED</code> bit the clock prescaler configuration (<code>XIP_CTRL_PRSCx</code> bits) is overridden setting it
to a minimal factor of 1. However, the clock speed can still be fine-tuned using the <code>XPI_CTRL_CDIVx</code> bits.</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * 1 * (1 + <code>XPI_CTRL_CDIVx</code>))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock when in high-speed mode is f<sub>main</sub> / 2.</p>
</div>
<div class="paragraph">
<p><strong>Direct SPI Access</strong></p>
</div>
<div class="paragraph">
<p>The XIP module allows to initiate <em>direct</em> SPI transactions. This feature can be used to configure the attached SPI
flash or to perform direct read and write accesses to the flash memory. Two data registers <code>DATA_LO</code> and
<code>DATA_HI</code> are provided to send up to 64-bit of SPI data. The <code>DATA_HI</code> register is write-only,
so a total of just 32-bits of receive data is provided. Note that the module handles the chip-select
line (<code>xip_csn_o</code>) by itself so it is not possible to construct larger consecutive transfers.</p>
</div>
<div class="paragraph">
<p>The actual data transmission size in bytes is defined by the control register&#8217;s <code>XIP_CTRL_SPI_NBYTES</code> bits.
Any configuration from 1 byte to 8 bytes is valid. Other value will result in unpredictable behavior.</p>
</div>
<div class="paragraph">
<p>Since data is always transferred MSB-first, the data in <code>DATA_HI:DATA_LO</code> also has to be MSB-aligned. Receive data is
available in <code>DATA_LO</code> only since <code>DATA_HI</code> is write-only. Writing to <code>DATA_HI</code> triggers the actual SPI transmission.
The <code>XIP_CTRL_PHY_BUSY</code> control register flag indicates a transmission being in progress.</p>
</div>
<div class="paragraph">
<p>The chip-select line of the XIP module (<code>xip_csn_o</code>) will only become asserted (enabled, pulled low) if the
<code>XIP_CTRL_SPI_CSEN</code> control register bit is set. If this bit is cleared, <code>xip_csn_o</code> is always disabled
(pulled high).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Direct SPI mode is only possible when the module is enabled (setting <code>XIP_CTRL_EN</code>) but <strong>before</strong> the actual
XIP mode is enabled via <code>XIP_CTRL_XIP_EN</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When the XIP mode is not enabled, the XIP module can also be used as additional general purpose SPI controller
with a transfer size of up to 64 bits per transmission.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Using the XIP Mode</strong></p>
</div>
<div class="paragraph">
<p>The XIP module is globally enabled by setting the <code>XIP_CTRL_EN</code> bit in the device&#8217;s <code>CTRL</code> control register.
Clearing this bit will reset the whole module and will also terminate any pending SPI transfer.</p>
</div>
<div class="paragraph">
<p>Since there is a wide variety of SPI flash components with different sizes, the XIP module allows to specify
the address width of the flash: the number of address bytes used for addressing flash memory content has to be
configured using the control register&#8217;s <em>XIP_CTRL_XIP_ABYTES</em> bits. These two bits contain the number of SPI
address bytes (<strong>minus one</strong>). For example for a SPI flash with 24-bit addresses these bits have to be set to
<code>0b10</code>.</p>
</div>
<div class="paragraph">
<p>The transparent XIP accesses are transformed into SPI transmissions with the following format (starting with the MSB):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>8-bit command: configured by the <code>XIP_CTRL_RD_CMD</code> control register bits ("SPI read command")</p>
</li>
<li>
<p>8 to 32 bits address: defined by the <code>XIP_CTRL_XIP_ABYTES</code> control register bits ("number of address bytes")</p>
</li>
<li>
<p>32-bit data: sending zeros and receiving the according flash word (32-bit)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hence, the maximum XIP transmission size is 72-bit, which has to be configured via the <code>XIP_CTRL_SPI_NBYTES</code>
control register bits. Note that the 72-bit transmission size is only available in XIP mode. The transmission
size of the direct SPI accesses is limited to 64-bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using four SPI flash address bytes, the most significant 4 bits of the address are always hardwired
to zero allowing a maximum <strong>accessible</strong> flash size of 256MB.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The XIP module always fetches a full naturally aligned 32-bit word from the SPI flash. Any sub-word data masking
or alignment will be performed by the CPU core logic.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The XIP mode requires the 4-byte data words in the flash to be ordered in <strong>little-endian</strong> byte order.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the SPI properties (including the amount of address bytes <strong>and</strong> the total amount of SPI transfer bytes)
and XIP address mapping are configured, the actual XIP mode can be enabled by setting
the control register&#8217;s <code>XIP_CTRL_XIP_EN</code> bit. This will enable the "transparent SPI access port" of the module and thus,
the <em>transparent</em> conversion of access requests into proper SPI flash transmissions. Hence, any access to the processor&#8217;s
memory-mapped XIP region (<code>0xE0000000</code> to <code>0xEFFFFFFF</code>) will be converted into SPI flash accesses.
Make sure <code>XIP_CTRL_SPI_CSEN</code> is also set so the module can actually select/enable the attached SPI flash.
No more direct SPI accesses via <code>DATA_HI:DATA_LO</code> are possible when the XIP mode is enabled. However, the
XIP mode can be disabled at any time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the XIP module is disabled (<em>XIP_CTRL_EN</em> = <code>0</code>) any accesses to the memory-mapped XIP flash address region
will raise a bus access exception. If the XIP module is enabled (<em>XIP_CTRL_EN</em> = <code>1</code>) but XIP mode is not enabled
yet (<em>XIP_CTRL_XIP_EN</em> = '0') any access to the programmed XIP memory segment will also raise a bus access exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is highly recommended to enable the <a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a> to cover some
of the SPI access latency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>XIP Cache</strong></p>
</div>
<div class="paragraph">
<p>Since every single instruction fetch request from the CPU is translated into serial SPI transmissions the access latency is
very high resulting in a low throughput. In order to improve performance, the XIP module provides an optional cache that
allows to buffer recently-accessed data. The cache is implemented as a simple direct-mapped read-only cache with a configurable
cache layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XIP_CACHE_EN</code>: when set to <code>true</code> the CIP cache is implemented</p>
</li>
<li>
<p><code>XIP_CACHE_NUM_BLOCKS</code> defines the number of cache blocks (or lines)</p>
</li>
<li>
<p><code>XIP_CACHE_BLOCK_SIZE</code> defines the size in bytes of each cache block</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the cache is implemented, the XIP module operates in <strong>burst mode</strong> utilizing the flash&#8217;s <em>incremental read</em> capabilities.
Thus, several bytes (= <code>XIP_CACHE_BLOCK_SIZE</code>) are read consecutively from the flash using a single read command.</p>
</div>
<div class="paragraph">
<p>The XIP cache is cleared when the XIP module is disabled (<code>XIP_CTRL_EN = 0</code>), when XIP mode is disabled
(<code>XIP_CTRL_XIP_EN = 0</code>) or when the CPU issues a <code>fence(.i)</code> instruction.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. XIP Register Map (<code>struct NEORV32_XIP</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 46.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="15"><p class="tableblock"><code>0xffffff40</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="15"><p class="tableblock"><code>CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <code>XIP_CTRL_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:1</code>   <code>XIP_CTRL_PRSC2 : XIP_CTRL_PRSC0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit SPI clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>     <code>XIP_CTRL_CPOL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code>     <code>XIP_CTRL_CPHA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock phase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:6</code>   <code>XIP_CTRL_SPI_NBYTES_MSB : XIP_CTRL_SPI_NBYTES_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes in SPI transaction (1..9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>    <code>XIP_CTRL_XIP_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP mode enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12:11</code> <code>XIP_CTRL_XIP_ABYTES_MSB : XIP_CTRL_XIP_ABYTES_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of address bytes for XIP flash (minus 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:13</code> <code>XIP_CTRL_RD_CMD_MSB : XIP_CTRL_RD_CMD_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flash read command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code>    <code>XIP_CTRL_SPI_CSEN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow SPI chip-select to be actually asserted when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code>    <code>XIP_CTRL_HIGHSPEED</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable SPI high-speed mode (ignoring <code>XIP_CTRL_PRSCx</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:26</code> <code>XIP_CTRL_CDIV3 : XIP_CTRL_CDIV0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider for fine-tuning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:28</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <code>XIP_CTRL_BURST_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP burst mode enabled (if XIP cache is implemented)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <code>XIP_CTRL_PHY_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI PHY busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <code>XIP_CTRL_XIP_BUSY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP access in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff44</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff48</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA_LO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct SPI access - data register low</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff4C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATA_HI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct SPI access - data register high; write access triggers SPI transfer</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_system_configuration_information_memory_sysinfo">2.7.26. System Configuration Information Memory (SYSINFO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">most of the top&#8217;s configuration generics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The SYSINFO allows the application software to determine the setting of most of the <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>
that are related to processor/SoC configuration. All registers of this unit are read-only.
This device is always implemented - regardless of the actual hardware configuration. The bootloader as well
as the NEORV32 software runtime environment require information from this device (like memory layout
and default clock frequency) for correct operation.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. SYSINFO register map (<code>struct NEORV32_SYSINFO</code>)</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffe00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock frequency in Hz (via top&#8217;s <code>CLOCK_FREQUENCY</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffe04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEM[4]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal memory configuration (see <a href="#_sysinfo_memory_configuration">SYSINFO - Memory Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffe08</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specific SoC configuration (see <a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffe0c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache configuration information (see <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a>)</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sysinfo_memory_configuration">SYSINFO - Memory Configuration</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bit fields in this register are set to all-zero if the according cache is not implemented.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. SYSINFO <code>MEM</code> Bytes</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Byte</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MEM_IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(internal IMEM size in bytes), via top&#8217;s <code>MEM_INT_IMEM_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MEM_DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(internal DMEM size in bytes), via top&#8217;s <code>MEM_INT_DMEM_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_MEM_RVSG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(reservation set size granularity in bytes), via top&#8217;s <code>AMO_RVS_GRANULARITY</code> generic</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_soc_configuration">SYSINFO - SoC Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. SYSINFO <code>SOC</code> Bits</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_BOOTLOADER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal bootloader is implemented (via top&#8217;s <code>INT_BOOTLOADER_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_MEM_EXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the external Wishbone bus interface is implemented (via top&#8217;s <code>MEM_EXT_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_MEM_INT_IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal DMEM implemented (via top&#8217;s <code>MEM_INT_DMEM_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_MEM_INT_DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal IMEM is implemented (via top&#8217;s <code>MEM_INT_IMEM_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_MEM_EXT_ENDIAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if external bus interface uses BIG-endian byte-order (via top&#8217;s <code>MEM_EXT_BIG_ENDIAN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_ICACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal instruction cache is implemented (via top&#8217;s <code>ICACHE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_DCACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal data cache is implemented (via top&#8217;s <code>DCACHE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_CLOCK_GATING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if CPU clock gating is implemented (via top&#8217;s <code>CLOCK_GATING_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11:8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_CRC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if cyclic redundancy check unit is implemented (via top&#8217;s <code>IO_CRC_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SLINK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if stream link interface is implemented (via top&#8217;s <code>IO_SLINK_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_DMA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if direct memory access controller is implemented (via top&#8217;s <code>IO_DMA_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_GPIO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the GPIO is implemented (via top&#8217;s <code>IO_GPIO_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_MTIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the MTIME is implemented (via top&#8217;s <code>IO_MTIME_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_UART0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the primary UART0 is implemented (via top&#8217;s <code>IO_UART0_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SPI is implemented (via top&#8217;s <code>IO_SPI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TWI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI is implemented (via top&#8217;s <code>IO_TWI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_PWM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the PWM is implemented (via top&#8217;s <code>IO_PWM_NUM_CH</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>21</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_WDT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the WDT is implemented (via top&#8217;s <code>IO_WDT_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>22</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_CFS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the custom functions subsystem is implemented (via top&#8217;s <code>IO_CFS_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_TRNG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TRNG is implemented (via top&#8217;s <code>IO_TRNG_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_SDI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SDI is implemented (via top&#8217;s <code>IO_SDI_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_UART1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the secondary UART1 is implemented (via top&#8217;s <code>IO_UART1_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>26</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_NEOLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the NEOLED is implemented (via top&#8217;s <code>IO_NEOLED_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_XIRQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the XIRQ is implemented (via top&#8217;s <code>XIRQ_NUM_CH</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_GPTMR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the GPTMR is implemented (via top&#8217;s <code>IO_GPTMR_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>29</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_XIP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the XIP module is implemented (via top&#8217;s <code>XIP_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_IO_ONEWIRE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the ONEWIRE interface is implemented (via top&#8217;s <code>IO_ONEWIRE_EN</code> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_SOC_OCD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if on-chip debugger is implemented (via top&#8217;s <code>ON_CHIP_DEBUGGER_EN</code> generic)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_cache_configuration">SYSINFO - Cache Configuration</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bit fields in this register are set to all-zero if the according cache is not implemented.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. SYSINFO <code>CACHE</code> Bits</caption>
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 47.619%;">
<col style="width: 47.6191%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_IC_BLOCK_SIZE_3 : SYSINFO_CACHE_IC_BLOCK_SIZE_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache block size in bytes), via top&#8217;s <code>ICACHE_BLOCK_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_IC_NUM_BLOCKS_3 : SYSINFO_CACHE_IC_NUM_BLOCKS_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache number of cache blocks), via top&#8217;s <code>ICACHE_NUM_BLOCKS</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11:9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_IC_ASSOCIATIVITY_3 : SYSINFO_CACHE_IC_ASSOCIATIVITY_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache associativity), via top&#8217;s <code>ICACHE_ASSOCIATIVITY</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_IC_REPLACEMENT_3 : SYSINFO_CACHE_IC_REPLACEMENT_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-cache replacement policy (<code>0001</code> = LRU if associativity &gt; 0)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DC_BLOCK_SIZE_3 : SYSINFO_CACHE_DC_BLOCK_SIZE_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(d-cache block size in bytes), via top&#8217;s <code>DCACHE_BLOCK_SIZE</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23:20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DC_NUM_BLOCKS_3 : SYSINFO_CACHE_DC_NUM_BLOCKS_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(d-cache number of cache blocks), via top&#8217;s <code>DCACHE_NUM_BLOCKS</code> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>27:24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DC_ASSOCIATIVITY_3 : SYSINFO_CACHE_DC_ASSOCIATIVITY_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSINFO_CACHE_DC_REPLACEMENT_3 : SYSINFO_CACHE_DC_REPLACEMENT_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always zero</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 CPU is an area-optimized RISC-V core implementing the <code>rv32i_zicsr_zifencei</code> base (privileged) ISA and
supporting several additional/optional ISA extensions. The CPU&#8217;s micro architecture is based on a von-Neumann
machine build upon a mixture of multi-cycle and pipelined execution schemes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This chapter assumes that the reader is familiar with the official
RISC-V <em>User</em> and <em>Privileged Architecture</em> specifications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_risc_v_compatibility">RISC-V Compatibility</a></p>
</li>
<li>
<p><a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a> and <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_architecture">Architecture</a> and <a href="#_full_virtualization">Full Virtualization</a></p>
</li>
<li>
<p><a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a> and <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a></p>
</li>
<li>
<p><a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a></p>
</li>
<li>
<p><a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a></p>
</li>
<li>
<p><a href="#_bus_interface">Bus Interface</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_risc_v_compatibility">3.1. RISC-V Compatibility</h3>
<div class="paragraph">
<p>The NEORV32 CPU passes the tests of the <strong>official RISCOF RISC-V Architecture Test Framework</strong>. This framework is used to check
RISC-V implementations for compatibility to the official RISC-V user/privileged ISA specifications. The NEORV32 port of this
test framework is available in a separate repository at GitHub: <a href="https://github.com/stnolting/neorv32-riscof" class="bare">https://github.com/stnolting/neorv32-riscof</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Unsupported ISA Extensions</div>
Executing instructions or accessing CSRs from yet unsupported ISA extensions will raise an illegal
instruction exception (see section  <a href="#_full_virtualization">Full Virtualization</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Incompatibility Issues and Limitations</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title"><code>time[h]</code> CSRs (Wall Clock Time)</div>
The NEORV32 does not implement the <code>time[h]</code> registers. Any access to these registers will trap. It is
recommended that the trap handler software provides a means of accessing the platform-defined <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">No Hardware Support of Misaligned Memory Accesses</div>
The CPU does not support resolving unaligned memory access by the hardware (this is not a
RISC-V-incompatibility issue but an important thing to know!). Any kind of unaligned memory access
will raise an exception to allow a <em>software-based</em> emulation provided by the application. However, unaligned memory
access can be <strong>emulated</strong> using the NEORV32 runtime environment. See section <a href="#_application_context_handling">Application Context Handling</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">No Atomic Read-Modify-Write Operations</div>
The NEORV32 <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> only supports the load-reservate (LR) and store-conditional (SR) instructions.
The remaining read-modify-write operations are not supported. However, these missing instructions can
be emulated. The NEORV32 <a href="#_core_libraries">Core Libraries</a> provide an emulation wrapper for the missing AMO/read-modify-write
instructions that is based on LR/SC pairs. A demo/program can be found in <code>sw/example/atomic_test</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_signals">3.2. CPU Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the CPU top entity <code>rtl/core/neorv32_cpu.vhd</code>. The
type of all signals is <em>std_ulogic</em> or <em>std_ulogic_vector</em>, respectively. The "Dir." column shows the signal
direction as seen from the CPU.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 43. NEORV32 CPU Signal List</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 8.3333%;">
<col style="width: 41.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width/Type</th>
<th class="tableblock halign-center valign-top">Dir</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Global Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global clock line, all registers triggering on rising edge, this clock can be switched off during <a href="#_sleep_mode">Sleep Mode</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_aux_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always-on clock, used to keep the the sleep control active when <code>clk_i</code> is switched off</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global reset, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sleep_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU is in <a href="#_sleep_mode">Sleep Mode</a> when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>debug_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU is in <a href="#_cpu_debug_mode">debug mode</a> when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Interrupts (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine software interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mei_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine external interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mti_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom fast interrupt request signals</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dbi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request CPU to halt and enter debug mode (RISC-V <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Instruction <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ibus_req_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_req_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fetch bus request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ibus_rsp_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_rsp_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fetch bus response</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Data <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dbus_req_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_req_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data access (load/store) bus request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dbus_rsp_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bus_rsp_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data access (load/store) bus response</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bus Interface Protocol</div>
See section <a href="#_bus_interface">Bus Interface</a> for the instruction fetch and data access interface protocol and the
according interface types (<code>bus_req_t</code> and <code>bus_rsp_t</code>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_generics">3.3. CPU Top Entity - Generics</h3>
<div class="paragraph">
<p>Most of the CPU configuration generics are a subset of the actual Processor configuration generics
(see section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>). and are not listed here. However, the CPU provides
some <em>specific</em> generics that are used to configure the CPU for the NEORV32 processor setup. These generics
are assigned by the processor setup only and are not available for user defined configuration.
The specific generics are listed below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Table Abbreviations</div>
The generic type "suv(x:y)" defines a <code>std_ulogic_vector(x downto y)</code>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 44. NEORV32 CPU-Exclusive Generic List</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_BOOT_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU reset address. See section <a href="#_address_space">Address Space</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_DEBUG_PARK_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Park loop" entry address for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>, has to be 4-byte aligned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_DEBUG_EXC_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">suv(31:0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Exception" entry address for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>, has to be 4-byte aligned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Sdext</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement RISC-V-compatible "debug" CPU operation mode required for the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Sdtrig</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement RISC-V-compatible trigger module. See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_architecture">3.4. Architecture</h3>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_cpu.png" alt="neorv32 cpu">
</div>
</div>
<div class="paragraph">
<p>The CPU implements a pipelined multi-cycle architecture: each instruction is executed as a series of consecutive
micro-operations. In order to increase performance, the CPU&#8217;s front-end (instruction fetch) and back-end
(instruction execution) are de-couples via a FIFO (the instruction prefetch buffer. Thus, the front-end can already
fetch new instructions while the back-end is still processing the previously-fetched instructions.</p>
</div>
<div class="paragraph">
<p>Basically, the CPU&#8217;s micro architecture is somewhere between a classical pipelined architecture, where each stage
requires exactly one processing cycle (if not stalled) and a classical multi-cycle architecture, which executes
every single instruction (<em>including</em> fetch) in a series of consecutive micro-operations. The combination of these
two design paradigms allows an increased instruction execution in contrast to a pure multi-cycle approach (due to
overlapping operation of fetch and execute) at a reduced hardware footprint (due to the multi-cycle concept).</p>
</div>
<div class="paragraph">
<p>As a Von-Neumann machine, the CPU provides independent interfaces for instruction fetch and data access. However,
these two bus interfaces are merged into a single processor-internal bus via a prioritizing bus switch (data accesses
have higher priority). Hence, <em>all</em> memory addresses including peripheral devices are mapped to a single unified 32-bit
<a href="#_address_space">Address Space</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CPU does not perform any speculative/out-of-order operations at all. Hence, it is not vulnerable to security issues
caused by speculative execution (like Spectre or Meltdown).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_register_file">3.4.1. CPU Register File</h4>
<div class="paragraph">
<p>The data register file contains the general purpose architecture registers <code>x0</code> to <code>x31</code>. For the <code>rv32e</code> ISA only the lower
16 registers are implemented. Register zero (<code>x0</code>/<code>zero</code>) always read as zero and any write access to it has no effect.
Up to four individual synchronous read ports allow to fetch up to 4 register operands at once. The write and read accesses
are mutually exclusive as they happen in separate cycles. Hence, there is no need to consider things like "read-during-write"
behavior.</p>
</div>
<div class="paragraph">
<p>The register file provides two different implementation options configured via the top&#8217;s <code>REGFILE_HW_RST</code> generic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>REGFILE_HW_RST = false</code> (default): In this configuration the register file is implemented as plain memory array without a
dictated hardware reset. This architecture allows to infer FPGA block RAM for the entire register file resulting in minimal
logic utilization and optimal timing.</p>
</li>
<li>
<p><code>REGFILE_HW_RST = true</code>: This configuration is based on individual FFs that do provide a dedicated hardware reset.
Hence, the register cannot be mapped to FPGA block RAM. This optional should only be selected if the application requires a
reset of the register file (e.g. for security reasons) or if the design shall be synthesized for an <strong>ASIC</strong> implementation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The state of this configuration generic can be checked by software via the <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">FPGA Implementation</div>
Enabling the <code>REGFILE_HW_RST</code> option for FPGA implementation is not recommended as this will massively increase the amount
of required logic resources.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Implementation of the <code>zero</code> Register within FPGA Block RAM</div>
Register <code>zero</code> is also mapped to a <em>physical memory location</em> within the register file&#8217;s block RAM. By this, there is no need
to add a further multiplexer to "insert" zero if reading from register <code>zero</code> reducing logic requirements and shortening the
critical path. However, this also requires that the physical storage bits of register <code>zero</code> are explicitly initialized (set
to zero) by the hardware. This is done transparently by the CPU control requiring no additional processing overhead.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Block RAM Ports</div>
The default register file configuration uses two access ports: a read-only port for reading register <code>rs2</code> (second source operand)
and a read/write port for reading register <code>rs1</code> (first source operand) and for writing processing results to register <code>rd</code>
(destination register). Hence, a simple dual-port RAM can be used to implement the entire register file. From a functional point
of view, read and write accesses to the register file do never occur in the same clock cycle, so no bypass logic is required at all.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_arithmetic_logic_unit">3.4.2. CPU Arithmetic Logic Unit</h4>
<div class="paragraph">
<p>The arithmetic/logic unit (ALU) is used for actual data processing as well as generating memory and branch addresses.
All "simple" <a href="#_i_isa_extension"><code>I</code> ISA Extension</a> computational instructions (like <code>add</code> and <code>or</code>) are implemented as plain combinatorial logic
requiring only a single cycle to complete. More sophisticated instructions like shift operations or multiplications are processed
by so-called "ALU co-processors".</p>
</div>
<div class="paragraph">
<p>The co-processors are implemented as iterative units that require several cycles to complete processing. Besides the base ISA&#8217;s
shift instructions, the co-processors are used to implement all further processing-based ISA extensions (e.g. <a href="#_m_isa_extension"><code>M</code> ISA Extension</a>
and <a href="#_b_isa_extension"><code>B</code> ISA Extension</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Multi-Cycle Execution Monitor</div>
The CPU control will raise an illegal instruction exception if a multi-cycle functional unit (like the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>)
does not complete processing in a bound amount of time (configured via the package&#8217;s <code>monitor_mc_tmo_c</code> constant; default = 512 clock cycles).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tuning Options</div>
The ALU architecture can be tuned for an application-specific area-vs-performance trade-off. The <code>FAST_MUL_EN</code> and <code>FAST_SHIFT_EN</code>
generics can be used to implement performance-optimized barrel shifters and DSP blocks, respectively. See sections <a href="#_i_isa_extension"><code>I</code> ISA Extension</a>,
<a href="#_b_isa_extension"><code>B</code> ISA Extension</a> and <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> for specific examples.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_bus_unit">3.4.3. CPU Bus Unit</h4>
<div class="paragraph">
<p>The bus unit takes care of handling data memory accesses via load and store instructions. It handles data adjustment when accessing
sub-word data quantities (16-bit or 8-bit) and performs sign-extension for singed load operations. The bus unit also includes the optional
<a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a> that performs permission checks for all data and instruction accesses.</p>
</div>
<div class="paragraph">
<p>A list of the bus interface signals and a detailed description of the protocol can be found in section <a href="#_bus_interface">Bus Interface</a>.
All bus interface signals are driven/buffered by registers; so even a complex SoC interconnection bus network will not
effect maximal operation frequency.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Unaligned Accesses</div>
The CPU does not support a hardware-based handling of unaligned memory accesses! Any unaligned access will raise a bus load/store unaligned
address exception. The exception handler can be used to <em>emulate</em> unaligned memory accesses in software.
See the NEORV32 Runtime Environment&#8217;s <a href="#_application_context_handling">Application Context Handling</a> section for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_control_unit">3.4.4. CPU Control Unit</h4>
<div class="paragraph">
<p>The CPU control unit is responsible for generating all the control signals for the different CPU modules.
The control unit is split into a "front-end" and a "back-end".</p>
</div>
<div class="paragraph">
<p><strong>Front-End</strong></p>
</div>
<div class="paragraph">
<p>The front-end is responsible for fetching instructions in chunks of 32-bits. This can be a single aligned 32-bit instruction,
two aligned 16-bit instructions or a mixture of those. The instructions including control and exception information are stored
to a FIFO queue - the instruction prefetch buffer (IPB). This FIFO has a depth of two entries by default but can be customized
via the <code>ipb_depth_c</code> VHDL package constant.</p>
</div>
<div class="paragraph">
<p>The FIFO allows the front-end to do "speculative" instruction fetches, as it keeps fetching the next consecutive instruction
all the time. This also allows to decouple front-end (instruction fetch) and back-end (instruction execution) so both modules
can operate in parallel to increase performance. However, all potential side effects that are caused by this "speculative"
instruction fetch are already handled by the CPU front-end ensuring a defined execution stage while preventing security
side attacks.</p>
</div>
<div class="paragraph">
<p><strong>Back-End</strong></p>
</div>
<div class="paragraph">
<p>Instruction data from the instruction prefetch buffer is decompressed (if the <code>C</code> ISA extension is enabled) and sent to the
CPU back-end for actual execution. Execution is conducted by a state-machine that controls all of the CPU modules. The back-end also
includes the <a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> as well as the trap controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sleep_mode">3.4.5. Sleep Mode</h4>
<div class="paragraph">
<p>The NEORV32 CPU provides a single sleep mode that can be entered to power-down the core reducing
dynamic power consumption. Sleep mode is entered by executing the <code>wfi</code> ("wait for interrupt") instruction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>wfi</code> instruction will raise an illegal instruction exception when executed in user-mode
if <code>TW</code> in <a href="#_mstatus"><strong><code>mstatus</code></strong></a> is set. When executed in debug-mode or during single-stepping <code>wfi</code> will behave as
simple <code>nop</code> without entering sleep mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After executing the <code>wfi</code> instruction the CPU&#8217;s <code>sleep_o</code> signal (<a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a>) will become set
as soon as the CPU has fully halted ("CPU is sleeping"):</p>
</div>
<div class="paragraph">
<div class="title">There is not enabled interrupt pending.</div>
<p>CPU-external modules like memories, timers and peripheral interfaces are not affected by this. Furthermore, the CPU will
continue to buffer/enqueue incoming interrupt. The CPU will leave sleep mode as soon as any <em>enabled (via <a href="#_mie"><strong><code>mie</code></strong></a>)
interrupt source becomes _pending</em> or if a debug session is started.</p>
</div>
<div class="sect4">
<h5 id="_power_down_mode">Power-Down Mode</h5>
<div class="paragraph">
<p>Optionally, the sleep mode can also be used to shut down the CPU&#8217;s main clock to further reduce power consumption
by halting the core&#8217;s clock tree. This clock gating mode is enabled by the <code>CLOCK_GATING_EN</code> generic
(<a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).  See section <a href="#_processor_clocking">Processor Clocking</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_full_virtualization">3.4.6. Full Virtualization</h4>
<div class="paragraph">
<p>Just like the RISC-V ISA, the NEORV32 aims to provide <em>maximum virtualization</em> capabilities on CPU and SoC level to
allow a high standard of <strong>execution safety</strong>. The CPU supports <strong>all</strong> traps specified by the official RISC-V
specifications. Thus, the CPU provides defined hardware fall-backs via traps for any expected and unexpected situations
(e.g. executing a malformed or not supported instruction or accessing a non-allocated memory address). For any kind
of trap the core is always in a defined and fully synchronized state throughout the whole system (i.e. there are no
out-of-order operations that might have to be reverted). This allows a defined and predictable execution behavior
at any time improving overall execution safety.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_bus_interface">3.5. Bus Interface</h3>
<div class="paragraph">
<p>The NEORV32 CPU provides separated instruction fetch and data access interfaces making it a <strong>Harvard Architecture</strong>:
the instruction fetch interface (<code>i_bus_*</code> signals) is used for fetching instructions and the data access interface
(<code>d_bus_*</code> signals) is used to access data via load and store operations. Each of these interfaces can access an address
space of up to 2<sup>32</sup> bytes (4GB).</p>
</div>
<div class="paragraph">
<p>The bus interface uses two custom interface types: <code>bus_req_t</code> is used to propagate the bus access <strong>requests</strong>. These
signals are driven by the <em>accessing</em> device (i.e. the CPU core). <code>bus_rsp_t</code> is used to return the bus <strong>response</strong> and
is driven by the <em>accessed</em> device or bus system (i.e. a processor-internal memory or IO device).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 45. Bus Interface - Request Bus (<code>bus_req_t</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>addr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access address (byte addressing)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ben</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte-enable for each byte in <code>data</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request trigger ("strobe", single-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rw</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access direction (<code>0</code> = read, <code>1</code> = write)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>src</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access source (<code>0</code> = instruction fetch, <code>1</code> = load/store)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>priv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if privileged (M-mode) access</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rvso</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set if current access is a reservation-set operation (atomic <code>lr</code> or <code>sc</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data/instruction fence operation; valid without <code>stb</code> being set</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 46. Bus Interface - Response Bus (<code>bus_rsp_t</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read data (single-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer acknowledge / success (single-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>err</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer error / fail (single-shot)</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_bus_interface_protocol">3.5.1. Bus Interface Protocol</h4>
<div class="paragraph">
<p>Transactions are triggered entirely by the request bus. A new bus request is initiated by setting the <em>strobe</em>
signal <code>stb</code> high for exactly one cycle. All remaining signals of the bus are set together with <code>stb</code> and will
remain unchanged until the transaction is completed.</p>
</div>
<div class="paragraph">
<p>The transaction is completed when the accessed device returns a response via the response interface:
<code>ack</code> is high for exactly one cycle if the transaction was completed successfully. <code>err</code> is high for exactly
one cycle if the transaction failed to complete. These two signals are mutually exclusive. In case of a read
access the read data is returned together with the <code>ack</code> signal. Otherwise, the return data signal is
kept at all-zero allowing wired-or interconnection of all response buses.</p>
</div>
<div class="paragraph">
<p>The figure below shows three exemplary bus accesses:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>A read access to address <code>A_addr</code> returning <code>rdata</code> after several cycles (slow response; <code>ACK</code> arrives after several cycles).</p>
</li>
<li>
<p>A write access to address <code>B_addr</code> writing <code>wdata</code> (fastest response; <code>ACK</code> arrives right in the next cycle).</p>
</li>
<li>
<p>A failing read access to address <code>C_addr</code> (slow response; <code>ERR</code> arrives after several cycles).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/bus_interface.png" alt="700">
</div>
<div class="title">Figure 7. Three Exemplary Bus Transactions</div>
</div>
</div>
<div class="sect3">
<h4 id="_atomic_accesses">3.5.2. Atomic Accesses</h4>
<div class="paragraph">
<p>The load-reservate (<code>lr.w</code>) and store-conditional (<code>sc.w</code>) instructions from the <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> execute as standard
load/store bus transactions but with the <code>rvso</code> ("reservation set operation") signal being set. It is the task of the
<a href="#_reservation_set_controller">Reservation Set Controller</a> to handle these LR/SC bus transactions accordingly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Reservation Set Controller</div>
See section <a href="#_address_space">Address Space</a> / <a href="#_reservation_set_controller">Reservation Set Controller</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Modify-Write Operations</div>
Read-modify-write operations (line an atomic swap / <code>amoswap.w</code>) are <strong>not</strong> supported. However, the NEORV32
<a href="#_core_libraries">Core Libraries</a> provide an emulation wrapper for those unsupported instructions that is
based on LR/SC pairs. A demo/program can be found in <code>sw/example/atomic_test</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The figure below shows three exemplary bus accesses (1 to 3 from left to right). The <code>req</code> signal record represents
the CPU-side of the bus interface. For easier understanding the current state of the reservation set is added as <code>rvs_valid</code> signal.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>A load-reservate (LR) instruction using <code>addr</code> as address. This instruction returns the loaded data <code>rdata</code> via <code>rsp.data</code>
and also registers a reservation for the address <code>addr</code> (<code>rvs_valid</code> becomes set).</p>
</li>
<li>
<p>A store-conditional (SC) instruction attempts to write <code>wdata1</code> to address <code>addr</code>. This SC operation <strong>succeeds</strong>, so
<code>wdata1</code> is actually written to address <code>addr</code>. The successful operation is indicated by a <strong>0</strong> being returned via
<code>rsp.data</code> together with <code>ack</code>. As the LR/SC is completed the registered reservation is invalidated (<code>rvs_valid</code> becomes cleared).</p>
</li>
<li>
<p>Another store-conditional (SC) instruction attempts to write <code>wdata2</code> to address <code>addr</code>. As the reservation set is already
invalidated (<code>rvs_valid</code> is <code>0</code>) the store access fails, so <code>wdata2</code> is <strong>not</strong> written to address <code>addr</code> at all. The failed
operation is indicated by a <strong>1</strong> being returned via <code>rsp.data</code> together with <code>ack</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/bus_interface_atomic.png" alt="700">
</div>
<div class="title">Figure 8. Three Exemplary LR/SC Bus Transactions</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">SC Status</div>
The "normal" load data mechanism is used to return success/failure of the <code>sc.w</code> instruction to the CPU (via the LSB of <code>rsp.data</code>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_instruction_sets_and_extensions">3.6. Instruction Sets and Extensions</h3>
<div class="paragraph">
<p>The NEORV32 CPU provides several optional RISC-V and custom ISA extensions. The extensions can be enabled/configured
via the according <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>. This chapter gives a brief overview of the different ISA extensions.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 47. NEORV32 Instruction Set Extensions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 50%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"><a href="#_processor_top_entity_generics">Enabled by Generic</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_a_isa_extension"><code>A</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic memory access instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_A</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_b_isa_extension"><code>B</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_B</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_c_isa_extension"><code>C</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed (16-bit) instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_e_isa_extension"><code>E</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Embedded CPU extension (reduced register file size)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_E</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_i_isa_extension"><code>I</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer base ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled if <code>CPU_EXTENSION_RISCV_E</code> is <strong>not</strong> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_m_isa_extension"><code>M</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer multiplication and division instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_M</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_u_isa_extension"><code>U</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less-privileged <em>user</em> mode extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_x_isa_extension"><code>X</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform-specific / NEORV32-specific extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zifencei_isa_extension"><code>Zifencei</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction stream synchronization instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zfinx_isa_extension"><code>Zfinx</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point instructions using integer registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicntr_isa_extension"><code>Zicntr</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base counters extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicond_isa_extension"><code>Zicond</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer conditional operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zicond</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register access instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zihpm_isa_extension"><code>Zihpm</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware performance monitors extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zmmul_isa_extension"><code>Zmmul</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer multiplication-only instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zmmul</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zcfu_isa_extension"><code>Zcfu</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom / user-defined instructions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_EXTENSION_RISCV_Zxcfu</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmp_isa_extension"><code>PMP</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP_NUM_REGIONS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdext_isa_extension"><code>Sdext</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External debug support extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ON_CHIP_DEBUGGER_EN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdtrig_isa_extension"><code>Sdtrig</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger module extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ON_CHIP_DEBUGGER_EN</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">RISC-V ISA Specifications</div>
For more information regarding the RISC-V ISA extensions please refer to the "RISC-V Instruction Set Manual - Volume
I: Unprivileged ISA" and "The RISC-V Instruction Set Manual Volume II: Privileged Architecture" Acopy of all currently
implemented ISA extensions can be found in the projects <code>docs/references</code> folder.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Discovering ISA Extensions</div>
Software can discover available ISA extensions via the <a href="#_misa"><strong><code>misa</code></strong></a> and <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs or by executing an instruction
and checking for an illegal instruction exception (i.e. <a href="#_full_virtualization">Full Virtualization</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">ISA Extensions-Specific CSRs</div>
The <a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> section lists the according ISA extensions for all CSRs.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_a_isa_extension">3.6.1. <code>A</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>A</code> ISA extension adds instructions and mechanisms for atomic memory access operations. Note that the NEORV32 <code>A</code>
only includes the <em>load-reservate</em> (<code>lr.w</code>) and <em>store-conditional</em> (<code>sc.w</code>) instructions - the remaining read-modify-write
instructions (like <code>amoswap</code>) are <strong>not supported</strong>. However, these missing instructions can be emulated using the
LR and SC operations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">AMO Emulation</div>
The NEORV32 <a href="#_core_libraries">Core Libraries</a> provide an emulation wrapper for the missing AMO/read-modify-write instructions that is
based on LR/SC pairs. A demo/program can be found in <code>sw/example/atomic_test</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Atomic instructions allow to notify an application if a certain memory location has been altered by another instance
(like another process running on the same CPU or a DMA access). Hence, they can be used to implement synchronization
mechanisms like mutexes and semaphores).</p>
</div>
<div class="paragraph">
<p>The NEORV32 <code>A</code> extension is enabled via the <code>CPU_EXTENSION_RISCV_A</code> generic (see <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
When enabled the following additional instructions are available.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 48. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load-reservate word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lr.w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store-conditional word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sc.w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>lr.w</code> instructions stores one word to a word-aligned address and registers a <em>reservation set</em>. The <code>sc.w</code>
instruction stores a word to a word-aligned address only if the reservation set is still valid. Furthermore, the
<code>sc.w</code> operations returns the state of the reservation set (0 = reservation set still valid, data has been written;
1 = reservation set was broken, no data has been written). The reservation set is invalidated if another <code>lr.w</code> instruction
is executed or if any write access to the <em>reservated</em> address takes place. Traps and/or CPU privilege level changes
do not modify current reservation sets.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>aq</code> and <code>rl</code> Bits</div>
The instruction word&#8217;s <code>aq</code> and <code>lr</code> memory ordering bits are not evaluated by the hardware at all.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Atomic Memory Access on Hardware Level</div>
More information regarding the atomic memory accesses and the according reservation
sets can be found in section <a href="#_reservation_set_controller">Reservation Set Controller</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Cache Coherency</div>
Atomic operations <strong>always bypass</strong> the CPU caches using direct/uncached accesses. Care must be taken
to maintain data cache coherency (e.g. by using the <code>fence</code> instruction).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_b_isa_extension">3.6.2. <code>B</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>B</code> ISA extension adds instructions for bit-manipulation operations.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_cp_bitmanip.vhd</code>).
The NEORV32 <code>B</code> ISA extension includes the following sub-extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Zba</code> - Address-generation instructions</p>
</li>
<li>
<p><code>Zbb</code> - Basic bit-manipulation instructions</p>
</li>
<li>
<p><code>Zbc</code> - Carry-less multiplication instructions</p>
</li>
<li>
<p><code>Zbs</code> - Single-bit instructions</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 49. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arithmetic/logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min[u]</code> <code>max[u]</code> <code>sext.b</code> <code>sext.h</code> <code>andn</code> <code>orn</code> <code>xnor</code> <code>zext</code>(pack) <code>rev8</code>(grevi) <code>orc.b</code>(gorci)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clz</code> <code>ctz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 1..32; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rol</code> <code>ror[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <em>shift_amount</em>; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shifted-add</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sbset[i]</code> <code>sbclr[i]</code> <code>sbinv[i]</code> <code>sbext[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carry-less multiply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clmul</code> <code>clmulh</code> <code>clmulr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Barrel Shifter</div>
Shift operations can be accelerated (at the cost of additional logic resources) by enabling the <code>FAST_SHIFT_EN</code>
configuration option that will replace the (time-variant) bit-serial shifter by a (time-constant) barrel shifter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_c_isa_extension">3.6.3. <code>C</code> ISA Extension</h4>
<div class="paragraph">
<p>The "compressed" ISA extension provides 16-bit encodings of commonly used instructions to reduce code space size.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 50. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.addi4spn</code> <code>c.nop</code> <code>c.add[i]</code> <code>c.li</code> <code>c.addi16sp</code> <code>c.lui</code> <code>c.and[i]</code> <code>c.sub</code> <code>c.xor</code> <code>c.or</code> <code>c.mv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.srli</code> <code>c.srai</code> <code>c.slli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 1..32; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.beqz</code> <code>c.bnez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">taken: 6; not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumps / calls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.jal[r]</code> <code>c.j</code> <code>c.jr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.lw</code> <code>c.sw</code> <code>c.lwsp</code> <code>c.swsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c.break</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_e_isa_extension">3.6.4. <code>E</code> ISA Extension</h4>
<div class="paragraph">
<p>The "embedded" ISA extensions reduces the size of the general purpose register file from 32 entries to 16 entries to
shrink hardware size. It provides the same instructions as the the base <code>I</code> ISA extensions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to the reduced register file size an alternate toolchain ABI (<code>ilp32e*</code>) is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_i_isa_extension">3.6.5. <code>I</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>I</code> ISA extensions is the base RISC-V integer ISA that is always enabled.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 51. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add[i]</code> <code>slt[i]</code> <code>slt[i]u</code> <code>xor[i]</code> <code>or[i]</code> <code>and[i]</code> <code>sub</code> <code>lui</code> <code>auipc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU shifts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sll[i]</code> <code>srl[i]</code> <code>sra[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 1..32; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beq</code> <code>bne</code> <code>blt</code> <code>bge</code> <code>bltu</code> <code>bgeu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">taken: 6; not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jump/call</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jal[r]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load/store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lb</code> <code>lh</code> <code>lw</code> <code>lbu</code> <code>lhu</code> <code>sb</code> <code>sh</code> <code>sw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecall</code> <code>ebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data fence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wfi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Illegal inst.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>fence</code> Instruction</div>
The <code>fence</code> instruction word&#8217;s <em>predecessor</em> and <em>successor</em> bits (used for memory ordering) are not evaluated
by the hardware at all. For the NEORV32 the <code>fence</code> instruction behaves exactly like the <code>fence.i</code> instruction
(see <a href="#_zifencei_isa_extension"><code>Zifencei</code> ISA Extension</a>). However, software should still use distinct <code>fence</code> and <code>fence.i</code> to provide
platform-compatibility and to indicate the actual intention of the according fence instruction(s).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>wfi</code> Instruction</div>
The <code>wfi</code> instruction is used to enter <a href="#_sleep_mode">Sleep Mode</a>. Executing the <code>wfi</code> instruction in user-mode
will raise an illegal instruction exception if the <code>TW</code> bit of <a href="#_mstatus"><strong><code>mstatus</code></strong></a> is set.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Barrel Shifter</div>
The shift operations are implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_cp_shifter.vhd</code>).
These operations can be accelerated (at the cost of additional logic resources) by enabling the <code>FAST_SHIFT_EN</code>
configuration option that will replace the (time-variant) bit-serial shifter by a (time-constant) barrel shifter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_m_isa_extension">3.6.6. <code>M</code> ISA Extension</h4>
<div class="paragraph">
<p>Hardware-accelerated integer multiplication and division operations are available via the RISC-V <code>M</code> ISA extension.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_cp_muldiv.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 52. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36; FAST_MUL: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div</code> <code>divu</code> <code>rem</code> <code>remu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DSP Blocks</div>
Multiplication operations can be accelerated (at the cost of additional logic resources) by enabling the <code>FAST_MUL_EN</code>
configuration option that will replace the (time-variant) bit-serial multiplier by (time-constant) FPGA DSP blocks.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_u_isa_extension">3.6.7. <code>U</code> ISA Extension</h4>
<div class="paragraph">
<p>In addition to the highest-privileged machine-mode, the user-mode ISA extensions adds a second <strong>less-privileged</strong>
operation mode. Code executed in user-mode has reduced CSR access rights. Furthermore, user-mode accesses to the address space
(like peripheral/IO devices) can be constrained via the physical memory protection.
Any kind of privilege rights violation will raise an exception to allow <a href="#_full_virtualization">Full Virtualization</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_x_isa_extension">3.6.8. <code>X</code> ISA Extension</h4>
<div class="paragraph">
<p>The NEORV32-specific ISA extensions <code>X</code> is always enabled. The most important points of the NEORV32-specific extensions are:
* The CPU provides 16 <em>fast interrupt</em> interrupts (<code>FIRQ</code>), which are controlled via custom bits in the <a href="#_mie"><strong><code>mie</code></strong></a>
and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs. These extensions are mapped to CSR bits, that are available for custom use according to the
RISC-V specs. Also, custom trap codes for <a href="#_mcause"><strong><code>mcause</code></strong></a> are implemented.
* All undefined/unimplemented/malformed/illegal instructions do raise an illegal instruction exception (see <a href="#_full_virtualization">Full Virtualization</a>).
* There are <a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zifencei_isa_extension">3.6.9. <code>Zifencei</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zifencei</code> CPU extension allows manual synchronization of the instruction stream. This extension is always enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">NEORV32 Fence Instructions</div>
The NEORV32 treats both fence instructions (<code>fence</code> = data fence, <code>fence.i</code> = instruction fence) in exactly the same way.
Both instructions cause a flush of the CPU&#8217;s instruction prefetch buffer and also send a fence request via the system
bus (see <a href="#_bus_interface">Bus Interface</a>). This system bus fence operation will, for example, clear/flush all downstream caches.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 53. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction fence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence.i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zfinx_isa_extension">3.6.10. <code>Zfinx</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zfinx</code> floating-point extension is an <em>alternative</em> of the standard <code>F</code> floating-point ISA extension.
It also uses the integer register file <code>x</code> to store and operate on floating-point data
instead of a dedicated floating-point register file. Thus, the <code>Zfinx</code> extension requires
less hardware resources and features faster context changes. This also implies that there are NO dedicated <code>f</code>
register file-related load/store or move instructions. The <code>Zfinx</code> extension&#8217;S floating-point unit is controlled
via dedicated <a href="#_floating_point_csrs">Floating-Point CSRs</a>.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_cp_fpu.vhd</code>).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Fused Multiply-Add and Division Instructions</div>
Fused multiply-add instructions <code>f[n]m[add/sub].s</code> are not supported!
Division <code>fdiv.s</code> and square root <code>fsqrt.s</code> instructions are not supported yet!
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Subnormal Number</div>
Subnormal numbers ("de-normalized" numbers, i.e. exponent = 0) are not supported by the NEORV32 FPU.
Subnormal numbers are <em>flushed to zero</em> setting them to +/- 0 before being processed by <strong>any</strong> FPU operation.
If a computational instruction generates a subnormal result it is also flushed to zero during normalization.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 54. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artihmetic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fadd.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artihmetic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fsub.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artihmetic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmul.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmin.s</code> <code>fmax.s</code> <code>feq.s</code> <code>flt.s</code> <code>fle.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fcvt.w.s</code> <code>fcvt.wu.s</code> <code>fcvt.s.w</code> <code>fcvt.s.wu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Misc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fsgnj.s</code> <code>fsgnjn.s</code> <code>fsgnjx.s</code> <code>fclass.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zicntr_isa_extension">3.6.11. <code>Zicntr</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zicntr</code> ISA extension adds the basic <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a>, <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a>, <a href="#_instreth"><strong><code>instret[h]</code></strong></a> and <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a>
counter CSRs. Section <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> shows a list of all <code>Zicntr</code>-related CSRs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The user-mode <code>time[h]</code> CSRs are <strong>not implemented</strong>. Any access will trap allowing the trap handler to
retrieve system time from the <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This extensions is stated as <em>mandatory</em> by the RISC-V spec. However, area-constrained setups may remove
support for these counters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicond_isa_extension">3.6.12. <code>Zicond</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zicond</code> ISA extension adds integer conditional move primitives that allow to implement branch-less
control flows. It is enabled by the top&#8217;s <code>CPU_EXTENSION_RISCV_Zicond</code> generic.
This ISA extension is implemented as multi-cycle ALU co-process (<code>rtl/core/neorv32_cpu_cp_cond.vhd</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 55. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>czero.eqz</code> <code>czero.nez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zicsr_isa_extension">3.6.13. <code>Zicsr</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extensions provides instructions for accessing the <a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> as well as further
privileged-architecture extensions. This extension is mandatory and cannot be disabled. Hence, there is no generic
for enabling/disabling this ISA extension.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>rd=x0</code> for the <code>csrrw[i]</code> instructions there will be no actual read access to the according CSR.
However, access privileges are still enforced so these instruction variants <em>do</em> cause side-effects
(the RISC-V spec. state that these combinations "shall" not cause any side-effects).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 56. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>csrrw[i]</code> <code>csrrs[i]</code> <code>csrrc[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zihpm_isa_extension">3.6.14. <code>Zihpm</code> ISA Extension</h4>
<div class="paragraph">
<p>In additions to the base counters the NEORV32 CPU provides up to 13 hardware performance monitors (HPM 3..15),
which can be used to benchmark applications. Each HPM consists of an N-bit wide counter (split in a high-word 32-bit
CSR and a low-word 32-bit CSR), where N is defined via the top&#8217;s
<code>HPM_CNT_WIDTH</code> generic and a corresponding event configuration CSR. The event configuration
CSR defines the architectural events that lead to an increment of the associated HPM counter. See section
<a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a> for a list of all HPM-related CSRs and event configurations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Auto-increment of the HPMs can be deactivated individually via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmul_isa_extension">3.6.15. <code>Zmmul</code> - ISA Extension</h4>
<div class="paragraph">
<p>This is a sub-extension of the <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> ISA extension. It implements only the multiplication operations
of the <code>M</code> extensions and is intended for size-constrained setups that require hardware-based
integer multiplications but not hardware-based divisions, which will be computed entirely in software.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zxcfu_isa_extension">3.6.16. <code>Zxcfu</code> ISA Extension</h4>
<div class="paragraph">
<p>The <code>Zxcfu</code> presents a NEORV32-specific ISA extension. It adds the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> to
the CPU core, which allows to add custom RISC-V instructions to the processor core.
For detailed information regarding the CFU, its hardware and the according software interface
see section <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.</p>
</div>
<div class="paragraph">
<p>Software can utilize the custom instructions by using <em>intrinsics</em>, which are basically inline assembly functions that
behave like regular C functions but that evaluate to a single custom instruction word (no calling overhead at all).</p>
</div>
</div>
<div class="sect3">
<h4 id="_pmp_isa_extension">3.6.17. <code>PMP</code> ISA Extension</h4>
<div class="paragraph">
<p>The NEORV32 physical memory protection (PMP, also known as <code>Smpmp</code> ISA extension) provides an elementary memory
protection mechanism that can be used to constrain read, write and execute rights of arbitrary memory regions.
The NEORV32 PMP is fully compatible to the RISC-V Privileged Architecture Specifications. In general, the PMP can
<strong>grant permissions to user mode</strong>, which by default has none, and can <strong>revoke permissions from M-mode</strong>, which
by default has full permissions. The PMP is configured via the <a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a>.</p>
</div>
<div class="paragraph">
<p>Several <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> are provided to fine-tune the CPU&#8217;s PMP capabilities:
* <code>PMP_NUM_REGIONS</code> defines the number of implemented PMP region
* <code>PMP_MIN_GRANULARITY</code> defines the minimal granularity of each region
* <code>PMP_TOR_MODE_EN</code> controls the implementation of the top-of-region (TOR) mode
* <code>PMP_NAP_MODE_EN</code> controls the implementation of the naturally-aligned-power-of-two (NA4 and NAPOT) modes</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">PMP Rules when in Debug Mode</div>
When in debug-mode all PMP rules are ignored making the debugger have maximum access rights.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Instruction fetches are also triggered when denied by a certain PMP rule. However, the fetched instruction(s)
will not be executed and will not change CPU core state.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sdext_isa_extension">3.6.18. <code>Sdext</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extension enables the RISC-V-compatible "external debug support" by implementing
the CPU "debug mode", which is required for the on-chip debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 57. Instructions and Timing</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Instructions</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sdtrig_isa_extension">3.6.19. <code>Sdtrig</code> ISA Extension</h4>
<div class="paragraph">
<p>This ISA extension implements the RISC-V-compatible "trigger module".
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_trigger_module">Trigger Module</a> for more information.</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_functions_unit_cfu">3.7. Custom Functions Unit (CFU)</h3>
<div class="paragraph">
<p>The Custom Functions Unit is the central part of the <a href="#_zxcfu_isa_extension"><code>Zxcfu</code> ISA Extension</a> and represents
the actual hardware module, which can be used to implement <em>custom RISC-V instructions</em>.</p>
</div>
<div class="paragraph">
<p>The CFU is intended for operations that are inefficient in terms of performance, latency, energy consumption or
program memory requirements when implemented entirely in software. Some potential application fields and exemplary
use-cases might include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AI:</strong> sub-word / vector / SIMD operations like processing all four bytes of a 32-bit data word in parallel</p>
</li>
<li>
<p><strong>Cryptographic:</strong> bit substitution and permutation</p>
</li>
<li>
<p><strong>Communication:</strong> conversions like binary to gray-code; multiply-add operations</p>
</li>
<li>
<p><strong>Image processing:</strong> look-up-tables for color space transformations</p>
</li>
<li>
<p>implementing instructions from <strong>other RISC-V ISA extensions</strong> that are not yet supported by the NEORV32</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CFU is not intended for complex and <em>CPU-independent</em> functional units that implement complete accelerators
(like block-based AES encryption). These kind of accelerators should be implemented as memory-mapped
<a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>. A comparison of all NEORV32-specific chip-internal hardware extension
options is provided in the user guide section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cfu_instruction_formats">3.7.1. CFU Instruction Formats</h4>
<div class="paragraph">
<p>The custom instructions executed by the CFU utilize a specific opcode space in the <code>rv32</code> 32-bit instruction
space that has been explicitly reserved for user-defined extensions by the RISC-V specifications ("Guaranteed
Non-Standard Encoding Space"). The NEORV32 CFU uses the <code>custom</code> opcodes to identify the instructions implemented
by the CFU and to differentiate between the different instruction formats. The according binary encoding of these
opcodes is shown below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>custom-0</code>: <code>0001011</code> RISC-V standard, used for <a href="#_cfu_r3_type_instructions">CFU R3-Type Instructions</a></p>
</li>
<li>
<p><code>custom-1</code>: <code>0101011</code> RISC-V standard, used for <a href="#_cfu_r4_type_instructions">CFU R4-Type Instructions</a></p>
</li>
<li>
<p><code>custom-2</code>: <code>1011011</code> NEORV32-specific, used for <a href="#_cfu_r5_type_instructions">CFU R5-Type Instructions</a> type A</p>
</li>
<li>
<p><code>custom-3</code>: <code>1111011</code> NEORV32-specific, used for <a href="#_cfu_r5_type_instructions">CFU R5-Type Instructions</a> type B</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_cfu_r3_type_instructions">CFU R3-Type Instructions</h5>
<div class="paragraph">
<p>The R3-type CFU instructions operate on two source registers <code>rs1</code> and <code>rs2</code> and return the processing result to
the destination register <code>rd</code>. The actual operation can be defined by using the <code>funct7</code> and <code>funct3</code> bit fields.
These immediates can also be used to pass additional data to the CFU like offsets, look-up-tables addresses or
shift-amounts. However, the actual functionality is entirely user-defined.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 xnor rs2</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r3type_instruction.png" alt="cfu r3type instruction">
</div>
<div class="title">Figure 9. CFU R3-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>funct7</code>: 7-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0001011</code> (RISC-V "custom-0" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The CFU R3-type instruction format is compliant to the RISC-V ISA specification.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
By using the <code>funct7</code> and <code>funct3</code> bit fields entirely for selecting the actual operation a total of 1024 custom
R3-type instructions can be implemented (7-bit + 3-bit = 10 bit &#8594; 1024 different values).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_cfu_r4_type_instructions">CFU R4-Type Instructions</h5>
<div class="paragraph">
<p>The R4-type CFU instructions operate on three source registers <code>rs1</code>, <code>rs2</code> and <code>rs2</code> and return the processing
result to the destination register <code>rd</code>. The actual operation can be defined by using the <code>funct3</code> bit field.
Alternatively, this immediate can also be used to pass additional data to the CFU like offsets, look-up-tables
addresses or shift-amounts. However, the actual functionality is entirely user-defined.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; (rs1 * rs2 + rs3)[31:0]</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r4type_instruction.png" alt="cfu r4type instruction">
</div>
<div class="title">Figure 10. CFU R4-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rs3</code>: address of third source register (32-bit source data)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0101011</code> (RISC-V "custom-1" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The CFU R4-type instruction format is compliant to the RISC-V ISA specification.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unused instruction bits</div>
The RISC-V ISA specification defines bits [26:25] of the R4-type instruction word to be all-zero. These bits
are ignored by the hardware (CFU and illegal instruction check logic) and should be set to all-zero to preserve
compatibility with future ISA spec. versions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
By using the <code>funct3</code> bit field entirely for selecting the actual operation a total of 8 custom R4-type
instructions can be implemented (3-bit &#8594; 8 different values).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_cfu_r5_type_instructions">CFU R5-Type Instructions</h5>
<div class="paragraph">
<p>The R5-type CFU instructions operate on four source registers <code>rs1</code>, <code>rs2</code>, <code>rs3</code> and <code>r4</code> and return the
processing result to the destination register <code>rd</code>. As all bits of the instruction word are used to encode the
five registers and the opcode, no further immediate bits are available to specify the actual operation. There
are two different R5-type instruction with two different opcodes available. Hence, only two R5-type operations
can be implemented out of the box.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 &amp; rs2 &amp; rs3 &amp; rs4</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r5type_instruction_a.png" alt="cfu r5type instruction a">
</div>
<div class="title">Figure 11. CFU R5-type instruction A format</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r5type_instruction_b.png" alt="cfu r5type instruction b">
</div>
<div class="title">Figure 12. CFU R5-type instruction B format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rs4.hi</code> &amp; <code>rs4.lo</code>: address of fourth source register (32-bit source data)</p>
</li>
<li>
<p><code>rs3</code>: address of third source register (32-bit source data)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>1011011</code> (RISC-V "custom-2" opcode) and/or <code>1111011</code> (RISC-V "custom-3" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The RISC-V ISA specifications does not specify a R5-type instruction format. Hence, this instruction
format is NEORV32-specific.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
There are no immediate fields in the CFU R5-type instruction so the actual operation is specified entirely
by the opcode resulting in just two different operations out of the box. However, another CFU instruction
(like a R3-type instruction) can be used to "program" the actual operation of a R5-type instruction by
writing operation information to a CFU-internal "command" register.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_custom_instructions_in_software">3.7.2. Using Custom Instructions in Software</h4>
<div class="paragraph">
<p>The custom instructions provided by the CFU can be used in plain C code by using <strong>intrinsics</strong>. Intrinsics
behave like "normal" C functions but under the hood they are a set of macros that hide the complexity of inline assembly.
Using intrinsics removes the need to modify the compiler, built-in libraries or the assembler when using custom
instructions. Each intrinsic will be compiled into a single 32-bit instruction word providing maximum code efficiency.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CFU Example Program</div>
There is an example program for the CFU, which shows how to use the <em>default</em> CFU hardware module.
This example program is located in <code>sw/example/demo_cfu</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 software framework provides four pre-defined prototypes for custom instructions, which are defined in
<code>sw/lib/include/neorv32_cpu_cfu.h</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. CFU instruction prototypes</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_cfu_r3_instr(funct7, funct3, rs1, rs2) // R3-type instructions
neorv32_cfu_r4_instr(funct3, rs1, rs2, rs3)    // R4-type instructions
neorv32_cfu_r5_instr_a(rs1, rs2, rs3, rs4)     // R5-type instruction A
neorv32_cfu_r5_instr_b(rs1, rs2, rs3, rs4)     // R5-type instruction B</code></pre>
</div>
</div>
<div class="paragraph">
<p>The intrinsic functions always return a 32-bit value of type <code>uint32_t</code> (the processing result), which can be discarded
if not needed. Each intrinsic function requires several arguments depending on the instruction type/format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>funct7</code> - 7-bit immediate (R3-type only)</p>
</li>
<li>
<p><code>funct3</code> - 3-bit immediate (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs1</code> - source operand 1, 32-bit (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs2</code> - source operand 2, 32-bit (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs3</code> - source operand 3, 32-bit (R3-type, R4-type, R5-type)</p>
</li>
<li>
<p><code>rs4</code> - source operand 4, 32-bit (R4-type, R4-type, R5-type)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>funct3</code> and <code>funct7</code> bit-fields are used to pass 3-bit or 7-bit literals to the CFU. The <code>rs1</code>, <code>rs2</code>, <code>rs3</code>
and <code>r4</code> arguments pass the actual data to the CFU. These register arguments can be populated with variables or
literals. The following example shows how to pass arguments:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. CFU instruction usage example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">uint32_t tmp = some_function();
...
uint32_t res = neorv32_cfu_r3_instr(0b0000000, 0b101, tmp, 123);
uint32_t foo = neorv32_cfu_r4_instr(0b011, tmp, res, (uint32_t)some_array[i]);
uint32_t bar = neorv32_cfu_r5_instr_a(tmp, res, foo, tmp);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cfu_control_and_status_registers_cfu_csrs">3.7.3. CFU Control and Status Registers (CFU-CSRs)</h4>
<div class="paragraph">
<p>The CPU provides up to four control and status registers (<a href="#_cfureg"><code>cfureg*</code></a>) to be
used within the CFU. These CSRs are mapped to the "custom user-mode read/write" CSR address space, which is
explicitly reserved for platform-specific application by the RISC-V spec. For example, these CSRs can be used
to pass additional operands to the CFU, to obtain additional results, to check processing status or to program
operation modes.</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. CFU CSR Access Example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_cpu_csr_write(CSR_CFUREG0, 0xabcdabcd); // write data to CFU CSR 0
uint32_t tmp = neorv32_cpu_csr_read(CSR_CFUREG3); // read data from CFU CSR 3</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Additional CFU-internal CSRs</div>
If more than four CFU-internal CSRs are required the designer can implement an "indirect access mechanism" based
on just two of the default CSRs: one CSR is used to configure the index while the other is used as alias to exchange
data with the indexed CFU-internal CSR - this concept is similar to the RISC-V Indirect CSR Access Extension
Specification (<code>Smcsrind</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_instructions_hardware">3.7.4. Custom Instructions Hardware</h4>
<div class="paragraph">
<p>The actual functionality of the CFU&#8217;s custom instructions is defined by the user-defined logic inside
the CFU hardware module <code>rtl/core/neorv32_cpu_cp_cfu.vhd</code>.</p>
</div>
<div class="paragraph">
<p>CFU operations can be entirely combinatorial (like bit-reversal) so the result is available at the end of
the current clock cycle. Operations can also take several clock cycles to complete (like multiplications)
and may also include internal states and memories. The CFU&#8217;s internal control unit takes care of
interfacing the custom user logic to the CPU pipeline.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CFU Hardware Example &amp; More Details</div>
The default CFU hardware module already implement some exemplary instructions that are used for illustration
by the CFU example program. See the CFU&#8217;s VHDL source file (<code>rtl/core/neorv32_cpu_cp_cfu.vhd</code>), which
is highly commented to explain the available signals, implementation options and the handshake with the CPU pipeline.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Hardware Resource Requirements</div>
Enabling the CFU and actually implementing R4-type and/or R5-type instructions (or more precisely, using
the according operands for the CFU hardware) will add one or two, respectively, additional read ports to
the core&#8217;s register file significantly increasing resource requirements.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Access</div>
The CFU is accessible from all privilege modes (including CFU-internal registers accessed via the indirects CSR
access mechanism). It is the task of the CFU designers to add according access-constraining logic if certain CFU
states shall not be exposed to all privilege levels (i.e. exncryption keys).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Execution Time</div>
The CFU has to complete computation within a <strong>bound time window</strong>. Otherwise, the CFU operation is terminated
by the hardware and an illegal instruction exception is raised. See section <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Exception</div>
The CFU can intentionally raise an illegal instruction exception by not asserting the <code>done</code> at all causing an
execution timeout. For example this can be used to signal invalid configurations/operations to the runtime
environment. See the CFU&#8217;s VHDL file for more information.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_control_and_status_registers_csrs">3.8. Control and Status Registers (CSRs)</h3>
<div class="paragraph">
<p>The following table shows a summary of all available NEORV32 CSRs. The address field defines the CSR address for
the CSR access instructions. The "Name [ASM]" column provides the CSR name aliases that can be used in (inline) assembly.
The "Name [C]" column lists the name aliases that are defined by the NEORV32 core library. These can be used in plain C code.
The "Access" column shows the minimal required privilege mode required for accessing the according CSR (<code>M</code> = machine-mode,
<code>U</code> = user-mode, <code>D</code> = debug-mode) and the read/write capabilities (<code>RW</code> = read-write, <code>RO</code> = read-only)</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Unused, Reserved, Unimplemented and Disabled CSRs</div>
All CSRs and CSR bits that are not listed in the table below are <em>unimplemented</em> and are <em>hardwired to zero</em>. Additionally,
CSRs that are unavailable ("disabled") because the according ISA extension is not enabled are also considered <em>unimplemented</em>
and are also hardwired to zero. Any access to such a CSR will raise an illegal instruction exception. All writable CSRs provide
<strong>WARL</strong> behavior (write all values; read only legal values). Application software should always read back a CSR after writing
to check if the targeted bits can actually be modified.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. NEORV32 Control and Status Registers (CSRs)</caption>
<colgroup>
<col style="width: 8.6956%;">
<col style="width: 17.3913%;">
<col style="width: 21.7391%;">
<col style="width: 4.3478%;">
<col style="width: 47.8262%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [ASM]</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Access</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_floating_point_csrs">Floating-Point CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fflags"><strong><code>fflags</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FFLAGS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_frm"><strong><code>frm</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FRM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fcsr"><strong><code>fcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_FCSR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_setup_csrs">Machine Trap Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatus"><strong><code>mstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_misa"><strong><code>misa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MISA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine CPU ISA and extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mie"><strong><code>mie</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtvec"><strong><code>mtvec</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTVEC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address for ALL traps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTEREN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatush"><strong><code>mstatush</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSTATUSH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_configuration_csrs">Machine Configuration CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MENVCFG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MENVCFGH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_setup_csrs">Machine Counter Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-inhibit register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mscratch"><strong><code>mscratch</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MSCRATCH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine scratch register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mepc"><strong><code>mepc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MEPC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcause"><strong><code>mcause</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCAUSE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtval"><strong><code>mtval</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTVAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mip"><strong><code>mip</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x34a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtinst"><strong><code>mtinst</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MTINST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0 .. 0x303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpcfg"><code>pmpcfg0</code></a> .. <a href="#_pmpcfg"><code>pmpcfg3</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_PMPCFG0</code> .. <code>CSR_PMPCFG3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection configuration registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0 .. 0x3bf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpaddr"><code>pmpaddr0</code></a> .. <a href="#_pmpaddr"><code>pmpaddr15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_PMPADDR0</code> .. <code>CSR_PMPADDR15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection address registers</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_trigger_module_csrs">Trigger Module CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tselect"><strong><code>tselect</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TSELECT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger select register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata1"><strong><code>tdata1</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TDATA1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata2"><strong><code>tdata2</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TDATA2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tinfo"><strong><code>tinfo</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_TINFO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger information register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dcsr"><strong><code>dcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dpc"><strong><code>dpc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dscratch0"><strong><code>dscratch0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug scratch register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_custom_functions_unit_cfu_csrs">Custom Functions Unit (CFU) CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x800 .. 0x803</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cfureg"><code>cfureg0</code></a> .. <a href="#_cfureg"><code>cfureg3</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_CFUCREG0</code> .. <code>CSR_CFUCREG3</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom CFU registers 0 to 3</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRET</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCYCLEH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MINSTRETH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_CYCLE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_INSTRET</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_CYCLEH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_INSTRETH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x323 .. 0x32f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmevent"><code>mhpmevent3</code></a> .. <a href="#_mhpmevent"><code>mhpmevent15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMEVENT3</code> .. <code>CSR_MHPMEVENT15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring event select for counter 3..15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03 .. 0xb0f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMCOUNTER3</code> .. <code>CSR_MHPMCOUNTER15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..15 low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83 .. 0xb8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3h</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter15h</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHPMCOUNTER3H</code> .. <code>CSR_MHPMCOUNTER15H</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..15 high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc03 .. 0xc0f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_hpmcounterh"><code>hpmcounter3</code></a> .. <a href="#_hpmcounterh"><code>hpmcounter15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_HPMCOUNTER3</code>  .. <code>CSR_HPMCOUNTER15H</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User performance-monitoring counter 3..15 low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc83 .. 0xc8f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_hpmcounterh"><code>hpmcounter3h</code></a> .. <a href="#_hpmcounterh"><code>hpmcounter15h</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_HPMCOUNTER3H</code> .. <code>CSR_HPMCOUNTER15H</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">URO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User performance-monitoring counter 3..15 high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_information_csrs">Machine Information CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MVENDORID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_marchid"><strong><code>marchid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MARCHID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine architecture ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mimpid"><strong><code>mimpid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MIMPID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID / version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhartid"><strong><code>mhartid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MHARTID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware thread ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MCONFIGPTR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfc0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mxisa"><strong><code>mxisa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSR_MXISA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEORV32-specific "eXtended" machine CPU ISA and extensions</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_floating_point_csrs">3.8.1. Floating-Point CSRs</h4>
<h5 id="_fflags" class="discrete"><strong><code>fflags</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x001</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPU status flags.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 59. <code>fflags</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NX</strong>: inexact</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UF</strong>: underflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OF</strong>: overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DZ</strong>: division by zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NV</strong>: invalid operation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_frm" class="discrete"><strong><code>frm</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x002</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>frm</code> CSR is used to configure the rounding mode of the FPU.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 60. <code>frm</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_fcsr" class="discrete"><strong><code>fcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>fcsr</code> provides combined access to the <a href="#_fflags"><strong><code>fflags</code></strong></a> and <a href="#_frm"><strong><code>frm</code></strong></a> flags.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 61. <code>fcsr</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accrued exception flags (<a href="#_fflags"><strong><code>fflags</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode (<a href="#_frm"><strong><code>frm</code></strong></a>)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_trap_setup_csrs">3.8.2. Machine Trap Setup CSRs</h4>
<h5 id="_mstatus" class="discrete"><strong><code>mstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00001800</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mstatus</code> CSR is used to configure general machine environment parameters.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 62. <code>mstatus</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MSTATUS_MIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MIE</strong>: Machine-mode interrupt enable flag</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPIE</strong>: Previous machine-mode interrupt enable flag state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPP_H</code> : <code>CSR_MSTATUS_MPP_L</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPP</strong>: Previous machine privilege mode, <code>11</code> = machine-mode "M", <code>00</code> = user-mode "U"; other values will fall-back to machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MSTATUS_MPRV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPRV</strong>: Effective privilege mode for load/stores; use <code>MPP</code> as effective privilege mode when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MSTATUS_TW</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TW</strong>: Trap on execution of <code>wfi</code> instruction in user mode when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the core is in user-mode, machine-mode interrupts are globally <strong>enabled</strong> even if <code>mstatus.mie</code> is cleared:
"Interrupts for higher-privilege modes, y&gt;x, are always globally enabled regardless of the setting of the global yIE
bit for the higher-privilege mode." - RISC-V ISA Spec.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_misa" class="discrete"><strong><code>misa</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA and extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x301</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code>, according to enabled ISA extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>misa</code> CSR provides information regarding the availability of basic RISC-V ISa extensions.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 <code>misa</code> CSR is read-only. Hence, active CPU extensions are entirely defined by pre-synthesis configurations
and cannot be switched on/off during runtime. For compatibility reasons any write access to this CSR is simply ignored and
will <em>not</em> cause an illegal instruction exception.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 63. <code>misa</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_A_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A</strong>: CPU extension (atomic memory access) available, set when <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_B_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B</strong>: CPU extension (bit-manipulation) available, set when <a href="#_b_isa_extension"><code>B</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_C_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C</strong>: CPU extension (compressed instruction) available, set when <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_E_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>E</strong>: CPU extension (embedded) available, set when <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_I_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I</strong>: CPU base ISA, cleared when <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_M_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>M</strong>: CPU extension (mul/div) available, set when <a href="#_m_isa_extension"><code>M</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_U_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>U</strong>: CPU extension (user mode) available, set when <a href="#_u_isa_extension"><code>U</code> ISA Extension</a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_X_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: bit is always set to indicate non-standard / NEORV32-specific extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MISA_MXL_HI_EXT</code> : <code>CSR_MISA_MXL_LO_EXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MXL</strong>: 32-bit architecture indicator (always <code>01</code>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Machine-mode software can discover available <code>Z*</code> <em>sub-extensions</em> (like <code>Zicsr</code> or <code>Zfinx</code>) by checking the NEORV32-specific
<a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mie" class="discrete"><strong><code>mie</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x304</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mie</code> CSR is used to enable/disable individual interrupt sources.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 64. <code>mie</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIE_MSIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIE</strong>: Machine <em>software</em> interrupt enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIE_MTIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIE</strong>: Machine <em>timer</em> interrupt enable (from <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIE_MEIE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIE</strong>: Machine <em>external</em> interrupt enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIE_FIRQ15E</code> : <code>CSR_MIE_FIRQ0E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast interrupt channel 15..0 enable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtvec" class="discrete"><strong><code>mtvec</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x305</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_BOOT_ADDR</code>, CPU boot address, 4-byte aligned (see <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a> and <a href="#_address_space">Address Space</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtvec</code> CSR holds the trap vector configuration.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 65. <code>mtvec</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MODE</strong>: mode configuration, <code>00</code> = DIRECT, <code>01</code> = VECTORED. (Others will fall back to DIRECT mode.)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BASE</strong>: in DIRECT mode = 4-byte aligned base address of trap base handler, <em>all</em> traps set <code>pc</code> = <code>BASE</code>; in VECTORED mode = 128-byte aligned base address of trap vector table, interrupts cause a jump to <code>pc</code> = <code>BASE</code> + 4 * <code>mcause</code> and exceptions to <code>pc</code> = <code>BASE</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Interrupt Latency</div>
The vectored <code>mtvec</code> mode is useful for reducing the time between interrupt request (IRQ) and servicing it (ISR). As software does not need to determine the interrupt cause the reduction in latency can be 5 to 10 times and as low as <em>26</em> cycles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcounteren" class="discrete"><strong><code>mcounteren</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x306</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mcounteren</code> CSR is used to constrain user-mode access to the CPU&#8217;s counter CSRs.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 66. <code>mcounteren</code> CSR bits</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w (!)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: User-mode is allowed to read <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TM</strong>: not implemented, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w (!)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: User-mode is allowed to read <a href="#_instreth"><strong><code>instret[h]</code></strong></a> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w (!)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM</strong>: user-mode is allowed to read <a href="#_hpmcounterh"><strong><code>hpmcounter[h]</code></strong></a> CSRs when set</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Physically, the NEORV32&#8217;s <code>mcounteren</code> CSR is implemented as a <strong>single 1-bit register</strong>. Setting <em>any</em> bit of
the CSR will result in all bits being set. Hence, user-mode access can either be granted for <strong>all</strong> counter CSRs
or entirely denied allowing access to <strong>none</strong> counter CSRs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mstatush" class="discrete"><strong><code>mstatush</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x310</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_trap_handling_csrs">3.8.3. Machine Trap Handling CSRs</h4>
<h5 id="_mscratch" class="discrete"><strong><code>mscratch</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scratch register for machine trap handlers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x340</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mscratch</code> is a general-purpose machine-mode scratch register.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mepc" class="discrete"><strong><code>mepc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x341</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_BOOT_ADDR</code>, CPU boot address, 4-byte aligned (see <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a> and <a href="#_address_space">Address Space</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mepc</code> CSR provides the instruction address where execution has stopped/failed when
an instruction is triggered / an exception is raised. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for a list of all legal values.
The <code>mret</code> instruction will return to the address stored in <code>mepc</code> by automatically moving <code>mepc</code> to the program counter.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>mepc[0]</code> is hardwired to zero. If IALIGN = 32 (i.e. <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> is disabled) then <code>mepc[1]</code> is also hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcause" class="discrete"><strong><code>mcause</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x342</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mcause</code> CSRs shows the exact cause of a trap. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for a list of all legal values.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 67. <code>mcause</code> CSR bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Exception code</strong>: see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interrupt</strong>: <code>1</code> if the trap is caused by an interrupt (<code>0</code> if the trap is caused by an exception)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtval" class="discrete"><strong><code>mtval</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x343</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtval</code> CSR provides additional information why a trap was entered. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only</div>
Note that the NEORV32 <code>mtval</code> CSR is updated by the hardware only and cannot be written from software.
However, any write-access will be ignored and will not cause an exception to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mip" class="discrete"><strong><code>mip</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x344</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mip</code> CSR shows currently <em>pending</em> machine-mode interrupt requests.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 68. <code>mip</code> CSR bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIP_MSIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIP</strong>: Machine <em>software</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIP_MTIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIP</strong>: Machine <em>timer</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIP_MEIP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIP</strong>: Machine <em>external</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MIP_FIRQ15P</code> : <code>CSR_MIP_FIRQ0P</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FIRQxP</strong>: Fast interrupt channel 15..0 pending; has to be cleared manually by writing zero; writing <code>1</code> has no effect</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">FIRQ Channel Mapping</div>
See section <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a> for the mapping of the FIRQ channels and the according
interrupt-triggering processor module.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mtinst" class="discrete"><strong><code>mtinst</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x34a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mtinst</code> CSR provides additional information why a trap was entered. See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only</div>
Note that the NEORV32 <code>mtinst</code> CSR is updated by the hardware only and cannot be written from software.
However, any write-access will be ignored and will not cause an exception to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Transformation</div>
The RISC-V priv. spec. suggests that the instruction word written to <code>mtinst</code> by the hardware should be "transformed".
However, the NEORV32 <code>mtinst</code> CSR uses a simplified transformation scheme: if the trap-causing instruction is a
standard 32-bit instruction, <code>mtinst</code> contains the exact instruction word that caused the trap. If the trap-causing
instruction is a compressed instruction, <code>mtinst</code> contains the de-compressed 32-bit equivalent with bit 1 being cleared.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_configuration_csrs">3.8.4. Machine Configuration CSRs</h4>
<h5 id="_menvcfg" class="discrete"><strong><code>menvcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently, the features of this CSR are not supported. Hence, the entire register is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_menvcfgh" class="discrete"><strong><code>menvcfgh</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currently, the features of this CSR are not supported. Hence, the entire register is hardwired to all-zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_physical_memory_protection_csrs">3.8.5. Machine Physical Memory Protection CSRs</h4>
<div class="paragraph">
<p>The physical memory protection system is configured via the <code>PMP_NUM_REGIONS</code> and <code>PMP_MIN_GRANULARITY</code> top entity
generics. <code>PMP_NUM_REGIONS</code> defines the total number of implemented regions. Note that the maximum number of regions
is constrained to 16. If trying to access a PMP-related CSR beyond <code>PMP_NUM_REGIONS</code> <strong>no illegal instruction exception</strong>
is triggered. The according CSRs are read-only (writes are ignored) and always return zero.
See section <a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a> for more information.</p>
</div>
<h5 id="_pmpcfg" class="discrete"><strong><code>pmpcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PMP region configuration registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a0</code> (<code>pmpcfg0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a1</code> (<code>pmpcfg1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a2</code> (<code>pmpcfg2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3a3</code> (<code>pmpcfg3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration of physical memory protection regions. Each region provides an individual 8-bit array in these CSRs.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 69. <code>pmpcfg0</code> CSR Bits</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 73.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PMPCFG_R</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>R</strong>: Read permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PMPCFG_W</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>W</strong>: Write permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PMPCFG_X</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: Execute permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PMPCFG_A_MSB</code> : <code>PMPCFG_A_LSB</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>A</strong>: Mode configuration (<code>00</code> = OFF, <code>01</code> = TOR, <code>10</code> = NA4, <code>11</code> = NAPOT)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PMPCFG_L</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L</strong>: Lock bit, prevents further write accesses, also enforces access rights in machine-mode, can only be cleared by CPU reset</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Implemented Modes</div>
In order to reduce the CPU size certain PMP modes (<code>A</code> bits) can be excluded from synthesis.
Use the <code>PMP_TOR_MODE_EN</code> and <code>PMP_NAP_MODE_EN</code> <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> to control
implementation of the according modes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_pmpaddr" class="discrete"><strong><code>pmpaddr</code></strong></h5>
<div class="paragraph">
<p>The <code>pmpaddr*</code> CSRs are used to configure the region&#8217;s address boundaries.</p>
</div>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection address registers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b0</code> (<code>pmpaddr1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b1</code> (<code>pmpaddr2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b2</code> (<code>pmpaddr3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b3</code> (<code>pmpaddr4</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b4</code> (<code>pmpaddr5</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b5</code> (<code>pmpaddr6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b6</code> (<code>pmpaddr6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b7</code> (<code>pmpaddr7</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b8</code> (<code>pmpaddr8</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3b9</code> (<code>pmpaddr9</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3ba</code> (<code>pmpaddr10</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bb</code> (<code>pmpaddr11</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bc</code> (<code>pmpaddr12</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bd</code> (<code>pmpaddr13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3be</code> (<code>pmpaddr14</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3bf</code> (<code>pmpaddr15</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Region address configuration. The two MSBs of each CSR are hardwired to zero (= bits 33:32 of the physical address).</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_custom_functions_unit_cfu_csrs">3.8.6. Custom Functions Unit (CFU) CSRs</h4>
<h5 id="_cfureg" class="discrete"><strong><code>cfureg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom (user-defined) CFU CSRs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x800</code> (<code>cfureg0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x801</code> (<code>cfureg1</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x802</code> (<code>cfureg2</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x803</code> (<code>cfureg3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zxcfu</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-defined CSRs to be used within the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_counter_and_timer_csrs">3.8.7. (Machine) Counter and Timer CSRs</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title"><code>time[h]</code> CSRs (Wall Clock Time)</div>
The NEORV32 does not implement the user-mode <code>time[h]</code> registers. Any access to these registers will trap.
It is recommended that the trap handler software provides a means of accessing the platform-defined <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Retired Counter Increment</div>
The <code>[m]instret[h]</code> counter always increments when a instruction enters the pipeline&#8217;s execute stage no matter
if this instruction is actually going to retire or if it causes an exception.
</td>
</tr>
</table>
</div>
<h5 id="_cycleh" class="discrete"><strong><code>cycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc00</code> (<code>cycle</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc80</code> (<code>cycleh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>cycle[h]</code> CSRs are user-mode shadow copies of the according <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a> CSRs. The user-mode
counter are read-only. Any write access will raise an illegal instruction exception.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_instreth" class="discrete"><strong><code>instret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructions-retired counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc02</code> (<code>instret</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc82</code> (<code>instreth</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>instret[h]</code> CSRs are user-mode shadow copies of the according <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a> CSRs. The user-mode
counter are read-only. Any write access will raise an illegal instruction exception.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mcycleh" class="discrete"><strong><code>mcycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb00</code> (<code>mcycle</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb80</code> (<code>mcycleh</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the <code>cycle[h]</code> CSRs will increment with every active CPU clock
cycle (CPU not in sleep mode). These registers are read/write only for machine-mode software.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_minstreth" class="discrete"><strong><code>minstret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instructions-retired counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb02</code> (<code>minstret</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb82</code> (<code>minstreth</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the <code>minstret[h]</code> CSRs will increment with every retired instruction.
These registers are read/write only for machine-mode software</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Retiring</div>
Note that <strong>all</strong> executed instruction do increment the <code>[m]instret</code>[h] counters even if they do not retire
(e.g. if the instruction causes an exception).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm_csrs">3.8.8. Hardware Performance Monitors (HPM) CSRs</h4>
<div class="paragraph">
<p>The actual number of implemented hardware performance monitors is configured via the <code>HPM_NUM_CNTS</code> top entity generic,
Note that always all 13 HPM counter and configuration registers (<code>mhpmcounter*[h]</code> and <code>mhpmevent*</code>) are implemented, but
only the actually configured ones are implemented as "real" physical registers - the remaining ones will be hardwired to zero.</p>
</div>
<div class="paragraph">
<p>If trying to access an HPM-related CSR beyond <code>HPM_NUM_CNTS</code> <strong>no illegal instruction exception is
triggered</strong>. These CSRs are read-only (writes are ignored) and always return zero.</p>
</div>
<div class="paragraph">
<p>The total counter width of the HPMs can be configured before synthesis via the <code>HPM_CNT_WIDTH</code> generic (0..64-bit).
If <code>HPM_NUM_CNTS</code> is less than 64, all remaining MSB-aligned bits are hardwired to zero.</p>
</div>
<h5 id="_mhpmevent" class="discrete"><strong><code>mhpmevent</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware performance monitor event select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x233</code> (<code>mhpmevent3</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x234</code> (<code>mhpmevent4</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x235</code> (<code>mhpmevent5</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x236</code> (<code>mhpmevent6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x237</code> (<code>mhpmevent7</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x238</code> (<code>mhpmevent8</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x239</code> (<code>mhpmevent9</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23a</code> (<code>mhpmevent10</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23b</code> (<code>mhpmevent11</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23c</code> (<code>mhpmevent12</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23d</code> (<code>mhpmevent13</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23e</code> (<code>mhpmevent14</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x23f</code> (<code>mhpmevent15</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value in these CSRs define the architectural events that cause an increment of the according <code>mhpmcounter*[h]</code> counter(s).
All available events are listed in the table below. If more than one event is selected, the according counter will increment if <em>any</em> of
the enabled events is observed (logical OR). Note that the counter will only increment by 1 step per clock
cycle even if more than one trigger event is observed.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 70. <code>mhpmevent*</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>RISC-V-compatible</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active clock cycle (CPU not in <a href="#_sleep_mode">Sleep Mode</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_TM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not implemented</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_IR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any executed instruction (16-bit/compressed or 32-bit/uncompressed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>NEORV32-specific</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_COMPR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any executed 16-bit/compressed (<a href="#_c_isa_extension"><code>C</code> ISA Extension</a>) instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_DIS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction dispatch wait cycle (wait for instruction prefetch-buffer refill (<a href="#_cpu_control_unit">CPU Control Unit</a> IPB);
caused by a fence instruction, a control flow transfer or a instruction fetch bus wait cycle)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_ALU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any delay/wait cycle caused by a <em>multi-cycle</em> <a href="#_cpu_arithmetic_logic_unit">CPU Arithmetic Logic Unit</a> operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_BRANCH</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any executed branch instruction (unconditional, conditional-taken or conditional-not-taken)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_BRANCHED</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any control transfer operation (unconditional jump, taken conditional branch or trap entry/exit)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_LOAD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any executed load operation (including atomic memory operations, <a href="#_a_isa_extension"><code>A</code> ISA Extension</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_STORE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any executed store operation (including atomic memory operations, <a href="#_a_isa_extension"><code>A</code> ISA Extension</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_WAIT_LSU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any memory/bus/cache/etc. delay/wait cycle while executing any load or store operation (caused by a data bus wait cycle))</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HPMCNT_EVENT_TRAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">starting processing of any trap (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction Retiring ("Retired == Executed")</div>
The CPU HPM/counter logic treats all executed instruction as "retired" even if they raise an exception,
cause an interrupt, trigger a privilege mode change or were not meant to retire (by the RISC-V spec.).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mhpmcounterh" class="discrete"><strong><code>mhpmcounter[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware performance monitor (HPM) counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb03</code>, <code>0xb83</code> (<code>mhpmcounter3</code>, <code>mhpmcounter3h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb04</code>, <code>0xb84</code> (<code>mhpmcounter4</code>, <code>mhpmcounter4h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb05</code>, <code>0xb85</code> (<code>mhpmcounter5</code>, <code>mhpmcounter5h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb06</code>, <code>0xb86</code> (<code>mhpmcounter6</code>, <code>mhpmcounter6h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb07</code>, <code>0xb87</code> (<code>mhpmcounter7</code>, <code>mhpmcounter7h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb08</code>, <code>0xb88</code> (<code>mhpmcounter8</code>, <code>mhpmcounter8h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb09</code>, <code>0xb89</code> (<code>mhpmcounter9</code>, <code>mhpmcounter9h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0a</code>, <code>0xb8a</code> (<code>mhpmcounter10</code>, <code>mhpmcounter10h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0b</code>, <code>0xb8b</code> (<code>mhpmcounter11</code>, <code>mhpmcounter11h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0c</code>, <code>0xb8c</code> (<code>mhpmcounter12</code>, <code>mhpmcounter12h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0d</code>, <code>0xb8d</code> (<code>mhpmcounter13</code>, <code>mhpmcounter13h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0e</code>, <code>0xb8e</code> (<code>mhpmcounter14</code>, <code>mhpmcounter14h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xb0f</code>, <code>0xb8f</code> (<code>mhpmcounter15</code>, <code>mhpmcounter15h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not halted via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR the HPM counter CSR(s) increment whenever a
configured event from the according <a href="#_mhpmevent"><strong><code>mhpmevent</code></strong></a> CSR occurs. The counter registers are read/write for machine mode
and are not accessible for lower-privileged software.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_hpmcounterh" class="discrete"><strong><code>hpmcounter[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User hardware performance monitor (HPM) counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc03</code>, <code>0xc83</code> (<code>hpmcounter3</code>, <code>hpmcounter3h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc04</code>, <code>0xc84</code> (<code>hpmcounter4</code>, <code>hpmcounter4h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc05</code>, <code>0xc85</code> (<code>hpmcounter5</code>, <code>hpmcounter5h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc06</code>, <code>0xc86</code> (<code>hpmcounter6</code>, <code>hpmcounter6h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc07</code>, <code>0xc87</code> (<code>hpmcounter7</code>, <code>hpmcounter7h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc08</code>, <code>0xc88</code> (<code>hpmcounter8</code>, <code>hpmcounter8h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc09</code>, <code>0xc89</code> (<code>hpmcounter9</code>, <code>hpmcounter9h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0a</code>, <code>0xc8a</code> (<code>hpmcounter10</code>, <code>hpmcounter10h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0b</code>, <code>0xc8b</code> (<code>hpmcounter11</code>, <code>hpmcounter11h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0c</code>, <code>0xc8c</code> (<code>hpmcounter12</code>, <code>hpmcounter12h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0d</code>, <code>0xc8d</code> (<code>hpmcounter13</code>, <code>hpmcounter13h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0e</code>, <code>0xc8e</code> (<code>hpmcounter14</code>, <code>hpmcounter14h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xc0f</code>, <code>0xc8f</code> (<code>hpmcounter15</code>, <code>hpmcounter15h</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>hpmcounter*[h]</code> are user-mode shadow copies of the according <a href="#_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></a> CSRs. The user mode
counter CSRs are read-only. Any write access will raise an illegal instruction exception.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_counter_setup_csrs">3.8.9. Machine Counter Setup CSRs</h4>
<h5 id="_mcountinhibit" class="discrete"><strong><code>mcountinhibit</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-inhibit register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x320</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set bit to halt the according counter CSR.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 71. <code>mcountinhibit</code> CSR Bits</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_IR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: Set to <code>1</code> to halt <code>[m]instret[h]</code>; hardwired to zero if <code>Zicntr</code> ISA extension is disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TM</strong>: Hardwired to zero as <code>time[h]</code> CSRs are not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: Set to <code>1</code> to halt <code>[m]cycle[h]</code>; hardwired to zero if <code>Zicntr</code> ISA extension is disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MCOUNTINHIBIT_HPM3</code> : <code>CSR_MCOUNTINHIBIT_HPM15</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPMx</strong>: Set to <code>1</code> to halt <code>[m]hpmcount*[h]</code>; hardwired to zero if <code>Zihpm</code> ISA extension is disabled</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_information_csrs">3.8.10. Machine Information CSRs</h4>
<h5 id="_mvendorid" class="discrete"><strong><code>mvendorid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf11</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor ID (JEDEC identifier), assigned via the <code>VENDOR_ID</code> top generic (<a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_marchid" class="discrete"><strong><code>marchid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine architecture ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf12</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000013</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>marchid</code> CSR is read-only and provides the NEORV32 official RISC-V open-source architecture ID
(decimal: 19, 32-bit hexadecimal: 0x00000013).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mimpid" class="discrete"><strong><code>mimpid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf13</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mimpid</code> CSR is read-only and provides the version of the
NEORV32 as BCD-coded number (example: <code>mimpid = 0x01020312</code> → 01.02.03.12 → version 1.2.3.12).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mhartid" class="discrete"><strong><code>mhartid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine hardware thread ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf14</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mhartid</code> CSR is read-only and provides the core&#8217;s hart ID,
which is assigned via the <code>HW_THREAD_ID</code> top generic (<a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
<h5 id="_mconfigptr" class="discrete"><strong><code>mconfigptr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xf15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_csrs">3.8.11. NEORV32-Specific CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All NEORV32-specific CSRs are mapped to addresses that are explicitly reserved for custom <strong>Machine-Mode, read-only</strong> CSRs
(assured by the RISC-V privileged specifications). Hence, these CSRs can only be accessed when in machine-mode. Any access
outside of machine-mode will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<h5 id="_mxisa" class="discrete"><strong><code>mxisa</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine extended isa and extensions register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfc0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFINED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>X</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>mxisa</code> CSRs is a NEORV32-specific read-only CSR that helps machine-mode software to
discover ISA sub-extensions and CPU configuration options</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 72. <code>mxisa</code> CSR Bits</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZICSR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicsr_isa_extension"><code>Zicsr</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZIFENCEI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zifencei_isa_extension"><code>Zifencei</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZMMUL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zmmul_isa_extension"><code>Zmmul</code> - ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZXCFU</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zxcfu_isa_extension"><code>Zxcfu</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZFINX</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zfinx_isa_extension"><code>Zfinx</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZICOND</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicond_isa_extension"><code>Zicond</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZICNTR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zicntr_isa_extension"><code>Zicntr</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_PMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmp_isa_extension"><code>PMP</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_ZIHPM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_zihpm_isa_extension"><code>Zihpm</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_SDEXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdext_isa_extension"><code>Sdext</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_SDTRIG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a> available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_IS_SIM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if CPU is being <strong>simulated</strong> (⚠️ not guaranteed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28:21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_RFHWRST</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">full hardware reset of register file available when set (<code>REGFILE_HW_RST</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_FASTMUL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast multiplication available when set (<code>FAST_MUL_EN</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CSR_MXISA_FASTSHIFT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast shifts available when set (<code>FAST_SHIFT_EN</code>)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_traps_exceptions_and_interrupts">3.8.12. Traps, Exceptions and Interrupts</h4>
<div class="paragraph">
<p>In this document the following terminology is used (derived from the RISC-V trace specification
available at <a href="https://github.com/riscv-non-isa/riscv-trace-spec" class="bare">https://github.com/riscv-non-isa/riscv-trace-spec</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>exception</strong>: an unusual condition occurring at run time associated (i.e. <em>synchronous</em>) with an instruction in a RISC-V hart</p>
</li>
<li>
<p><strong>interrupt</strong>: an external <em>asynchronous</em> event that may cause a RISC-V hart to experience an unexpected transfer of control</p>
</li>
<li>
<p><strong>trap</strong>: the transfer of control to a trap handler caused by either an <em>exception</em> or an <em>interrupt</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whenever an exception or interrupt is triggered, the CPU switches to machine-mode (if not already in machine-mode)
and continues operation at the address being stored in the <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR. The cause of the the trap can be determined via the
<a href="#_mcause"><strong><code>mcause</code></strong></a> CSR. A list of all implemented <code>mcause</code> values and the according description can be found below in section
<a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>. The address that reflects the current program counter when a trap was taken is stored to
<a href="#_mepc"><strong><code>mepc</code></strong></a> CSR. Additional information regarding the cause of the trap can be retrieved from the <a href="#_mtval"><strong><code>mtval</code></strong></a> and <a href="#_mtinst"><strong><code>mtinst</code></strong></a> CSRs.</p>
</div>
<div class="paragraph">
<p>The traps are prioritized. If several <em>exceptions</em> occur at once only the one with highest priority is triggered
while all remaining exceptions are ignored and discarded. If several <em>interrupts</em> trigger at once, the one with highest priority
is serviced first while the remaining ones stay <em>pending</em>. After completing the interrupt handler the interrupt with
the second highest priority will get serviced and so on until no further interrupts are pending.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupts when in User-Mode</div>
If the core is currently operating in less privileged user-mode, interrupts are globally enabled
even if <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.mie is cleared.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements - Standard RISC-V Interrupts</div>
All standard RISC-V interrupt request signals are <strong>high-active</strong>. A request has to stay at high-level
until it is explicitly acknowledged by the CPU software (for example by writing to a specific memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements - NEORV32-Specific Fast Interrupt Requests</div>
The NEORV32-specific FIRQ request lines are triggered (= becoming pending) by a one-shot high-level.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Atomicity</div>
All instructions execute as atomic operations - interrupts can only trigger <em>between</em> consecutive instructions.
Even if there is a permanent interrupt request, exactly one instruction from the interrupted program will be executed before
another interrupt handler can start. This allows program progress even if there are permanent interrupt requests.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_memory_access_exceptions">Memory Access Exceptions</h5>
<div class="paragraph">
<p>If a load operation causes any exception, the instruction&#8217;s destination register is <strong>not written</strong> at all. Furthermore,
exceptions caused by a misaligned memory address a physical memory protection fault do not trigger a memory access request at all.</p>
</div>
<div class="paragraph">
<p>For 32-bit-only instructions (= no <code>C</code> extension) the misaligned instruction exception is raised if bit 1 of the fetch
address is set (i.e. not on a 32-bit boundary). If the <code>C</code> extension is implemented there will <strong>never</strong> be a misaligned
instruction exception at all.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</h5>
<div class="paragraph">
<p>As a custom extension, the NEORV32 CPU features 16 fast interrupt request (FIRQ) lines via the <code>firq_i</code> CPU top
entity signals. These interrupts have custom configuration and status flags in the <a href="#_mie"><strong><code>mie</code></strong></a> and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs and also
provide custom trap codes in <a href="#_mcause"><strong><code>mcause</code></strong></a>. These FIRQs are reserved for NEORV32 processor-internal usage only.</p>
</div>
<div class="paragraph">
<p>Once triggered, the according FIRQ bits in <a href="#_mip"><strong><code>mip</code></strong></a> has to be cleared <em>manually</em> by the FIRQ interrupt handler
to clear/acknowledge the fast interrupt request.</p>
</div>
</div>
<div class="sect4">
<h5 id="_neorv32_trap_listing">NEORV32 Trap Listing</h5>
<div class="paragraph">
<p>The following tables show all traps that are currently supported by the NEORV32 CPU. It also shows the prioritization
and the CSR side-effects.</p>
</div>
<div class="paragraph">
<p><strong>Table Annotations</strong></p>
</div>
<div class="paragraph">
<p>The "Prio." column shows the priority of each trap with the highest priority being 1. The "RTE Trap ID" aliases are
defined by the NEORV32 core library (the runtime environment <em>RTE</em>) and can be used in plain C code when interacting
with the pre-defined RTE function. The <a href="#_mcause"><strong><code>mcause</code></strong></a>, <a href="#_mepc"><strong><code>mepc</code></strong></a>, <a href="#_mtval"><strong><code>mtval</code></strong></a> and <a href="#_mtinst"><strong><code>mtinst</code></strong></a> columns show the value being
written to the according CSRs when a trap is triggered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>I-PC</strong> - address of intercepted instruction (instruction has <em>not</em> been executed yet)</p>
</li>
<li>
<p><strong>PC</strong> - address of instruction that caused the trap (instruction has been executed)</p>
</li>
<li>
<p><strong>ADR</strong> - bad data memory access address that caused the trap</p>
</li>
<li>
<p><strong>INS</strong> - the transformed/decompressed instruction word that caused the trap</p>
</li>
<li>
<p><strong>0</strong> - zero</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 73. NEORV32 Trap Listing</caption>
<colgroup>
<col style="width: 3.4482%;">
<col style="width: 13.7931%;">
<col style="width: 27.5862%;">
<col style="width: 34.4827%;">
<col style="width: 6.8965%;">
<col style="width: 6.8965%;">
<col style="width: 6.8968%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prio.</th>
<th class="tableblock halign-left valign-top"><code>mcause</code></th>
<th class="tableblock halign-left valign-top">RTE Trap ID</th>
<th class="tableblock halign-left valign-top">Cause</th>
<th class="tableblock halign-left valign-top"><code>mepc</code></th>
<th class="tableblock halign-left valign-top"><code>mtval</code></th>
<th class="tableblock halign-left valign-top"><code>mtinst</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><strong>Exceptions</strong> (<em>synchronous</em> to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0000000b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from M-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from U-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">software breakpoint / trigger firing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INS</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><strong>Interrupts</strong> (<em>asynchronous</em> to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000000B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (MEI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (MSI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (MTI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 74. NEORV32 Trap Description</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trap ID [C]</th>
<th class="tableblock halign-left valign-top">Triggered when &#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_pmp_isa_extension">PMP</a> rule violation during instruction fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trying to execute an invalid instruction word (malformed or not supported) or on a privilege violation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetching a 32-bit instruction word that is not 32-bit-aligned (see note below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in user-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ebreak</code> instruction or if <a href="#_trigger_module">Trigger Module</a> fires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storing data to an address that is not naturally aligned to the data size (half/word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loading data from an address that is not naturally aligned to the data size  (half/word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_pmp_isa_extension">PMP</a> rule violation during load data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout, bus access error or <a href="#_pmp_isa_extension">PMP</a> rule violation during store data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_FIRQ_*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">caused by interrupt-condition of <strong>processor-internal modules</strong>, see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAP_CODE_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (internal <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> or via dedicated <a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Resumable Exceptions</div>
Note that not all exceptions are resumable. For example, the "instruction access fault" exception or the "instruction
address misaligned" exception are not resumable in most cases. These exception might indicate a fatal memory hardware failure.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_framework">4. Software Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 project comes with a complete software ecosystem called the "software framework", which
is based on the C-language RISC-V GCC port and consists of the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_compiler_toolchain">Compiler Toolchain</a></p>
</li>
<li>
<p><a href="#_core_libraries">Core Libraries</a></p>
</li>
<li>
<p><a href="#_application_makefile">Application Makefile</a></p>
</li>
<li>
<p><a href="#_executable_image_format">Executable Image Format</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#_linker_script">Linker Script</a></p>
</li>
<li>
<p><a href="#_ram_layout">RAM Layout</a></p>
</li>
<li>
<p><a href="#_c_standard_library">C Standard Library</a></p>
</li>
<li>
<p><a href="#_start_up_code_crt0">Start-Up Code (crt0)</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#_bootloader">Bootloader</a></p>
</li>
<li>
<p><a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A summarizing list of the most important elements of the software framework and their according
files and folders is shown below:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application start-up code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/crt0.S</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application linker script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/neorv32.ld</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core hardware driver libraries ("HAL")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/lib/include/</code> &amp; <code>sw/lib/source/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Central application makefile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/common.mk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool for generating NEORV32 executables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/image_gen/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default bootloader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/bootloader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Example programs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/example</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Documentation</div>
All core libraries and example programs are documented "in-code" using <strong>Doxygen</strong>.
The documentation is automatically built and deployed to GitHub pages and is available online
at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Programs</div>
A collection of annotated example programs, which show how to use certain CPU functions
and peripheral/IO modules, can be found in <code>sw/example</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_compiler_toolchain">4.1. Compiler Toolchain</h3>
<div class="paragraph">
<p>The toolchain for this project is based on the free and open  RISC-V GCC-port. You can find the compiler sources and
build instructions on the official RISC-V GNU toolchain GitHub page: <a href="https://github.com/riscv/riscv-gnutoolchain" class="bare">https://github.com/riscv/riscv-gnutoolchain</a>.</p>
</div>
<div class="paragraph">
<p>The NEORV32 implements a 32-bit RISC-V architecture and uses a 32-bit integer and soft-float ABI by default.
Make sure the toolchain / toolchain build is configured accordingly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MARCH=rv32i</code></p>
</li>
<li>
<p><code>MABI=ilp32</code></p>
</li>
<li>
<p><code>RISCV_PREFIX=riscv32-unknown-elf-</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These default configurations can be overridden at any times using <a href="#_application_makefile">Application Makefile</a> variables.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the toolchain (building from scratch or downloading prebuilt ones) can be found in the
user guide section <a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_core_libraries">4.2. Core Libraries</h3>
<div class="paragraph">
<p>The NEORV32 project provides a set of pre-defined C libraries that allow an easy integration of the processor/CPU features
(also called "HAL" - hardware abstraction layer). All driver and runtime-related files are located in
<code>sw/lib</code>. These are automatically included and linked by adding the following include statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;neorv32.h&gt; // NEORV32 HAL, core and runtime libraries</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 75. NEORV32 HAL File List</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">C source file</th>
<th class="tableblock halign-left valign-top">C header file</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main NEORV32 library file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_crc.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_crc.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cyclic_redundancy_check_crc">Cyclic Redundancy Check (CRC)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_amo.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_amo.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emulation functions for the read-modify-write  <a href="#_a_isa_extension"><code>A</code> ISA Extension</a> instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_csr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> definitions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_cfu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_cfu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_dm.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_debug_module_dm">Debug Module (DM)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_dma.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_dma.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_direct_memory_access_controller_dma">Direct Memory Access Controller (DMA)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_intrinsics.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Macros for intrinsics &amp; custom instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sdi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sdi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_data_interface_controller_sdi">Serial Data Interface Controller (SDI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_sysinfo.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> and UART1 HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xip.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xip.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a> HAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>syscalls.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newlib "system calls" (stubs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>legacy.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backwards compatibility wrappers and functions (do not use for new designs)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Core Library Documentation</div>
The <em>doxygen</em>-based documentation of the software framework including all core libraries is available online at
<a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CMSIS System View Description File (SVD)</div>
A CMSIS-SVD-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.
Together with a third-party plugin the processor&#8217;s SVD file can be imported right into GDB to allow comfortable
debugging of peripheral/IO devices (see <a href="https://github.com/stnolting/neorv32/discussions/656" class="bare">https://github.com/stnolting/neorv32/discussions/656</a>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_application_makefile">4.3. Application Makefile</h3>
<div class="paragraph">
<p>Application compilation is based on a single, centralized GNU makefile (<code>sw/common/common.mk</code>). Each project in the
<code>sw/example</code> folder provides a makefile that just <em>includes</em> this central makefile.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When creating a new project, copy an existing project folder or at least the makefile to the new project folder.
It is recommended to create new projects also in <code>sw/example</code> to keep the file dependencies. However, these
dependencies can be manually configured via makefile variables if the new project is located somewhere else.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Before the makefile can be used to compile applications, the RISC-V GCC toolchain needs to be installed and
the compiler&#8217;s <code>bin</code> folder has to be added to the system&#8217;s <code>PATH</code> environment variable. More information can be
found in <a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">User Guide: Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_makefile_targets">4.3.1. Makefile Targets</h4>
<div class="paragraph">
<p>Just executing <code>make</code> (or executing <code>make help</code>) will show the help menu listing all available targets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile">$ make
NEORV32 Software Application Makefile
Find more information at https://github.com/stnolting/neorv32

Targets:
 help       - show this text
 check      - check toolchain
 info       - show makefile/toolchain configuration
 gdb        - run GNU debugging session
 asm        - compile and generate &lt;main.asm&gt; assembly listing file for manual debugging
 elf        - compile and generate &lt;main.elf&gt; ELF file
 bin        - compile and generate &lt;neorv32_raw_exe.bin&gt; RAW executable file (binary file, no header)
 hex        - compile and generate &lt;neorv32_raw_exe.hex&gt; RAW executable file (hex char file, no header)
 image      - compile and generate VHDL IMEM boot image (for application, no header) in local folder
 install    - compile, generate and install VHDL IMEM boot image (for application, no header)
 sim        - in-console simulation using default/simple testbench and GHDL
 all        - exe + install + hex + bin + asm
 elf_info   - show ELF layout info
 clean      - clean up project home folder
 clean_all  - clean up whole project, core libraries and image generator
 bl_image   - compile and generate VHDL BOOTROM boot image (for bootloader only, no header) in local folder
 bootloader - compile, generate and install VHDL BOOTROM boot image (for bootloader only, no header)

Variables:
 USER_FLAGS     - Custom toolchain flags [append only]: ""
 USER_LIBS      - Custom libraries [append only]: ""
 EFFORT         - Optimization level: "-Os"
 MARCH          - Machine architecture: "rv32i_zicsr_zifencei"
 MABI           - Machine binary interface: "ilp32"
 APP_INC        - C include folder(s) [append only]: "-I ."
 ASM_INC        - ASM include folder(s) [append only]: "-I ."
 RISCV_PREFIX   - Toolchain prefix: "riscv32-unknown-elf-"
 NEORV32_HOME   - NEORV32 home folder: "../../.."
 GDB_ARGS       - GDB (connection) arguments: "-ex target extended-remote localhost:3333"
 GHDL_RUN_FLAGS - GHDL simulation run arguments: ""</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_makefile_configuration">4.3.2. Makefile Configuration</h4>
<div class="paragraph">
<p>The compilation flow is configured via variables right at the beginning of the central
makefile (<code>sw/common/common.mk</code>):</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Customizing Makefile Variables</div>
The makefile configuration variables can be overridden or extended directly when invoking the makefile. For
example <code>$ make MARCH=rv32ic_zicsr_zifencei clean_all exe</code> overrides the default <code>MARCH</code> variable definitions.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 11. Default Makefile Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># *****************************************************************************
# USER CONFIGURATION
# *****************************************************************************
# User's application sources (*.c, *.cpp, *.s, *.S); add additional files here
APP_SRC ?= $(wildcard ./*.c) $(wildcard ./*.s) $(wildcard ./*.cpp) $(wildcard ./*.S)
# User's application include folders (don't forget the '-I' before each entry)
APP_INC ?= -I .
# User's application include folders - for assembly files only (don't forget the '-I' before each
entry)
ASM_INC ?= -I .
# Optimization
EFFORT ?= -Os
# Compiler toolchain
RISCV_PREFIX ?= riscv32-unknown-elf-
# CPU architecture and ABI
MARCH ?= rv32i_zicsr_zifencei
MABI  ?= ilp32
# User flags for additional configuration (will be added to compiler flags)
USER_FLAGS ?=
# User libraries (will be included by linker)
USER_LIBS ?=
# Relative or absolute path to the NEORV32 home folder
NEORV32_HOME ?= ../../..
# GDB arguments
GDB_ARGS ?= -ex "target extended-remote localhost:3333"
# *****************************************************************************</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 76. Variables Description</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APP_SRC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source files of the application (<code><strong>.c</code>, <code></strong>.cpp</code>, <code><strong>.S</code> and <code></strong>.s</code> files are allowed; files of these types in the project folder are automatically added via wild cards). Additional files can be added separated by white spaces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APP_INC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders; separated by white spaces; must be defined with <code>-I</code> prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASM_INC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders that are used only for the assembly source files (<code><strong>.S</code>/<code></strong>.s</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EFFORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimization level, optimize for size (<code>-Os</code>) is default; legal values: <code>-O0</code>, <code>-O1</code>, <code>-O2</code>, <code>-O3</code>, <code>-Os</code>, <code>-Ofast</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_PREFIX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The toolchain prefix to be used; follows the triplet naming convention <code>[architecture]-[host_system]-[output]-&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MARCH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The targeted RISC-V architecture/ISA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MABI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application binary interface (default: 32-bit integer ABI <code>ilp32</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USER_FLAGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional flags that will be forwarded to the compiler tools</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USER_LIBS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional libraries to include during linking (<code>*.a</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative or absolute path to the NEORV32 project home folder; adapt this if the makefile/project is not in the project&#8217;s default <code>sw/example</code> folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GDB_ARGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default GDB arguments when running the <code>gdb</code> target</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GHDL_RUN_FLAGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GHDL run arguments (e.g. <code>--stop-time=1ms</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_default_compiler_flags">4.3.3. Default Compiler Flags</h4>
<div class="paragraph">
<p>The following default compiler flags are used for compiling an application. These flags are defined via the
<code>CC_OPTS</code> variable.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The makefile&#8217;s <code>CC_OPTS</code> is exported as <strong>define</strong> to be available within a C program; for example
<code>neorv32_uart0_printf("%s\n", CC_OPTS);</code>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable all compiler warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ffunction-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put functions and data segment in independent sections. This allows a code optimization as dead code and unused data can be easily removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-nostartfiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use the default start code. Instead, the NEORV32-specific start-up code (<code>sw/common/crt0.S</code>) is used (pulled-in by the linker script).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wl,--gc-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make the linker perform dead code elimination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include/link with <code>math.h</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for the standard C library when linking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lgcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make sure we have no unresolved references to internal GCC library subroutines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mno-fdiv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use built-in software functions for floating-point divisions and square roots (since the according instructions are not supported yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-g</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include debugging information/symbols in ELF.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mstrict-align</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unaligned memory accesses cannot be resolved by the hardware and require emulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mbranch-cost=10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branching costs a lot of cycles.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_custom_compiler_flags">4.3.4. Custom (Compiler) Flags</h4>
<div class="paragraph">
<p>Custom flags can be <em>appended</em> to the <code>USER_FLAGS</code> variable. This allows to customize the entire software framework while
calling <code>make</code> without the need to change the makefile(s) or the linker script. The following example will add debug symbols
to the executable (<code>-g</code>) and will also re-define the linker script&#8217;s <code>__neorv32_heap_size</code> variable setting the maximal heap
size to 4096 bytes (see sections <a href="#_linker_script">Linker Script</a> and <a href="#_ram_layout">RAM Layout</a>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Using the <code>USER_FLAGS</code> Variable for Customization</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make USER_FLAGS+="-g -Wl,--__neorv32_heap_size,__heap_size=4096" clean_all exe</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration can also be made "permanent" by adapting the application&#8217;s makefile (make sure to use the
<code>override</code> command here):</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Using the <code>USER_FLAGS</code> Variable for Permanent Customization</div>
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile">override USER_FLAGS += "-g -Wl,--__neorv32_heap_size,__heap_size=4096"</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_executable_image_format">4.4. Executable Image Format</h3>
<div class="paragraph">
<p>In order to generate an executable for the processors all source files have to be compiled, linked
and packed into a final executable.</p>
</div>
<div class="sect3">
<h4 id="_linker_script">4.4.1. Linker Script</h4>
<div class="paragraph">
<p>After all the application sources have been compiled, they need to be <em>linked</em>.
For this purpose the makefile uses the NEORV32-specific linker script <code>sw/common/neorv32.ld</code> for
linking all object files that were generated during compilation. In general, the linker script defines
two final memory sections: <code>rom</code> and <code>ram</code>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 77. Linker script - memory sections</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory section</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ram</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data memory address space (processor-internal/external DMEM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction memory address space (processor-internal/external IMEM) <em>or</em> internal bootloader ROM</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>rom</code> section is automatically re-mapped to the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> when (re-)compiling the
bootloader
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each section has two main attributes: <code>ORIGIN</code> and <code>LENGTH</code>. <code>ORIGIN</code> defines the base address of the according section
while <code>LENGTH</code> defines its size in bytes. The attributes are configured indirectly via variables that provide default values.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Linker script - section configuration</div>
<div class="content">
<pre class="highlight"><code>/* Default rom/ram (IMEM/DMEM) sizes */
__neorv32_rom_size = DEFINED(__neorv32_rom_size) ? __neorv32_rom_size : 2048M;
__neorv32_ram_size = DEFINED(__neorv32_ram_size) ? __neorv32_ram_size : 8K;

/* Default section base addresses */
__neorv32_rom_base = DEFINED(__neorv32_rom_base) ? __neorv32_rom_base : 0x00000000;
__neorv32_ram_base = DEFINED(__neorv32_ram_base) ? __neorv32_ram_base : 0x80000000;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The region size and base address configuration can be edited by the user - either by explicitly
changing the default values in the linker script or by overriding them when invoking <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Overriding default <code>rom</code> size configuration (configuring 4096 bytes)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make USER_FLAGS+="-Wl,--defsym,__neorv32_rom_size=4096" clean_all exe</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code><em>neorv32_rom_base</code> (= <code>ORIGIN</code> of the <code>ram</code> section) and <code></em>neorv32_ram_base</code> (= <code>ORIGIN</code> of the <code>rom</code> section) have to
be sync to the actual memory layout configuration of the processor (see section <a href="#_address_space">Address Space</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default configuration for the <code>rom</code> section assumes a maximum of 2GB <em>logical</em> memory address space. This size does not
have to reflect the <em>actual</em> physical size of the entire instruction memory. It just provides a maximum limit. When uploading
a new executable via the bootloader, the bootloader itself checks if sufficient <em>physical</em> instruction memory is available.
If a new executable is embedded right into the internal-IMEM the synthesis tool will check, if the configured instruction memory
size is sufficient.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The linker maps all the regions from the compiled object files into five final sections: <code>.text</code>,
<code>.rodata</code>, <code>.data</code>, <code>.bss</code> and <code>.heap</code>:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 78. Linker script - memory regions</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Region</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executable instructions generated from the start-up code and all application sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.rodata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constants (like strings) from the application; also the initial data for initialized variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of fixed (= global) variables only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.bss</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of dynamic memory constructs only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.heap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of dynamic memory constructs only.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>.text</code> and <code>.rodata</code> sections are mapped to processor&#8217;s instruction memory space and the <code>.data</code>,
<code>.bss</code> and <code>heap</code> sections are mapped to the processor&#8217;s data memory space. Finally, the <code>.text</code>, <code>.rodata</code> and <code>.data</code>
sections are extracted and concatenated into a single file <code>main.bin</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Section Alignment</div>
The default NEORV32 linker script aligns <em>all</em> regions so they start and end on a 32-bit (word) boundaries. The default
NEORV32 start-up code (crt0) makes use of this alignment by using word-level memory instructions to initialize the <code>.data</code>
section and to clear the <code>.bss</code> section (faster!).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ram_layout">4.4.2. RAM Layout</h4>
<div class="paragraph">
<p>The default NEORV32 linker script uses all of the defined RAM (linker script memory section <code>ram</code>) to several sections.
Note that depending on the application some sections might have zero size.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ram_layout.png" alt="400">
</div>
<div class="title">Figure 13. Default RAM Layout</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>Constant data (<code>.data</code>)</strong>: The constant data section is placed right at the beginning of the RAM. For example, this section
contains <em>explicitly initialized</em> global variables. This section is initialized by the executable.</p>
</li>
<li>
<p><strong>Dynamic data (<code>.bss</code>)</strong>: The constant data section is followed by the dynamic data section, which contains <em>uninitialized</em> data
like global variables without explicit initialization. This section is cleared by the start-up code <code>crt0.S</code>.</p>
</li>
<li>
<p><strong>Heap (<code>.heap</code>)</strong>: The heap is used for dynamic memory that is managed by functions like <code>malloc()</code> and <code>free()</code>. The heap
grows upwards. This section is not initialized at all.</p>
</li>
<li>
<p><strong>Stack</strong>: The stack starts at the very end of the RAM at address <code>ORIGIN(ram) + LENGTH(ram) - 4</code>. The stack grows downwards.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is <em>no explicit limit</em> for the maximum stack size as this is hard to check. However, a physical memory protection rule could
be used to configure a maximum size by adding a "protection area" between stack and heap (a PMP region without any access rights).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Heap Size</div>
The maximum size of the heap is defined by the linker script&#8217;s <code><em>neorv32_heap_size</code> variable. This variable has to be
<strong>explicitly defined</strong> in order to define a heap size (and to use dynamic memory allocation at all) other than zero. The user
can define the heap size while invoking the application makefile: <code>$ USER_FLAGS+="-Wl,--defsym,</em>neorv32_heap_size=4k" make clean_all exe</code>
(defines a heap size of 4*1024 bytes).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Heap-Stack Collisions</div>
Take care when using dynamic memory to avoid collision of the heap and stack memory areas. There is no compile-time protection
mechanism available as the actual heap and stack size are defined by <em>runtime</em> data. Also beware of fragmentation when
using dynamic memory allocation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_c_standard_library">4.4.3. C Standard Library</h4>
<div class="paragraph">
<p>The default software framework relies on <strong>newlib</strong> as default C standard library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RTOS Support</div>
The NEORV32 CPU and processor <strong>do support</strong> embedded RTOS like FreeRTOS and Zephyr. See the User guide section
<a href="https://stnolting.github.io/neorv32/ug/#_zephyr_rtos_support">Zephyr RTOS Support</a> and
<a href="https://stnolting.github.io/neorv32/ug/#_freertos_support">FreeRTOS Support</a>
for more information.<br>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
The FreeRTOS port and demo is available in a separate repository: <a href="https://github.com/stnolting/neorv32-freertos" class="bare">https://github.com/stnolting/neorv32-freertos</a></p>
</div>
<div class="paragraph">
<p>Newlib provides stubs for common "system calls" (like file handling and standard input/output) that are used by other
C libraries like <code>stdio</code>. These stubs are available in <code>sw/source/source/syscalls.c</code> and were adapted for the NEORV32 processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Consoles</div>
The <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>
is used to implement all the standard input, output and error consoles (<code>STDIN</code>, <code>STDOUT</code> and <code>STDERR</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Constructors and Destructors</div>
Constructors and destructors for plain C code or for C++ applications are supported by the software framework.
See <code>sw/example/hello_cpp</code> for a minimal example.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Newlib Test/Demo Program</div>
A simple test and demo program, which uses some of newlib&#8217;s core functions (like <code>malloc</code>/<code>free</code> and <code>read</code>/<code>write</code>)
is available in <code>sw/example/demo_newlib</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_executable_image_generator">4.4.4. Executable Image Generator</h4>
<div class="paragraph">
<p>The <code>main.bin</code> file is packed by the NEORV32 image generator (<code>sw/image_gen</code>) to generate the final executable file.
The image generator can generate several types of executables selected by a flag when calling the generator:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable binary file <code>neorv32_exe.bin</code> (including header) for UART uploading via the bootloader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image (no header) for the processor-internal IMEM. This option generates the <code>rtl/core/neorv32_application_image.vhd</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-raw_hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a plain ASCII hex-char file <code>neorv32_raw_exe.hex</code> (no header) for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-raw_bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a plain binary file <code>neorv32_raw_exe.bin</code> (no header) for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-bld_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image (no header) for the processor-internal BOOT ROM. This option generates the <code>rtl/core/neorv32_bootloader_image.vhd</code> file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these options are managed by the makefile. The normal application compilation flow will generate the <code>neorv32_exe.bin</code>
executable designated for uploading via the default NEORV32 bootloader.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Image Generator Compilation</div>
The sources of the image generator are automatically compiled when invoking the makefile (requiring a native GCC installation).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Executable Header</div>
The image generator add a small header to the <code>neorv32_exe.bin</code> executable, which consists of three 32-bit words located right
at the beginning of the file. The first word of the executable is the signature word and is always <code>0x4788cafe</code>. Based on this
word the bootloader can identify a valid image file. The next word represents the size in bytes of the actual program image in
bytes. A simple "complement" checksum of the actual program image is given by the third word. This provides a simple protection
against data transmission or storage errors. <strong>Note that this executable format cannot be used for <em>direct</em> execution (e.g. via
XIP or direct memory access).</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_start_up_code_crt0">4.4.5. Start-Up Code (crt0)</h4>
<div class="paragraph">
<p>The CPU and also the processor require a minimal start-up and initialization code to bring the CPU (and the SoC)
into a stable and initialized state and to initialize the C runtime environment before the actual application can be executed.
This start-up code is located in <code>sw/common/crt0.S</code> and is automatically linked <em>every</em> application program
and placed right before the actual application code so it gets executed right after reset.</p>
</div>
<div class="paragraph">
<p>The <code>crt0.S</code> start-up performs the following operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Clear <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.</p>
</li>
<li>
<p>Clear <a href="#_mie"><strong><code>mie</code></strong></a> disabling all interrupt sources.</p>
</li>
<li>
<p>Install an <a href="#_early_trap_handler">Early Trap Handler</a> to <a href="#_mtvec"><strong><code>mtvec</code></strong></a>.</p>
</li>
<li>
<p>Initialize the global pointer <code>gp</code> and the stack pointer <code>sp</code> according to the <a href="#_ram_layout">RAM Layout</a> provided by the linker script.</p>
</li>
<li>
<p>Initialize all integer register <code>x1</code> - <code>x31</code> (only <code>x1</code> - <code>x15</code> if the <code>E</code> CPU extension is enabled).</p>
</li>
<li>
<p>Setup <code>.data</code> section to configure initialized variables.</p>
</li>
<li>
<p>Clear the <code>.bss</code> section.</p>
</li>
<li>
<p>Call all <em>constructors</em> (if there are any).</p>
</li>
<li>
<p>Call the application&#8217;s <code>main</code> function (with no arguments: <code>argc</code> = <code>argv</code> = 0).</p>
</li>
<li>
<p>If <code>main</code> returns:</p>
<div class="ulist">
<ul>
<li>
<p>All interrupt sources are disabled by clearing <a href="#_mie"><strong><code>mie</code></strong></a>.</p>
</li>
<li>
<p>The return value of <code>main</code> is copied to the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR to allow inspection by the debugger.</p>
</li>
<li>
<p>Call all <em>destructors</em> (if there are any).</p>
</li>
<li>
<p>The CPU enters sleep mode executing the <code>wfi</code> instruction in an endless loop.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bootloader Start-Up Code</div>
The bootloader uses the same start-up code as any "usual" application. However, certain parts are omitted when compiling
<code>crt0</code> for the bootloader (like calling constructors and destructors). See the <code>crt0</code> source code for more information.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_early_trap_handler">Early Trap Handler</h5>
<div class="paragraph">
<p>The start-up code provides a very basic trap handler for the early boot stage. This handler does nothing but trying to move
on to the next linear instruction whenever an interrupt or synchronous exception is encountered.</p>
</div>
<div class="paragraph">
<p>This simple trap handler does not interact with the stack at all as it just uses a single register that is backup-ed
using the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR. Furthermore, the information if the trap-causing instruction is compressed or uncompressed
is <strong>not</strong> determined by loading the instruction from memory. Instead, the transformed instruction word is read from the
<a href="#_mtinst"><strong><code>mtinst</code></strong></a> CSRs. These two features allow the trap handler to execute with minimal latency and high robustness.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The early-trap handler should be replaced by a more capable / informative one as soon as the application software is started
(for example by using the <a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bootloader">4.5. Bootloader</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Pre-Built Bootloader Image</div>
This section refers to the <strong>default</strong> NEORV32 bootloader. A pre-compiled memory image for the processor-internal
<a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is available in the project&#8217;s rtl folder: <code>rtl/core/neorv32_bootloader_image.vhd</code>.
This image is automatically inserted into the boot ROM when synthesizing the processor with the bootloader being
enabled. <strong>Note that the default bootloader image was compiled for a minimal <code>rv32i</code> + priv. ISA!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 bootloader (<code>sw/bootloader/bootloader.c</code>) provides an optional built-in firmware that
allows to upload new application executables at <em>any time</em> without the need to re-synthesize the FPGA&#8217;s bitstream.
A UART connection is used to provide a simple text-based user interface that allows to upload executables.</p>
</div>
<div class="paragraph">
<p>Furthermore, the bootloader provides options to store an executable to a processor-external SPI flash.
An "auto boot" feature can optionally fetch this executable right after reset if there is no user interaction
via UART. This allows to build processor setups with <em>non-volatile application storage</em> while maintaining the option
to update the application software at any timer.</p>
</div>
<div class="sect3">
<h4 id="_bootloader_soccpu_requirements">4.5.1. Bootloader SoC/CPU Requirements</h4>
<div class="paragraph">
<p>The bootloader requires certain CPU and SoC extensions and modules to be enabled in order to operate correctly.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader is implemented only if the <code>INT_BOOTLOADER_EN</code> top generic is <code>true</code>. This will automatically select the CPU&#8217;s <a href="#_indirect_boot">Indirect Boot</a> boot configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader requires the privileged architecture CPU extension (<a href="#_zicsr_isa_extension"><code>Zicsr</code> ISA Extension</a>) to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least 512 bytes of data memory (processor-internal DMEM or processor-external DMEM) are required for the bootloader&#8217;s stack and global variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For user interaction via the <a href="#_bootloader_console">Bootloader Console</a> (like uploading executables) the primary UART (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>) is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default bootloader uses bit 0 of the <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> output port to drive a high-active "heart beat" status LED.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> is used to control blinking of the status LED and also to automatically trigger the <a href="#_auto_boot_sequence">Auto Boot Sequence</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">OPTIONAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SPI controller (<a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>) is needed to store/load executable from external flash using the <a href="#_auto_boot_sequence">Auto Boot Sequence</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">OPTIONAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The XIP controller (<a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a>) is needed to boot/execute code directly from a pre-programmed SPI flash.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_bootloader_flash_requirements">4.5.2. Bootloader Flash Requirements</h4>
<div class="paragraph">
<p>The bootloader can access an SPI-compatible flash via the processor&#8217;s top entity SPI port. By default, the flash
chip-select line is driven by <code>spi_csn_o(0)</code> and the SPI clock uses 1/8 of the processor&#8217;s main clock as clock frequency.
The SPI flash has to support single-byte read and write operations, 24-bit addresses and at least the following standard commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0x02</code>: Program page (write byte)</p>
</li>
<li>
<p><code>0x03</code>: Read data (byte)</p>
</li>
<li>
<p><code>0x04</code>: Write disable (for volatile status register)</p>
</li>
<li>
<p><code>0x05</code>: Read (first) status register</p>
</li>
<li>
<p><code>0x06</code>: Write enable (for volatile status register)</p>
</li>
<li>
<p><code>0xAB</code>: Wake-up from sleep mode (optional)</p>
</li>
<li>
<p><code>0xD8</code>: Block erase (64kB)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Custom Configuration</div>
Most properties (like chip select line, flash address width, SPI clock frequency, &#8230;&#8203;) of the default bootloader can be reconfigured
without the need to change the source code. Custom configuration can be made using command line switches (defines) when recompiling
the bootloader. See the User Guide <a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader" class="bare">https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bootloader_console">4.5.3. Bootloader Console</h4>
<div class="paragraph">
<p>To interact with the bootloader, connect the primary UART (UART0) signals (<code>uart0_txd_o</code> and <code>uart0_rxd_o</code>) of the processor&#8217;s top
entity via a serial port (-adapter) to your computer (hardware flow control is not used so the according interface signals can be
ignored), configure your terminal program using the following settings and perform a reset of the processor.</p>
</div>
<div class="paragraph">
<p>Terminal console settings (<code>19200-8-N-1</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>19200 Baud</p>
</li>
<li>
<p>8 data bits</p>
</li>
<li>
<p>no parity bit</p>
</li>
<li>
<p>1 stop bit</p>
</li>
<li>
<p>newline on <code>\r\n</code> (carriage return, newline)</p>
</li>
<li>
<p>no transfer protocol / control flow protocol - just raw bytes</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Terminal Program</div>
Any terminal program that can connect to a serial port should work. However, make sure the program
can transfer data in <em>raw</em> byte mode without any protocol overhead (e.g. XMODEM). Some terminal programs struggle with
transmitting files larger than 4kB (see <a href="https://github.com/stnolting/neorv32/pull/215" class="bare">https://github.com/stnolting/neorv32/pull/215</a>). Try a different terminal program
if uploading of a binary does not work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bootloader uses the LSB of the top entity&#8217;s <code>gpio_o</code> output port as high-active status LED. All other
output pins are set to low level and won&#8217;t be altered. After reset, the status LED will start blinking at 2Hz and the
following intro screen shows up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar  7 2023
HWV:  0x01080107
CLK:  0x05f5e100
MISA: 0x40901106
XISA: 0xc0000fab
SOC:  0xffff402f
IMEM: 0x00008000
DMEM: 0x00002000

Autoboot in 8s. Press any key to abort.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The start-up screen gives some brief information about the bootloader and several system configuration parameters:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.7647%;">
<col style="width: 88.2353%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLDV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader version (built date).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HWV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor hardware version (the <a href="#_mimpid"><strong><code>mimpid</code></strong></a> CSR); in BCD format; example: <code>0x01040606</code> = v1.4.6.6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor clock speed in Hz (via the <code>CLK</code> register from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MISA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V CPU extensions (<a href="#_misa"><strong><code>misa</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XISA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEORV32-specific CPU extensions (<a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor configuration (via the <code>SOC</code> register from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal IMEM size in byte (via the <code>MEM</code> register from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal DMEM size in byte (via the <code>MEM</code> register from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now you have 8 seconds to press <em>any</em> key. Otherwise, the bootloader starts the <a href="#_auto_boot_sequence">Auto Boot Sequence</a>. When
you press any key within the 8 seconds, the actual bootloader user console starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar  7 2023
HWV:  0x01080107
CLK:  0x05f5e100
MISA: 0x40901106
XISA: 0xc0000fab
SOC:  0xffff402f
IMEM: 0x00008000
DMEM: 0x00002000

Autoboot in 8s. Press any key to abort. <i class="conum" data-value="1"></i><b>(1)</b>
Aborted.

Available CMDs:
 h: Help
 r: Restart
 u: Upload
 s: Store to flash
 l: Load from flash
 x: Boot from flash (XIP)
 e: Execute
CMD:&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Auto boot sequence aborted due to user console input.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The auto boot countdown is stopped and the bootloader&#8217;s user console is ready to receive one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>h</code>: Show the help text (again)</p>
</li>
<li>
<p><code>r</code>: Restart the bootloader and the auto-boot sequence</p>
</li>
<li>
<p><code>u</code>: Upload new program executable (<code>neorv32_exe.bin</code>) via UART into the instruction memory</p>
</li>
<li>
<p><code>s</code>: Store executable to SPI flash at <code>spi_csn_o(0)</code> (little-endian byte order)</p>
</li>
<li>
<p><code>l</code>: Load executable from SPI flash at <code>spi_csn_o(0)</code> (little-endian byte order)</p>
</li>
<li>
<p><code>x</code>: Boot program directly from flash via XIP (requires a pre-programmed image)</p>
</li>
<li>
<p><code>e</code>: Start the application, which is currently stored in the instruction memory (IMEM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A new executable can be uploaded via UART by executing the <code>u</code> command. After that, the executable can be directly
executed via the <code>e</code> command. To store the recently uploaded executable to an attached SPI flash press <code>s</code>. To
directly load an executable from the SPI flash press <code>l</code>. The bootloader and the auto-boot sequence can be
manually restarted via the <code>r</code> command.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Executable Upload</div>
Make sure to upload the NEORV32 executable <code>neorv32_exe.bin</code>. Uploading any other file (like <code>main.bin</code>)
will cause an <code>ERR_EXE</code> bootloader error (see <a href="#_bootloader_error_codes">Bootloader Error Codes</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Booting via XIP</div>
The bootloader allows to execute an application right from flash using the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> module.
This requires a pre-programmed flash. The bootloader&#8217;s "store" option can <strong>not</strong> be used to program an XIP image.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">SPI Flash Power Down Mode</div>
The bootloader will issue a "wake-up" command prior to using the SPI flash to ensure it is not
in sleep mode / power-down mode (see <a href="https://github.com/stnolting/neorv32/pull/552" class="bare">https://github.com/stnolting/neorv32/pull/552</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Default Configuration</div>
More information regarding the default SPI, GPIO, XIP, etc. configuration can be found in the User Guide
section <a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader" class="bare">https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">SPI Flash Programming</div>
For detailed information on using an SPI flash for application storage see User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boot_sequence">4.5.4. Auto Boot Sequence</h4>
<div class="paragraph">
<p>When you reset the NEORV32 processor, the bootloader waits 8 seconds for a UART console input before it
starts the automatic boot sequence. This sequence tries to fetch a valid boot image from the external SPI
flash, connected to SPI chip select <code>spi_csn_o(0)</code>. If a valid boot image is found that can be successfully
transferred into the instruction memory, it is automatically started. If no SPI flash is detected or if there
is no valid boot image found, and error code will be shown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bootloader_error_codes">4.5.5. Bootloader Error Codes</h4>
<div class="paragraph">
<p>If something goes wrong during bootloader operation an error code and a short message is shown. In this case the processor
is halted, the bootloader status LED is permanently activated and the processor has to be reset manually.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In many cases the error source is just <em>temporary</em> (like some HF spike during an UART upload). Just try again.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_EXE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you try to transfer an invalid executable (via UART or from the external SPI flash), this error message shows up. There might be a transfer protocol configuration error in the terminal program or maybe just the wrong file was selected. Also, if no SPI flash was found during an auto-boot attempt, this message will be displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_SIZE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your program is way too big for the internal processor’s instructions memory. Increase the memory size or reduce your application code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_CHKS</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates a checksum error. Something went wrong during the transfer of the program image (upload via UART or loading from the external SPI flash). If the error was caused by a UART upload, just try it again. When the error was generated during a flash access, the stored image might be corrupted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_FLSH</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This error occurs if the attached SPI flash cannot be accessed. Make sure you have the right type of flash and that it is properly connected to the NEORV32 SPI port using chip select #0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_EXC</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader encountered an unexpected exception during operation. This might be caused when it tries to access peripherals that were not implemented during synthesis. Example: executing commands <code>l</code> or <code>s</code> (SPI flash operations) without the SPI module being implemented.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If an unexpected exception has been raised the bootloader prints hexadecimal debug information showing
the <a href="#_mcause"><strong><code>mcause</code></strong></a>, <a href="#_mepc"><strong><code>mepc</code></strong></a> and <a href="#_mtval"><strong><code>mtval</code></strong></a> CSR values.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</h3>
<div class="paragraph">
<p>The NEORV32 software framework provides a minimal <strong>runtime environment</strong> (abbreviated "RTE") that takes care of a stable
and <em>safe</em> execution environment by handling <em>all</em> traps (exceptions &amp; interrupts). The RTE simplifies trap handling
by wrapping the CPU&#8217;s privileged architecture (i.e. trap-related CSRs) into a unified software API.</p>
</div>
<div class="paragraph">
<p>Once initialized, the RTE provides <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> that catch all possible traps. These
default handlers just output a message via UART to inform the user when a certain trap has been triggered. The
default handlers can be overridden by the application code to install application-specific handler functions for each trap.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using the RTE is <strong>optional but highly recommended</strong>. The RTE provides a simple and comfortable way of delegating
traps to application-specific handlers while making sure that all traps (even though they are not explicitly used
by the application) are handled correctly. Performance-optimized applications or embedded operating systems may
not use the RTE at all in order to increase response time.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rte_operation">4.6.1. RTE Operation</h4>
<div class="paragraph">
<p>The RTE manages the trap-related CSRs of the CPU&#8217;s privileged architecture (<a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a>).
It initializes the <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR in DIRECT mode, which then provides the base entry point for <em>all</em> traps. The address
stored to this register defines the address of the  <strong>first-level trap handler</strong>, which is provided by the
NEORV32 RTE. Whenever an exception or interrupt is triggered this first-level trap handler is executed.</p>
</div>
<div class="paragraph">
<p>The first-level handler performs a complete context save, analyzes the source of the trap and
calls the according <strong>second-level trap handler</strong>, which takes care of the actual exception/interrupt
handling. The RTE manages a private look-up table to store the addresses of the according second-level trap handlers.</p>
</div>
<div class="paragraph">
<p>After the initial RTE setup, each entry in the RTE&#8217;s trap handler look-up table is initialized with a
<a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a>. These default handler do not execute any trap-related operations - they
just output a message via the <strong>primary UART (UART0)</strong> to inform the user that a trap has occurred, which is not (yet)
handled by the actual application. After sending this message, the RTE tries to continue executing the actual program
by resolving the trap cause.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_rte">4.6.2. Using the RTE</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All provided RTE functions can be called only from machine-mode code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 is part of the default NEORV32 software framework. However, it has to explicitly enabled by calling
the RTE&#8217;s setup function:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. RTE Setup (Function Prototype)</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void neorv32_rte_setup(void);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RTE should be enabled right at the beginning of the application&#8217;s <code>main</code> function.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is recommended to not use the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR when using the RTE as this register is used to provide services
for <a href="#_application_context_handling">Application Context Handling</a> (i.e. modifying the registers of application code that caused a trap).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As mentioned above, all traps will just trigger execution of the RTE&#8217;s <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> at first.
To use application-specific handlers, which actually "handle" a trap, the default handlers can be overridden
by installing user-defined ones:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Installing an Application-Specific Trap Handler (Function Prototype)</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_handler_install(uint8_t id, void (*handler)(void));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument <code>id</code> defines the "trap ID" (for example a certain interrupt request) that shall be handled
by the user-defined handler. These IDs are defined in <code>sw/lib/include/neorv32_rte.h</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. RTE Trap Identifiers (cut-out)</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">enum NEORV32_RTE_TRAP_enum {
  RTE_TRAP_I_MISALIGNED =  0, /**&lt; Instruction address misaligned */
  RTE_TRAP_I_ACCESS     =  1, /**&lt; Instruction (bus) access fault */
  RTE_TRAP_I_ILLEGAL    =  2, /**&lt; Illegal instruction */
  RTE_TRAP_BREAKPOINT   =  3, /**&lt; Breakpoint (EBREAK instruction) */
  RTE_TRAP_L_MISALIGNED =  4, /**&lt; Load address misaligned */
  RTE_TRAP_L_ACCESS     =  5, /**&lt; Load (bus) access fault */
  RTE_TRAP_S_MISALIGNED =  6, /**&lt; Store address misaligned */
  RTE_TRAP_S_ACCESS     =  7, /**&lt; Store (bus) access fault */
  RTE_TRAP_UENV_CALL    =  8, /**&lt; Environment call from user mode (ECALL instruction) */
  RTE_TRAP_MENV_CALL    =  9, /**&lt; Environment call from machine mode (ECALL instruction) */
  RTE_TRAP_MSI          = 10, /**&lt; Machine software interrupt */
  RTE_TRAP_MTI          = 11, /**&lt; Machine timer interrupt */
  RTE_TRAP_MEI          = 12, /**&lt; Machine external interrupt */
  RTE_TRAP_FIRQ_0       = 13, /**&lt; Fast interrupt channel 0 */
  RTE_TRAP_FIRQ_1       = 14, /**&lt; Fast interrupt channel 1 */
  RTE_TRAP_FIRQ_2       = 15, /**&lt; Fast interrupt channel 2 */
  RTE_TRAP_FIRQ_3       = 16, /**&lt; Fast interrupt channel 3 */
  RTE_TRAP_FIRQ_4       = 17, /**&lt; Fast interrupt channel 4 */
  RTE_TRAP_FIRQ_5       = 18, /**&lt; Fast interrupt channel 5 */
  RTE_TRAP_FIRQ_6       = 19, /**&lt; Fast interrupt channel 6 */
  RTE_TRAP_FIRQ_7       = 20, /**&lt; Fast interrupt channel 7 */
  RTE_TRAP_FIRQ_8       = 21, /**&lt; Fast interrupt channel 8 */
  RTE_TRAP_FIRQ_9       = 22, /**&lt; Fast interrupt channel 9 */
  RTE_TRAP_FIRQ_10      = 23, /**&lt; Fast interrupt channel 10 */
  RTE_TRAP_FIRQ_11      = 24, /**&lt; Fast interrupt channel 11 */
  RTE_TRAP_FIRQ_12      = 25, /**&lt; Fast interrupt channel 12 */
  RTE_TRAP_FIRQ_13      = 26, /**&lt; Fast interrupt channel 13 */
  RTE_TRAP_FIRQ_14      = 27, /**&lt; Fast interrupt channel 14 */
  RTE_TRAP_FIRQ_15      = 28  /**&lt; Fast interrupt channel 15 */</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second argument <code>*handler</code> is the actual function that implements the user-defined trap handler.
The custom handler functions need to have a specific format without any arguments and with no return value:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Custom Trap Handler (Function Prototype)</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void custom_trap_handler_xyz(void) {

  // handle trap...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Custom Trap Handler Attributes</div>
Do <strong>NOT</strong> use the <code>interrupt</code> attribute for the application trap handler functions! This
will place a <code>mret</code> instruction to the end of it making it impossible to return to the first-level
trap handler of the RTE core, which will cause stack corruption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to install a custom handler (<code>custom_mtime_irq_handler</code>) for handling
the RISC-V machine timer (MTIME) interrupt:</p>
</div>
<div class="listingblock">
<div class="title">Listing 20. Installing a MTIME IRQ Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_handler_install(RTE_TRAP_MTI, custom_mtime_irq_handler);</code></pre>
</div>
</div>
<div class="paragraph">
<p>User-defined trap handlers can also be un-installed. This will remove the users trap handler from the RTE core
and will re-install the <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> for the specific trap.</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. Function Prototype: Installing an Application-Specific Trap Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_handler_uninstall(uint8_t id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument <code>id</code> defines the identifier of the according trap that shall be un-installed.
The following example shows how to un-install the custom handler <code>custom_mtime_irq_handler</code> from the
RISC-V machine timer (MTIME) interrupt:</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Example: Removing the Custom MTIME IRQ Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_handler_uninstall(RTE_TRAP_MTI);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The current RTE configuration can be printed via UART0 via the <code>neorv32_rte_info</code> function.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_default_rte_trap_handlers">4.6.3. Default RTE Trap Handlers</h4>
<div class="paragraph">
<p>The default RTE trap handlers are executed when a certain trap is triggered that is not (yet) handled by an
application-defined trap handler. The default handler will output a message giving additional debug information
via the <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> to inform the user and it will also
try to resume normal program execution. Some exemplary RTE outputs are shown below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Continuing Execution</div>
In most cases the RTE can successfully continue operation - for example if it catches an <strong>interrupt</strong> request
that is not handled by the actual application program. However, if the RTE catches an un-handled <strong>trap</strong> like
a bus access fault exception continuing execution will most likely fail making the CPU crash. Some exceptions
cannot be resolved by the default debug trap handlers and will halt the CPU (see example below).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 23. RTE Default Trap Handler Output Examples</div>
<div class="content">
<pre class="highlight"><code>&lt;NEORV32-RTE&gt; [M] Illegal instruction @ PC=0x000002d6, MTINST=0x000000FF, MTVAL=0x00000000 &lt;/NEORV32-RTE&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;NEORV32-RTE&gt; [U] Illegal instruction @ PC=0x00000302, MTINST=0x00000000, MTVAL=0x00000000 &lt;/NEORV32-RTE&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;NEORV32-RTE&gt; [U] Load address misaligned @ PC=0x00000440, MTINST=0x01052603, MTVAL=0x80000101 &lt;/NEORV32-RTE&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;NEORV32-RTE&gt; [M] Fast IRQ 0x00000003 @ PC=0x00000820, MTINST=0x00000000, MTVAL=0x00000000 &lt;/NEORV32-RTE&gt; <i class="conum" data-value="4"></i><b>(4)</b>
&lt;NEORV32-RTE&gt; [M] Instruction access fault @ PC=0x90000000, MTINST=0x42078b63, MTVAL=0x00000000 !!FATAL EXCEPTION!! Halting CPU. &lt;/NEORV32-RTE&gt;\n <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Illegal 32-bit instruction <code>MTINST=0x000000FF</code> at address <code>PC=0x000002d6</code> while the CPU was in machine-mode (<code>[M]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Illegal 16-bit instruction <code>MTINST=0x00000000</code> at address <code>PC=0x00000302</code> while the CPU was in user-mode (<code>[U]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Misaligned load access at address <code>PC=0x00000440</code> caused by instruction <code>MTINST=0x01052603</code> (trying to load a full 32-bit word from address <code>MTVAL=0x80000101</code>) while the CPU was in machine-mode (<code>[U]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Fast interrupt request from channel 3 before executing instruction at address <code>PC=0x00000820</code> while the CPU was in machine-mode (<code>[M]</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Instruction bus access fault at address <code>PC=0x90000000</code> while executing instruction <code>MTINST=0x42078b63</code> - this is fatal for the default debug trap handler while the CPU was in machine-mode (<code>[M]</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The specific message right at the beginning of the debug trap handler message corresponds to the trap code
obtained from the <a href="#_mcause"><strong><code>mcause</code></strong></a> CSR (see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>). A full list of all messages and the according
<code>mcause</code> trap codes is shown below.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 79. RTE Default Trap Handler Messages and According <code>mcause</code> Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trap identifier</th>
<th class="tableblock halign-center valign-top">According <code>mcause</code> CSR value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Instruction address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Instruction access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000001</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Illegal instruction"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Breakpoint"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Load address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Load access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Store address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Store access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Environment call from U-mode"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Environment call from M-mode"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x0000000b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine software IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine timer IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine external IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000000b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000000"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000001"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000002"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000003"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000004"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000005"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000006"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000007"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000008"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000009"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000a"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000b"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000c"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000d"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000e"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000f"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Unknown trap cause"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">undefined</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_application_context_handling">4.6.4. Application Context Handling</h4>
<div class="paragraph">
<p>Upon trap entry the RTE backups the <em>entire</em> application context (i.e. all <code>x</code> general purpose registers)
to the stack. The context is restored automatically after trap completion. The base address of the according
stack frame is copied to the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR. By having this information available, the RTE provides dedicated
functions for accessing and <em>altering</em> the application context:</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. Context Access Functions</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// Prototypes
uint32_t neorv32_rte_context_get(int x); // read register x
void     neorv32_rte_context_put(int x, uint32_t data); write data to register x

// Examples
uint32_t tmp = neorv32_rte_context_get(9); // read register 'x9'
neorv32_rte_context_put(28, tmp); // write 'tmp' to register 'x28'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V <code>E</code> Extension</div>
Registers <code>x16..x31</code> are not available if the RISC-V <a href="#_e_isa_extension"><code>E</code> ISA Extension</a> is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The context access functions can be used by application-specific trap handlers to emulate unsupported
CPU / SoC features like unimplemented IO modules, unsupported instructions and even unaligned memory accesses.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Demo Program: Emulate Unaligned Memory Access</div>
A demo program, which showcases how to emulate unaligned memory accesses using the NEORV32 runtime environment
can be found in <code>sw/example/demo_emulate_unaligned</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor features an <em>on-chip debugger</em> (OCD) implementing the <strong>execution-based debugging</strong> scheme,
which is compatible to the <strong>Minimal RISC-V Debug Specification</strong>. A copy of the specification is
available in <code>docs/references</code>.</p>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>standard JTAG access port</p>
</li>
<li>
<p>full control of the CPU: halting, single-stepping and resuming</p>
</li>
<li>
<p>indirect access to all core registers (via program buffer)</p>
</li>
<li>
<p>indirect access to the whole processor address space (via program buffer)</p>
</li>
<li>
<p>trigger module for hardware breakpoints</p>
</li>
<li>
<p>compatible with upstream OpenOCD and GDB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a></p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a></p>
</li>
<li>
<p><a href="#_cpu_debug_mode">CPU Debug Mode</a></p>
</li>
<li>
<p><a href="#_trigger_module">Trigger Module</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">GDB + SVD</div>
Together with a third-party plugin the processor&#8217;s SVD file can be imported right into GDB to allow comfortable
debugging of peripheral/IO devices (see <a href="https://github.com/stnolting/neorv32/discussions/656" class="bare">https://github.com/stnolting/neorv32/discussions/656</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hands-On Tutorial</div>
A simple example on how to use NEORV32 on-chip debugger in combination with OpenOCD and the GNU debugger is shown in
section <a href="https://stnolting.github.io/neorv32/ug/#_debugging_using_the_on_chip_debugger">Debugging using the On-Chip Debugger</a>
of the User Guide.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">OCD Security Note</div>
JTAG access via the OCD is <strong>always authenticated</strong> (<code>dmstatus.authenticated = 1</code>). Hence, the entire system can always
be accessed via the on-chip debugger.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 on-chip debugger complex is based on four hardware modules:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_ocd_complex.png" alt="neorv32 ocd complex">
</div>
<div class="title">Figure 14. NEORV32 on-chip debugger complex</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a> (<code>rtl/core/neorv32_debug_dtm.vhd</code>): JTAG access tap to allow an external
adapter to interface with the <em>debug module (DM)</em> using the <em>debug module interface (dmi)</em>.</p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a> (<code>rtl/core/neorv32_debug_tm.vhd</code>): RISC-V debug module that is configured by the DTM via the <em>dmi</em>.
From the CPU&#8217;s "point of view" this module behaves as another memory-mapped "peripheral" that can be accessed via the
processor-internal bus. The memory-mapped registers provide an internal <em>data buffer</em> for data transfer from/to the DM, a
<em>code ROM</em> containing the "park loop" code, a <em>program buffer</em> to allow the debugger to execute small programs defined by the
DM and a <em>status register</em> that is used to communicate <em>exception, _halt</em>, <em>resume</em> and <em>execute</em> requests/acknowledges from/to the DM.</p>
</li>
<li>
<p>CPU <a href="#_cpu_debug_mode">CPU Debug Mode</a> extension (part of <code>rtl/core/neorv32_cpu_control.vhd</code>): This extension provides the "debug execution mode",
which executes the park loop code from the DM. The mode also provides additional CSRs and instructions.</p>
</li>
<li>
<p>CPU <a href="#_trigger_module">Trigger Module</a> (also part of <code>rtl/core/neorv32_cpu_control.vhd</code>): This module provides a single <em>hardware</em> breakpoint,
which allows to debug code executed from ROM.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>When debugging the system using the OCD, the debugger issues a halt request to the CPU (via the CPU&#8217;s
<code>db_halt_req_i</code> signal) to make the CPU enter <em>debug mode</em>. In this state, the application-defined architectural
state of the system/CPU is "frozen" so the debugger can monitor if without interfering with the actual application.
However, the OCD can also modify the entire architectural state at any time. While in debug mode, the debugger has
full control over the entire CPU and processor.</p>
</div>
<div class="paragraph">
<p>While in debug mode, the CPU executes the "park loop" code from the code ROM of the DM.
This park loop implements an endless loop, where the CPU polls the memory-mapped <em>status register</em> that is
controlled by the debug module (DM). The flags in this register are used to communicate requests from
the DM and to acknowledge them by the CPU: trigger execution of the program buffer or resume the halted
application. Furthermore, the CPU uses this register to signal that the CPU has halted after a halt request
and to signal that an exception has been triggered while being in debug mode.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</h3>
<div class="paragraph">
<p>The debug transport module (VHDL module: <code>rtl/core/neorv32_debug_dtm.vhd</code>) provides a JTAG test access port (TAP).
External JTAG access is provided by the following top-level ports.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 80. JTAG top level signals</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset (low-active); this signal is optional, make sure to pull it <strong>high</strong> if not used</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Maximum JTAG Clock</div>
All JTAG signals are synchronized to the processor&#8217;s clock domain. Hence, no additional clock domain is required for the DTM.
However, this constraints the maximal JTAG clock frequency (<code>jtag_tck_i</code>) to be less than or equal to <strong>1/5</strong> of the processor
clock frequency (<code>clk_i</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Maintaining JTAG Chain</div>
If the on-chip debugger is disabled the JTAG serial input <code>jtag_tdi_i</code> is directly
connected to the JTAG serial output <code>jtag_tdo_o</code> to maintain the JTAG chain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JTAG accesses are based on a single <em>instruction register</em> <code>IR</code>, which is 5 bit wide, and several <em>data registers</em> <code>DR</code>
with different sizes. The individual data registers are accessed by writing the according address to the instruction
register. The following table shows the available data registers and their addresses:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 81. JTAG TAP registers</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address (via <code>IR</code>)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size (bits)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>00001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDCODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier, hardwired to <code>0x00000001</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DTMCS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug transport module control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DMI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug module interface (<em>dmi</em>); 7-bit address, 32-bit read/write data, 2-bit operation (<code>00</code> = NOP; <code>10</code> = write; <code>01</code> = read)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">others</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BYPASS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default JTAG bypass register</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 82. <code>DTMCS</code> - DTM Control and Status Register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmihardreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will reset the debug module interface; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmireset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will clear the sticky error state; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>idle</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">recommended idle states (= 0, no idle states required)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmistat</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMI status: <code>00</code> = no error, <code>01</code> = reserved, <code>10</code> = operation failed, <code>11</code> = failed operation during pending DMI operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abits</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of address bits in <code>DMI</code> register (= 6)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code> = DTM is compatible to spec. versions v0.13 and v1.0</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_debug_module_dm">5.2. Debug Module (DM)</h3>
<div class="paragraph">
<p>The debug module "DM" (VHDL module: <code>rtl/core/neorv32_debug_dm.vhd</code>) acts as a translation interface between abstract
operations issued by the debugger (application) and the platform-specific debugger (hardware) implementation.
It supports the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gives the debugger necessary information about the implementation.</p>
</li>
<li>
<p>Allows the hart to be halted/resumed and provides status of the current state.</p>
</li>
<li>
<p>Provides abstract read and write access to the halted hart&#8217;s GPRs.</p>
</li>
<li>
<p>Provides access to a reset signal that allows debugging from the very first instruction after reset.</p>
</li>
<li>
<p>Provides a Program Buffer to force the hart to execute arbitrary instructions.</p>
</li>
<li>
<p>Allows memory access from a hart&#8217;s point of view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NEORV32 DM follows the "Minimal RISC-V External Debug Specification" to provide full debugging capabilities while
keeping resource/area requirements at a minimum. It implements the <strong>execution based debugging scheme</strong> for a
single hart and provides the following hardware features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>program buffer with 2 entries and implicit <code>ebreak</code> instruction afterwards</p>
</li>
<li>
<p>no <em>direct</em> bus access; indirect bus access via the CPU using the program buffer</p>
</li>
<li>
<p>abstract commands: "access register" plus auto-execution</p>
</li>
<li>
<p>no dedicated halt-on-reset capabilities yet (but can be emulated)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DM Spec. Version</div>
By default, the OCD&#8217;s debug module supports version 1.0 of the RISC-V debug spec. For backwards compatibility, the DM
can be "downgraded" back to version 0.13 via the <code>DM_LEGACY_MODE</code> generic (see <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DM provides two access "point of views": accesses from the DTM via the <em>debug module interface (dmi)</em> and
accesses from the CPU via the processor-internal bus. From the DTM&#8217;s point of view, the DM implements a set of
<a href="#_dm_registers">DM Registers</a> that are used to control and monitor the actual debugging. From the CPU&#8217;s point of view, the
DM implements several memory-mapped registers (within the <em>normal</em> address space) that are used for communicating
debugging control and status (<a href="#_dm_cpu_access">DM CPU Access</a>).</p>
</div>
<div class="sect3">
<h4 id="_dm_registers">5.2.1. DM Registers</h4>
<div class="paragraph">
<p>The DM is controlled via a set of registers that are accessed via the DTM&#8217;s <em>debug module interface</em>.
The following registers are implemented:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Write accesses to registers that are not implemented are simply ignored and read accesses will always return zero.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 83. Available DM registers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 58.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x04</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_data0"><strong><code>data0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract data 0, used for data transfer between debugger and processor</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x10</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_dmcontrol"><strong><code>dmcontrol</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module control</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x11</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_dmstatus"><strong><code>dmstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x12</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_hartinfo"><strong><code>hartinfo</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart information</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_abstracts"><strong><code>abstracts</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x17</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_command"><strong><code>command</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x18</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_abstractauto"><strong><code>abstractauto</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command auto-execution</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x1d</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nextdm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of next DM; reads as zero to indicate there is only one DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x20</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_progbuf"><code>progbuf0</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x21</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_progbuf"><code>progbuf1</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x38</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sbcs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System bus access control and status; reads as zero to indicate there is <strong>no</strong> direct system bus access</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x40</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_haltsum0"><strong><code>haltsum0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halted harts</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_data0"><strong><code>data0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract data 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Basic read/write data exchange register to be used with abstract commands (for example to read/write data from/to CPU GPRs).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmcontrol"><strong><code>dmcontrol</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Control of the overall debug module and the hart. The following table shows all implemented bits. All remaining bits/bit-fields
are configured as "zero" and are read-only. Writing '1' to these bits/fields will be ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 84. <code>dmcontrol</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set/clear hart halt request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resumereq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request hart to resume</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ackhavereset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write <code>1</code> to clear <code>*havereset</code> flags</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ndmreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put whole system (except OCD) into reset state when <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmactive</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM enable; writing <code>0</code>-<code>1</code> will reset the DM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmstatus"><strong><code>dmstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00400083</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Current status of the overall debug module and the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 85. <code>dmstatus</code> Register Bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 15.3846%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>impebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; indicates an implicit <code>ebreak</code> instruction after the last program buffer entry</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhavereset</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is in reset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhavereset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allresumeack</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart has acknowledged a resume request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyresumeack</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allnonexistent</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">always zero to indicate the hart is always existent</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anynonexistent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allunavail</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the DM is disabled to indicate the hart is unavailable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyunavail</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allrunning</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is running</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyrunning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhalted</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is halted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhalted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authbusy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hasresethaltreq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; halt-on-reset is not supported (directly)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>confstrptrvalid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; no configuration string available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug spec. version; <code>0011</code> (v1.0) or <code>0010</code> (v0.13); configured via the <code>DM_LEGACY_MODE</code> <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hartinfo"><strong><code>hartinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hart information</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>see below</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register gives information about the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 86. <code>hartinfo</code> Register Bits</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nscratch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of <code>dscratch*</code> CPU registers = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataccess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>, the <code>data</code> registers are shadowed in the hart&#8217;s address space</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datasize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of 32-bit words in the address space dedicated to shadowing the <code>data</code> registers (1 register)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataaddr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= <code>dm_data_base_c(11:0)</code>, signed base address of <code>data</code> words (see address map in <a href="#_dm_cpu_access">DM CPU Access</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstracts"><strong><code>abstracts</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract control and status</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstracts</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x02000801</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Command execution info and status.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 87. <code>abstracts</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:29</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbufsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0010</code>: size of the program buffer (<code>progbuf</code>) = 2 entries</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> when a command is being executed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>relaxedpriv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>: PMP rules are ignored when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmderr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error during command execution (see below); has to be cleared by writing <code>111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datacount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0001</code>: number of implemented <code>data</code> registers for abstract commands = 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Error codes in <code>cmderr</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>000</code> - no error</p>
</li>
<li>
<p><code>100</code> - command cannot be executed since hart is not in expected state</p>
</li>
<li>
<p><code>011</code> - exception during command execution</p>
</li>
<li>
<p><code>010</code> - unsupported command</p>
</li>
<li>
<p><code>001</code> - invalid DM register read/write while command is/was executing</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_command"><strong><code>command</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>command</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Writing this register will trigger the execution of an abstract command. New command can only be executed if
<code>cmderr</code> is zero. The entire register in write-only (reads will return zero).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 DM only supports <strong>Access Register</strong> abstract commands. These commands can only access the
hart&#8217;s GPRs (abstract command register index <code>0x1000</code> - <code>0x101f</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 88. <code>command</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description / required value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmdtype</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000000</code> to indicate "access register" command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, has to be <code>0</code> when writing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>010</code> to indicate 32-bit accesses</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarpostincrement</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>, post-increment is not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>postexec</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set the program buffer is executed <em>after</em> the command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>transfer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set the operation in <code>write</code> is conducted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>write</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: copy <code>data0</code> to <code>[regno]</code>, <code>0</code>: copy <code>[regno]</code> to <code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>regno</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPR-access only; has to be <code>0x1000</code> - <code>0x101f</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstractauto"><strong><code>abstractauto</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command auto-execution</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Register to configure when a read/write access to a DM repeats execution of the last abstract command.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 89. <code>abstractauto</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf1</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf0</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecdata[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>data0</code> will execute <code>command</code> again</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_progbuf"><strong><code>progbuf</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000013</code> ("NOP")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Program buffer (two entries) for the DM.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_haltsum0"><strong><code>haltsum0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x408</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Halted harts status</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>haltsum0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Hart has halted when according bit is set.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 90. <code>haltsum0</code> Register Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltsum0[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart is halted when set.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dm_cpu_access">5.2.2. DM CPU Access</h4>
<div class="paragraph">
<p>From the CPU&#8217;s perspective, the DM behaves as a memory-mapped peripheral. It occupies 256 bytes of the CPU&#8217;s address
space starting at address <code>dm_base_c</code> (see table below). This address space is divided into four sections of 64 bytes
each to provide access to the <em>park loop code ROM</em>, the <em>program buffer</em>, the <em>data buffer</em> and the <em>status register</em>.
The program buffer, the data buffer and the status register do not fully occupy the 64-byte-wide sections and are
mirrored to fill the entire section.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 91. DM CPU Access - Address Map</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-center valign-top">Actual size</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff00</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROM for the "park loop" code</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff40</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer (<a href="#_progbuf"><strong><code>progbuf</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff80</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data buffer (<a href="#_data0"><strong><code>data0</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffffc0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and <a href="#_status_register">Status Register</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">DM Register Access</div>
All memory-mapped registers of the DM can only be accessed by the CPU if it is actually in debug mode.
Hence, the DM registers are not "visible" for normal CPU operations.
Any CPU access outside of debug mode will raise a bus access fault exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Park Loop Code Sources ("OCD Firmware")</div>
The assembly sources of the <strong>park loop code</strong> are available in <code>sw/ocd-firmware/park_loop.S</code>. Please note that
these sources are not intended to be changed by the user.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_code_rom_entry_points">Code ROM Entry Points</h5>
<div class="paragraph">
<p>The park loop code provides two entry points, where the actual code execution can start. These are used to enter
the park loop either when an explicit request has been issued (for example a halt request) or when an exception
has occurred <em>while executing</em> the park loop code itself.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 92. Park Loop Entry Points</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_exc_entry_c</code>  (<code>dm_base_c</code> + 0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception entry address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_park_entry_c</code> (<code>dm_base_c</code> + 8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal entry address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the CPU enters or re-enters debug mode (for example via an <code>ebreak</code> in the DM&#8217;s program buffer), it jumps to
the <em>normal entry point</em> that is configured via the <code>CPU_DEBUG_PARK_ADDR</code> generic
(<a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a>). By default, this generic is set to <code>dm_park_entry_c</code>, which is defined in main
package file. If an exception is encountered during debug mode, the CPU jumps to the address of the <em>exception
entry point</em> configured via the <code>CPU_DEBUG_EXC_ADDR</code> generic (<a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a>). By default, this generic
is set to <code>dm_exc_entry_c</code>, which is also defined in main package file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_status_register">Status Register</h5>
<div class="paragraph">
<p>The status register provides a direct communication channel between the CPU&#8217;s debug mode executing the park loop
and the debugger-controlled debug module. This register is used to communicate <em>requests</em>, which are issued by the
DM and the according <em>acknowledges</em>, which are generated by the CPU.</p>
</div>
<div class="paragraph">
<p>There are only 4 bits in this register that are used to implement the requests/acknowledges. Each bit is left-aligned
in one sub-byte of the entire 32-bit register. Thus, the CPU can access each bit individually using <em>store-byte</em> and
<em>load-byte</em> instructions. This eliminates the need to perform bit-masking in the park loop code leading to less code size
and faster execution.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 93. DM Status Register - CPU Access</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 14.2857%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">CPU access</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_halt_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU while it is halted (and executing the park loop).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_resume_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to request the CPU to resume normal operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_resume_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU before it starts resuming.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to request execution of the program buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU before it starts executing the program buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU if an exception occurs while being in debug mode.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_debug_mode">5.3. CPU Debug Mode</h3>
<div class="paragraph">
<p>The NEORV32 CPU Debug Mode is compatible to the <strong>Minimal RISC-V Debug Specification 1.0</strong>
<code>Sdext</code> (external debug) ISA extension. When enabled via the <a href="#_sdext_isa_extension"><code>Sdext</code> ISA Extension</a> generic (CPU) and/or
the <code>ON_CHIP_DEBUGGER_EN</code> (Processor) it adds a new CPU operation mode ("debug mode"), three additional CSRs
(section <a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a>) and one additional instruction (<code>dret</code>) to the core.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">ISA Requirements</div>
The CPU debug mode requires the <code>Zicsr</code> and <code>Zifencei</code> CPU extension to be implemented.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU debug-mode is entered on any of the following events:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The CPU executes a <code>ebreak</code> instruction (when in machine-mode and <code>ebreakm</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set OR when in user-mode and <code>ebreaku</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set).</p>
</li>
<li>
<p>A debug halt request is issued by the DM (via CPU signal <code>db_halt_req_i</code>, high-active, triggering on rising-edge).</p>
</li>
<li>
<p>The CPU completes executing of a single instruction while being single-step debugging mode (enabled if <code>step</code> in <a href="#_dcsr"><strong><code>dcsr</code></strong></a> is set).</p>
</li>
<li>
<p>A hardware trigger from the <a href="#_trigger_module">Trigger Module</a> fires (if <code>action</code> in <a href="#_tdata1"><strong><code>tdata1</code></strong></a> / <code>mcontrol</code> is set).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
From a hardware point of view these entry conditions are special traps that are handled transparently by
the control logic.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU enters debug-mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>wake-up CPU if it was send to sleep mode by the <code>wfi</code> instruction</p>
</li>
<li>
<p>move the current program counter to <a href="#_dpc"><strong><code>dpc</code></strong></a></p>
</li>
<li>
<p>copy the hart&#8217;s current privilege level to the <code>prv</code> flags in <a href="#_dcsr"><strong><code>dcsr</code></strong></a></p>
</li>
<li>
<p>set <code>cause</code> in <a href="#_dcrs">[_dcrs]</a> according to the cause why debug mode is entered</p>
</li>
<li>
<p><strong>no update</strong> of <code>mtval</code>, <code>mcause</code>, <code>mtval</code> and <code>mstatus</code> CSRs</p>
</li>
<li>
<p>load the address configured via the CPU&#8217;s <code>CPU_DEBUG_PARK_ADDR</code> (<a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a>) generic to the program counter jumping to the
"debugger park loop" code stored in the debug module (DM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>When the CPU is in debug-mode the following things are important:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>while in debug mode, the CPU executes the parking loop and - if requested by the DM - the program buffer</p>
</li>
<li>
<p>effective CPU privilege level is <code>machine</code> mode; any active physical memory protection (PMP) configuration is bypassed</p>
</li>
<li>
<p>the <code>wfi</code> instruction acts as a <code>nop</code> (also during single-stepping)</p>
</li>
<li>
<p>if an exception occurs while being in debug mode:</p>
<div class="ulist">
<ul>
<li>
<p>if the exception was caused by any debug-mode entry action the CPU jumps to the normal entry point (defined by <code>CPU_DEBUG_PARK_ADDR</code> generic of the <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a>) of the park loop again (for example when executing <code>ebreak</code> while in debug-mode)</p>
</li>
<li>
<p>for all other exception sources the CPU jumps to the exception entry point (defined by <code>CPU_DEBUG_EXC_ADDR</code> generic of the <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a>) to signal an exception to the DM; the CPU restarts the park loop again afterwards</p>
</li>
</ul>
</div>
</li>
<li>
<p>interrupts are disabled; however, they will remain pending and will get executed after the CPU has left debug mode</p>
</li>
<li>
<p>if the DM makes a resume request, the park loop exits and the CPU leaves debug mode (executing <code>dret</code>)</p>
</li>
<li>
<p>the standard counters <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> <code>[m]cycle[h]</code> and <code>[m]instret[h]</code> are stopped</p>
</li>
<li>
<p>all <a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a> are stopped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debug mode is left either by executing the <code>dret</code> instruction or by performing a hardware reset of the CPU.
Executing <code>dret</code> outside of debug mode will raise an illegal instruction exception.</p>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU leaves debug mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the hart&#8217;s current privilege level according to the <code>prv</code> flags of <a href="#_dcsr"><strong><code>dcsr</code></strong></a></p>
</li>
<li>
<p>restore the original program counter from <a href="#_dpcs">[_dpcs]</a> resuming normal operation</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</h4>
<div class="paragraph">
<p>Two additional CSRs are required by the <em>Minimal RISC-V Debug Specification</em>: the debug mode control and status register
<code>dcsr</code> and the debug program counter <code>dpc</code>. An additional general purpose scratch register for debug mode only
(<code>dscratch0</code>) allows faster execution by having a fast-accessible backup register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The debug-mode CSRs are only accessible when the CPU is <em>in</em> debug mode. If these CSRs are accessed outside of debug mode
an illegal instruction exception is raised.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_dcsr"><strong><code>dcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x40000413</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This register is used to configure the debug mode environment and provides additional status information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 94. Debug control and status register <code>dcsr</code> bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>xdebugver</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100</code> - CPU debug mode is compatible to spec. version 1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000000000000</code> - <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>machine</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - hypervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaks</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - supervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaku</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>user</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stepie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - IRQs are disabled during single-stepping</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stopcount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - standard counters and HPMs are stopped when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stoptime</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - timers increment as usual</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cause</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause identifier - why debug mode was entered (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mprven</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - <a href="#_mstatus"><strong><code>mstatus</code></strong></a>.mprv is also evaluated when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nmip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - non-maskable interrupt is pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>step</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable single-stepping when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>prv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU privilege level before/after debug mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Cause codes in <code>dcsr.cause</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>010</code> - triggered by hardware <a href="#_trigger_module">Trigger Module</a></p>
</li>
<li>
<p><code>001</code> - executed <code>EBREAK</code> instruction</p>
</li>
<li>
<p><code>011</code> - external halt request (from DM)</p>
</li>
<li>
<p><code>100</code> - return from single-stepping</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_dpc"><strong><code>dpc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU_BOOT_ADDR</code>, CPU boot address, 4-byte aligned (see <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a> and <a href="#_address_space">Address Space</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The register is used to store the current program counter when debug mode is entered. The <code>dret</code> instruction will
return to the address stored in <code>dpc</code> by automatically moving <code>dpc</code> to the program counter.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dpc[0]</code> is hardwired to zero. If IALIGN = 32 (i.e. <a href="#_c_isa_extension"><code>C</code> ISA Extension</a> is disabled) then <code>dpc[1]</code> is also hardwired to zero.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dscratch0"><strong><code>dscratch0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug scratch register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7b2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The register provides a general purpose debug mode-only scratch register.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trigger_module">5.4. Trigger Module</h3>
<div class="paragraph">
<p>"Normal" <em>software</em> breakpoints (using GDB&#8217;s <code>b</code>/<code>break</code> command) are implemented by temporarily replacing the according
instruction word by an <code>[c.]ebreak</code> instruction. However, this is not possible when debugging code that is executed from
read-only memory (for example when debugging programs that are executed via the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a>).
To circumvent this limitation a hardware trigger logic allows to (re-)enter debug-mode when instruction execution
reaches a programmable address. These "hardware-assisted breakpoints" are used by GDB&#8217;s <code>hb</code>/<code>hbreak</code> commands.</p>
</div>
<div class="paragraph">
<p>The RISC-V <code>Sdtrig</code> ISA extension adds a programmable <em>trigger module</em> to the CPU core that is enabled via the
<a href="#_sdtrig_isa_extension"><code>Sdtrig</code> ISA Extension</a> generic. The trigger module implements a subset of the features described in the
"RISC-V Debug Specification / Trigger Module" and complies to version v1.0 of the <code>Sdtrig</code> spec.</p>
</div>
<div class="paragraph">
<p>The NEORV32 trigger module features only a <em>single</em> trigger implementing a "type 6 - instruction address match" trigger.
This limitation is granted by the RISC-V debug spec and is sufficient to <strong>debug code executed from read-only memory (ROM)</strong>.
The trigger module can also be used independently of the CPU debug-mode / <code>Sdext</code> ISA extension.
Machine-mode software can use the trigger module to raise a breakpoint exception when instruction execution
reaches a programmed address.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Trigger Timing</div>
When enabled the address match trigger will fire <strong>BEFORE</strong> the instruction at the programmed address gets executed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">MEPC &amp; DPC CSRs</div>
The breakpoint exception when raised by the trigger module behaves different then the "normal" trapping (see
<a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>): <a href="#_mepc"><strong><code>mepc</code></strong></a> / <a href="#_dpc"><strong><code>dpc</code></strong></a> is set to the address of the next instruction that needs to be
executed to preserve the program flow. A "normal" breakpoint exception would set <a href="#_mepc"><strong><code>mepc</code></strong></a> / <a href="#_dpc"><strong><code>dpc</code></strong></a> to the address
of the actual <code>ebreak</code> instruction itself.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_trigger_module_csrs">5.4.1. Trigger Module CSRs</h4>
<div class="paragraph">
<p>The <code>Sdtrig</code> ISA extension adds 4 additional CSRs that are accessible from debug-mode and also from machine-mode.
Machine-mode write accesses can be ignored by setting ´dmode´ in <a href="#_tdata1"><strong><code>tdata1</code></strong></a>. This is automatically done by the debugger
if it uses the trigger module for implementing a "hardware breakpoint"</p>
</div>
<div class="sect4">
<h5 id="_tselect"><strong><code>tselect</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger select register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This CSR is hardwired to zero indicating there is only one trigger available. Any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata1"><strong><code>tdata1</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 1, visible as trigger "type 6 match control" (<code>mcontrol6</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x60000048</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This CSR is used to configure the address match trigger using the "type 6" format.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 95. Match Control CSR (<code>tdata1</code>) Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100</code> - address match trigger type 6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmode</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to ignore write accesses to <a href="#_tdata1"><strong><code>tdata1</code></strong></a> and <a href="#_tdata2"><strong><code>tdata2</code></strong></a> from machine-mode; writable from debug-mode only</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>uncertain</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - trigger satisfies the configured conditions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hit1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - hardwired to zero, only <code>hit0</code> is used</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>vs</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - VS-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>vu</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - VU-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hit0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set when trigger has fired (<strong>BEFORE</strong> executing the triggering address); must be explicitly cleared by writing zero; writing 1 has no effect</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>select</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - only address matching is supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20:19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00</code> - hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000</code> -  match accesses of any size</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>action</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000</code> = breakpoint exception on trigger match, <code>0001</code> = enter debug-mode on trigger match</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>chain</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - chaining is not supported as there is only one trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>match</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000</code> - equal-match only</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - trigger enabled when in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>uncertainen</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - feature not supported, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - supervisor-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>/<code>1</code> - trigger enabled when in user-mode, set if <code>U</code> ISA extension is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>execute</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable trigger matching on instruction address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>store</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - store address/data matching not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>load</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - load address/data matching not supported</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata2"><strong><code>tdata2</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since only the "address match trigger" type is supported, this r/w CSR is used to configure the address of the triggering instruction.
Note that the trigger module will fire <strong>before</strong> the instruction at the programmed address gets executed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tinfo"><strong><code>tinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger information register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x7a4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01000006</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> &amp; <code>Sdtrig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CSR shows global trigger information (see below). Any write access is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 96. Trigger Info CSR (<code>tinfo</code>) Bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x01</code> - compatible to spec. version v1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> - hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0006</code> - only type 6 trigger is supported</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">6. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) 2024, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
<a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
Dipl.-Ing. (M.Sc.) Stephan Nolting<br>
🇪🇺 European Union, Germany<br>
<a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a Subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of AMD Inc.</p>
</li>
<li>
<p>"AXI", "AXI4-Lite" and "AXI4-Stream" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics – A Siemens Business.</p>
</li>
<li>
<p>"Quartus Prime" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>Images/figures made with <em>Microsoft Power Point</em>.</p>
</li>
<li>
<p>Timing diagrams made with <em>WaveDrom Editor</em>.</p>
</li>
<li>
<p>Documentation made with <code>asciidoctor</code>.</p>
</li>
<li>
<p>"Segger Embedded Studio" and "J-Link" are trademarks of Segger Microcontroller Systems GmbH.</p>
</li>
<li>
<p>All further/unreferenced projects/products/brands belong to their according copyright holders.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. No copyright infringement intended.
Other implied or used projects/sources might have different licensing – see their documentation to get more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_citing">Citing</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is an open-source project that is free of charge. Use this project in any way you like
(as long as it complies to the permissive license). Please cite it appropriately. 👍
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contributors ❤️</div>
Please add as many <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a> as possible to the <code>author</code> field.<br>
This project would not be where it is without them.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DOI</div>
This project also provides a <em>digital object identifier</em> provided by <a href="https://zenodo.org">zenodo</a>:
<a href="https://doi.org/10.5281/zenodo.5018888"><span class="image"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5018888.svg" alt="zenodo.5018888" title="zenodo"></span></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shout-out to the community and all <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! ❤️</strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
<div class="paragraph">
<p>Continuous integration provided by <a href="https://github.com/features/actions">GitHub Actions</a> and powered by <a href="https://github.com/ghdl/ghdl">GHDL</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Resource utilization depends on custom design logic.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.5.5.0-r4510-gec620049<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>